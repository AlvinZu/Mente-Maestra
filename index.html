<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <title>Mente Maestra</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
  
  <!-- ===== INICIO DE CÓDIGO AÑADIDO PARA PWA EN IOS ===== -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Mente Maestra">
    <link rel="apple-touch-icon" href="Icon-Mente-Maestra.png">
    <!-- ===== FIN DE CÓDIGO AÑADIDO PARA PWA EN IOS ===== -->

    <style>
      
#breathing-visualizer {
    /* La duración de la transición se adaptará a la fase de la respiración. 
       Una base de 3s funciona bien para las exhalaciones largas. */
    transition: transform 3s ease-in-out; 
}
      
        /* Estilos base y tema oscuro */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Gris oscuro */
            color: #F9FAFB; /* Gris muy claro */
        }
        /* Estilo para el botón de navegación activo */
        .nav-button.active {
            color: #3B82F6; /* Azul brillante */
        }
        /* Transiciones suaves para cambiar de vista */
        .view {
            transition: opacity 0.2s ease-in-out;
        }
        .view.hidden {
            opacity: 0;
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        /* Estilos para las opciones del reto */
        .challenge-option {
            transition: background-color 0.2s, border-color 0.2s;
        }
        .challenge-option.selected {
            background-color: #1E40AF; /* Azul oscuro */
            border-color: #3B82F6; /* Azul brillante */
        }
        .feedback-correct { color: #22C55E; } /* Verde */
        .feedback-incorrect { color: #EF4444; } /* Rojo */
    </style>
</head>
<body class="h-full flex flex-col">

    <!-- Contenedor Principal de Vistas -->
    <div id="main-container" class="flex-grow relative">

        <!-- Vista de Pestañas (Inicio, Módulos, etc.) -->
        <div id="tabs-view" class="view w-full h-full p-4 pb-24 overflow-y-auto">
            <!-- Pestaña 1: INICIO (Visible por defecto) -->
            <section id="inicio" class="tab-content">
                <header class="mb-8">
                    <h1 class="text-3xl font-bold">Hola, Maestro</h1>
                    <p class="text-md text-gray-400">Comencemos tu entrenamiento de hoy.</p>
                  
                </header>
              <div id="daily-mission-card" class="bg-gray-800 p-5 rounded-xl mb-6 shadow-lg border border-gray-700">
    <div class="flex items-center mb-3"><i data-lucide="compass" class="text-purple-400 mr-3"></i><h2 class="text-lg font-semibold">Misión de Campo del Día</h2></div>
    <div id="mission-content">
        <p class="text-gray-400">Cargando misión...</p>
    </div>
</div>
              
              <div class="bg-gray-800 p-5 rounded-xl mb-6 shadow-lg border border-gray-700">
                    <div class="flex items-center mb-3"><i data-lucide="target" class="text-green-400 mr-3"></i><h2 class="text-lg font-semibold">Reto Práctico Aleatorio</h2></div>
                    <h3 class="text-xl font-bold mb-2 text-green-400">Pon a Prueba tus Habilidades</h3>
                    <p class="text-gray-300 mb-4">Enfréntate a un escenario de la vida real y demuestra tu capacidad de observación y análisis.</p>
                    <button onclick="startRandomChallenge()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Aceptar Reto</button>
                </div>
              
              
                <div class="bg-gray-800 p-5 rounded-xl mb-6 shadow-lg border border-gray-700">
    <div class="flex items-center mb-3"><i data-lucide="sparkles" class="text-yellow-400 mr-3"></i><h2 class="text-lg font-semibold">Lección del Día</h2></div>
    <div id="daily-lesson-container">
        <p class="text-gray-400">Cargando lección...</p>
    </div>
</div>             
                              
              
                <div>
                    <h2 class="text-lg font-semibold mb-3">Tu Progreso General</h2>
                    <div class="w-full bg-gray-700 rounded-full h-4"><div class="bg-gradient-to-r from-blue-500 to-green-500 h-4 rounded-full" style="width: 75%"></div></div>
                    <div class="flex justify-between text-sm text-gray-400 mt-2"><span>Observador Nivel 3</span><span>750/1000 XP</span></div>
                </div>
            </section>

            <!-- Pestaña 2: MÓDULOS -->
            <section id="modulos" class="tab-content hidden">
                <header class="mb-8"><h1 class="text-3xl font-bold">Módulos de Aprendizaje</h1><p class="text-md text-gray-400">Selecciona una disciplina para comenzar.</p></header>
                <div id="modules-grid" class="space-y-4"></div>
            </section>

            <!-- Pestaña 3: LABORATORIO -->
            <section id="laboratorio" class="tab-content hidden">
                 <header class="mb-8"><h1 class="text-3xl font-bold">Laboratorio de Práctica</h1><p class="text-md text-gray-400">Pon a prueba tus habilidades con herramientas interactivas.</p></header>
                 <div class="space-y-4">
                    <div onclick="showLabTool('micro-expressions-gym')" class="bg-gray-800 p-5 rounded-xl shadow-lg border border-gray-700 cursor-pointer hover:bg-gray-700 transition-colors flex items-center">
                        <div class="p-3 bg-green-600 rounded-lg mr-4"><i data-lucide="smile-plus"></i></div>
                        <div>
                            <h3 class="text-xl font-bold text-green-400">Gimnasio de Microexpresiones</h3>
                            <p class="text-gray-400">Entrena tu velocidad para detectar emociones ocultas.</p>
                        </div>
                        <i data-lucide="chevron-right" class="ml-auto text-gray-500"></i>
                    </div>
                    <div onclick="showLabTool('challenge-library')" class="bg-gray-800 p-5 rounded-xl shadow-lg border border-gray-700 cursor-pointer hover:bg-gray-700 transition-colors flex items-center">
                        <div class="p-3 bg-blue-600 rounded-lg mr-4"><i data-lucide="library"></i></div>
                        <div>
                            <h3 class="text-xl font-bold text-blue-400">Biblioteca de Retos</h3>
                            <p class="text-gray-400">Practica con todos los escenarios disponibles.</p>
                        </div>
                        <i data-lucide="chevron-right" class="ml-auto text-gray-500"></i>
                    </div>
                    <div onclick="showSimulationLibrary()" class="bg-gray-800 p-5 rounded-xl shadow-lg border border-gray-700 cursor-pointer hover:bg-gray-700 transition-colors flex items-center">
    <div class="p-3 bg-yellow-600 rounded-lg mr-4"><i data-lucide="message-square"></i></div>
    <div>
        <h3 class="text-xl font-bold text-yellow-400">Simulador de Conversación</h3>
        <p class="text-gray-400">Entra en escenarios realistas y elige tus respuestas.</p>
    </div>
    <i data-lucide="chevron-right" class="ml-auto text-gray-500"></i>
</div>
                   
                   <div onclick="showMentalismLab()" class="bg-gray-800 p-5 rounded-xl shadow-lg border border-gray-700 cursor-pointer hover:bg-gray-700 transition-colors flex items-center">
    <div class="p-3 bg-purple-600 rounded-lg mr-4"><i data-lucide="brain-circuit"></i></div>
    <div>
        <h3 class="text-xl font-bold text-purple-400">Laboratorio de Mentalismo</h3>
        <p class="text-gray-400">Practica técnicas de forzaje e influencia sutil.</p>
    </div>
    <i data-lucide="chevron-right" class="ml-auto text-gray-500"></i>
</div>
                   
                   <div onclick="showMissionLibrary()" class="bg-gray-800 p-5 rounded-xl shadow-lg border border-gray-700 cursor-pointer hover:bg-gray-700 transition-colors flex items-center">
    <div class="p-3 bg-green-600 rounded-lg mr-4"><i data-lucide="map"></i></div>
    <div>
        <h3 class="text-xl font-bold text-green-400">Biblioteca de Misiones</h3>
        <p class="text-gray-400">Explora todos los desafíos de campo disponibles.</p>
    </div>
    <i data-lucide="chevron-right" class="ml-auto text-gray-500"></i>
</div>
                   
                   <div onclick="showIntegrationMissionLibrary()" class="bg-gray-800 p-5 rounded-xl shadow-lg border border-gray-700 cursor-pointer hover:bg-gray-700 transition-colors flex items-center">
    <div class="p-3 bg-red-600 rounded-lg mr-4"><i data-lucide="swords"></i></div>
    <div>
        <h3 class="text-xl font-bold text-red-400">Misiones de Integración</h3>
        <p class="text-gray-400">Combina todas tus habilidades en escenarios complejos.</p>
    </div>
    <i data-lucide="chevron-right" class="ml-auto text-gray-500"></i>
</div>
                   
                 </div>
            </section>

            <!-- Pestaña 4: DIARIO -->
            <section id="diario" class="tab-content hidden">
                <header class="mb-8">
                    <h1 class="text-3xl font-bold">Mi Diario</h1>
                    <p class="text-md text-gray-400">Tu progreso y reflexiones en un solo lugar.</p>
                </header>
                <div class="mb-8">
                    <h2 class="text-xl font-semibold mb-3">Mis Estadísticas</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-800 p-4 rounded-lg text-center">
                            <p class="text-3xl font-bold text-blue-400">12</p>
                            <p class="text-sm text-gray-400">Lecciones Completadas</p>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg text-center">
                            <p class="text-3xl font-bold text-green-400">5</p>
                            <p class="text-sm text-gray-400">Retos Superados</p>
                        </div>
                    </div>
                </div>
                <div class="mb-8">
                    <h2 class="text-xl font-semibold mb-3">Mis Logros</h2>
                    <div class="flex space-x-4 overflow-x-auto pb-2">
                        <div class="text-center flex-shrink-0">
                            <div class="w-16 h-16 bg-yellow-500 rounded-full flex items-center justify-center mx-auto"><i data-lucide="award" class="w-8 h-8"></i></div>
                            <p class="text-xs mt-2">Primeros Pasos</p>
                        </div>
                        <div class="text-center flex-shrink-0">
                            <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto"><i data-lucide="eye" class="w-8 h-8"></i></div>
                            <p class="text-xs mt-2">Observador</p>
                        </div>
                        <div class="text-center flex-shrink-0 opacity-40">
                            <div class="w-16 h-16 bg-gray-700 rounded-full flex items-center justify-center mx-auto"><i data-lucide="brain-circuit" class="w-8 h-8"></i></div>
                            <p class="text-xs mt-2">Arquitecto Mental</p>
                        </div>
                    </div>
                </div>
                <div>
    <div class="flex justify-between items-center mb-3">
        <h2 class="text-xl font-semibold">Mis Notas</h2>
        <button onclick="showNoteEditor()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg flex items-center"><i data-lucide="plus" class="mr-2 h-5 w-5"></i>Crear Nota</button>
    </div>
    <div id="notes-list-container" class="space-y-3">
        <p class="text-gray-400">No tienes notas guardadas todavía.</p>
    </div>
</div>
            </section>

            <!-- Pestaña 5: Santuario -->
            <section id="ajustes" class="tab-content hidden">
                <header class="mb-8">
    <h1 class="text-3xl font-bold">Santuario de Relajación</h1>
    <p class="text-md text-gray-400">Personaliza tu sesión de respiración y relajación guiada.</p>
</header>

<div class="space-y-8">
    <div>
        <div class="flex items-center mb-3">
    <h3 class="text-lg font-semibold">1. Elige una técnica de respiración</h3>
    <button onclick="showBreathingGuide()" class="ml-2 p-1 rounded-full hover:bg-yellow-700">
        <i data-lucide="help-circle" class="w-5 h-5 text-yellow-400"></i>
    </button>
</div>
        <div id="breathing-technique-selector" class="grid grid-cols-2 gap-3">
            <label data-technique="box" class="p-4 bg-gray-800 rounded-lg text-center cursor-pointer border-2 border-blue-600">
                <input type="radio" name="technique" value="box" class="hidden" checked>
                <p class="font-bold">Cuadrada (4-4-4-4)</p>
                <p class="text-xs text-gray-400">Concentración</p>
            </label>
            <label data-technique="478" class="p-4 bg-gray-800 rounded-lg text-center cursor-pointer border-2 border-gray-700">
                <input type="radio" name="technique" value="478" class="hidden">
                <p class="font-bold">Relajante (4-7-8)</p>
                <p class="text-xs text-gray-400">Descanso</p>
            </label>
            <label data-technique="wimhof" class="p-4 bg-gray-800 rounded-lg text-center cursor-pointer border-2 border-gray-700">
                <input type="radio" name="technique" value="wimhof" class="hidden">
                <p class="font-bold">Wim Hof</p>
                <p class="text-xs text-gray-400">Energía y Resiliencia</p>
            </label>
            <label data-technique="energy" class="p-4 bg-gray-800 rounded-lg text-center cursor-pointer border-2 border-gray-700">
                <input type="radio" name="technique" value="energy" class="hidden">
                <p class="font-bold">Energizante</p>
                <p class="text-xs text-gray-400">Impulso Rápido</p>
            </label>
        </div>
    </div>

    <div id="wimhof-controls" class="hidden space-y-4">
        <div>
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-lg font-semibold">2. Número de Respiraciones por Ciclo</h3>
                <span id="wh-breaths-display" class="font-bold text-blue-400 bg-gray-700 px-3 py-1 rounded-lg">30</span>
            </div>
            <input id="wh-breaths-slider" type="range" min="20" max="40" value="30" step="5" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
        </div>
        <div>
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-lg font-semibold">3. Número de Ciclos Totales</h3>
                <span id="wh-cycles-display" class="font-bold text-blue-400 bg-gray-700 px-3 py-1 rounded-lg">3</span>
            </div>
            <input id="wh-cycles-slider" type="range" min="2" max="4" value="3" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
        </div>
    </div>

    <div id="duration-controls" class="space-y-4">
        <div class="flex justify-between items-center mb-2">
            <h3 class="text-lg font-semibold">2. Elige la duración</h3>
            <span id="duration-display" class="font-bold text-blue-400 bg-gray-700 px-3 py-1 rounded-lg">5 min</span>
        </div>
        <input id="duration-slider" type="range" min="1" max="15" value="5" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
    </div>

    <div>
        <h3 class="text-lg font-semibold mb-3">3. Elige un paisaje sonoro</h3>
        <div id="soundscape-selector" class="grid grid-cols-2 gap-3">
            <label class="p-4 bg-gray-800 rounded-lg text-center cursor-pointer border-2 border-blue-600">
                <input type="radio" name="sound" value="rain" class="hidden" checked>
                <p class="font-bold">Lluvia Suave</p>
            </label>
            <label class="p-4 bg-gray-800 rounded-lg text-center cursor-pointer border-2 border-gray-700">
                <input type="radio" name="sound" value="waves" class="hidden">
                <p class="font-bold">Olas del Mar</p>
            </label>
            <label class="p-4 bg-gray-800 rounded-lg text-center cursor-pointer border-2 border-gray-700">
    <input type="radio" name="sound" value="bowls" class="hidden">
    <p class="font-bold">Viento</p>
</label>
          <label class="p-4 bg-gray-800 rounded-lg text-center cursor-pointer border-2 border-gray-700">
        <input type="radio" name="sound" value="fire" class="hidden">
        <p class="font-bold">Hoguera</p>
    </label>
    <label class="p-4 bg-gray-800 rounded-lg text-center cursor-pointer border-2 border-gray-700">
    <input type="radio" name="sound" value="nature" class="hidden">
    <p class="font-bold">Naturaleza</p>
</label>
            <label class="p-4 bg-gray-800 rounded-lg text-center cursor-pointer border-2 border-gray-700">
                <input type="radio" name="sound" value="none" class="hidden">
                <p class="font-bold">Silencio</p>
            </label>
        </div>
    </div>
    
    <button id="start-session-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-extrabold py-4 px-4 rounded-lg text-lg transition-colors flex items-center justify-center">
        <i data-lucide="play" class="mr-3"></i>COMENZAR SESIÓN
    </button>
</div>
            </section>
          
        </div>

        <!-- Vista de Detalle de Módulo -->
        <div id="module-detail-view" class="view hidden w-full h-full p-4 pb-24 overflow-y-auto"></div>

        <!-- Vista de Lección -->
        <div id="lesson-view" class="view hidden w-full h-full p-4 pb-24 overflow-y-auto"></div>

        <!-- Vista de Reto -->
        <div id="challenge-view" class="view hidden w-full h-full p-4 pb-24 overflow-y-auto"></div>
        
        <!-- Vista del Gimnasio de Microexpresiones -->
        <div id="micro-expressions-gym-view" class="view hidden w-full h-full p-4 pb-24 overflow-y-auto flex flex-col"></div>
      
      <!-- Vista del simulador de Teatro -->
      <div id="simulation-view" class="view hidden w-full h-full p-4 pb-24 overflow-y-auto flex flex-col"></div>
      <div id="simulation-library-view" class="view hidden w-full h-full p-4 pb-24 overflow-y-auto"></div>
      
      <!-- Vista de Ejercicios de Mentalismo -->
      <div id="mentalism-lab-view" class="view hidden w-full h-full p-4 pb-24 overflow-y-auto"></div>

<div id="mentalism-exercise-view" class="view hidden w-full h-full p-4 pb-24 overflow-y-auto flex flex-col"></div>
      
      <!-- Vista de la Biblioteca de Misiones -->
      <div id="mission-library-view" class="view hidden w-full h-full p-4 pb-24 overflow-y-auto"></div>
      <div id="note-editor-view" class="view hidden w-full h-full p-4 pb-24 overflow-y-auto">
    <header class="flex items-center mb-6">
        <button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button>
        <h1 id="note-editor-title" class="text-2xl font-bold">Crear Nota</h1>
    </header>
    <div class="space-y-4">
        <input type="hidden" id="note-id-input">
        <input type="text" id="note-title-input" placeholder="Título de la nota..." class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-xl text-white focus:ring-2 focus:ring-blue-500 focus:outline-none">
        <textarea id="note-content-input" class="w-full h-64 bg-gray-800 border border-gray-700 rounded-lg p-3 text-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="Escribe aquí tu nota..."></textarea>
        <button onclick="saveNote()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">Guardar Nota</button>
    </div>
</div>
      
      <!-- Vista de la Lista de Misiones de Integración -->
      <div id="integration-mission-library-view" class="view hidden w-full h-full p-4 pb-24 overflow-y-auto"></div>
      
<!-- Vista de la Misiones de Integración -->
<div id="integration-mission-view" class="view hidden w-full h-full p-4 pb-24 overflow-y-auto flex flex-col"></div>
      
      
        <!-- Vista de la Sesión Inmersiva de Relajación -->
        <div id="breathing-session-view" class="view hidden fixed inset-0 bg-gray-900 z-50 flex flex-col items-center justify-center p-4 pb-40 text-center">
    
    <p id="cycle-display" class="text-xl text-gray-400 h-8"></p>
    <p id="unified-timer-display" class="text-8xl font-bold text-white h-28"></p>

    <div id="breathing-visualizer" class="w-48 h-48 bg-blue-500 rounded-full flex items-center justify-center">
        <p id="breathing-instruction" class="text-white text-2xl font-bold">Prepárate...</p>
    </div>

    <div id="detailed-instructions" class="mt-8 h-24">
        <p class="text-gray-300"></p>
    </div>
    
    <div id="action-buttons" class="absolute bottom-10 w-full px-4">
        <button id="retention-btn" class="hidden w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg">ACCIÓN</button>
        <button id="end-session-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg mt-4">Finalizar</button>
    </div>
</div>

        <!-- Vista de la Biblioteca de Retos -->
        <div id="challenge-library-view" class="view hidden w-full h-full p-4 pb-24 overflow-y-auto"></div>

    </div>

    <!-- Menú de Navegación Inferior Fijo -->
    <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-700">
        <div class="flex justify-around max-w-lg mx-auto">
            <button onclick="showTab('inicio')" class="nav-button active flex-1 flex flex-col items-center justify-center p-3 text-gray-400 hover:bg-gray-800 transition-colors"><i data-lucide="home"></i><span class="text-xs mt-1">Inicio</span></button>
            <button onclick="showTab('modulos')" class="nav-button flex-1 flex flex-col items-center justify-center p-3 text-gray-400 hover:bg-gray-800 transition-colors"><i data-lucide="book-open"></i><span class="text-xs mt-1">Módulos</span></button>
            <button onclick="showTab('laboratorio')" class="nav-button flex-1 flex flex-col items-center justify-center p-3 text-gray-400 hover:bg-gray-800 transition-colors"><i data-lucide="flask-conical"></i><span class="text-xs mt-1">Lab</span></button>
          <button onclick="showTab('ajustes')" class="nav-button flex-1 flex flex-col items-center justify-center p-3 text-gray-400 hover:bg-gray-800 transition-colors"><i data-lucide="wind"></i><span class="text-xs mt-1">Santuario</span></button>
            <button onclick="showTab('diario')" class="nav-button flex-1 flex flex-col items-center justify-center p-3 text-gray-400 hover:bg-gray-800 transition-colors"><i data-lucide="notebook-tabs"></i><span class="text-xs mt-1">Diario</span></button>
            
        </div>
    </nav>

    <script>
        // --- Bases de Datos Simuladas ---
        const modules = {
            'lenguaje-corporal': { title: 'Lenguaje Corporal', subtitle: 'El Lector de Cuerpos', icon: 'eye', color: 'blue', levels: { 'Nivel Básico: Los Fundamentos': ['lc-b1', 'lc-b2', 'lc-b3', 'lc-b4'], 'Nivel Intermedio: Señales Clave': ['lc-i1', 'lc-i2', 'lc-i3', 'lc-i4'], 'Nivel Avanzado: Maestría en la Observación': ['lc-a1', 'lc-a2', 'lc-a3']}},
            'pnl': { title: 'PNL', subtitle: 'El Arquitecto de la Mente', icon: 'brain-circuit', color: 'purple', levels: { 'Nivel Básico: Herramientas Esenciales': ['pnl-b1', 'pnl-b2', 'pnl-b3'], 'Nivel Intermedio: Cambio y Percepción': ['pnl-i1', 'pnl-i2', 'pnl-i3'] }},
            'mentalismo': { title: 'Mentalismo', subtitle: 'El Ilusionista de la Conversación', icon: 'wand-2', color: 'indigo', levels: { 'Nivel Básico: Principios de la Influencia': ['men-b1', 'men-b2', 'men-b3'], 'Nivel Intermedio: Deducción y Calibración': ['men-i1', 'men-i2', 'men-i3'] }},
            'hipnosis': { title: 'Hipnosis', subtitle: 'El Guía del Subconsciente', icon: 'wind', color: 'teal', levels: { 'Nivel Básico: Introducción Segura': ['hip-b1', 'hip-b2', 'hip-b3'], 'Nivel Intermedio: Aplicaciones Prácticas': ['hip-i1', 'hip-i2', 'hip-i3'] }},
          'ingenieria-social': { title: 'Ingeniería Social', subtitle: 'El Arquitecto de Relaciones', icon: 'users', color: 'yellow', levels: { 'Nivel Básico: Los Pilares de la Confianza': ['is-b1', 'is-b2', 'is-b3', 'is-b4'], 'Nivel Intermedio: Tácticas de Influencia Ética': ['is-i1', 'is-i2', 'is-i3', 'is-i4'], 'Nivel Avanzado: Estrategias y Aplicaciones Complejas': ['is-a1', 'is-a2', 'is-a3', 'is-a4'] }}
        };

        const lessons = {
            'tecnica-espejo': { title: 'La Técnica del Espejo', content: `<div class="space-y-6"><div><h2 class="text-xl font-semibold text-blue-400 mb-2">1. ¿Qué es? (La Teoría)</h2><p class="text-gray-300">También conocida como 'Rapport' o 'Mirroring', es la práctica de emular sutilmente el lenguaje corporal de otra persona para crear una conexión subconsciente. El cerebro primitivo asocia 'similar' con 'seguro', disolviendo barreras y generando confianza de forma casi instantánea.</p></div><img src="https://placehold.co/600x400/374151/E5E7EB?text=Rapport" class="rounded-lg shadow-lg" alt="Dos personas en una reunión de negocios, mostrando rapport."><div><h2 class="text-xl font-semibold text-blue-400 mb-2">2. ¿Cómo se hace? (La Práctica)</h2><ul class="list-disc list-inside text-gray-300 space-y-2"><li><strong>La Sutileza es la Clave:</strong> No imites, refleja. Espera de 3 a 5 segundos antes de adoptar un gesto.</li><li><strong>De lo General a lo Específico:</strong> Empieza con la postura general (inclinación, cruce de piernas), luego pasa a gestos clave (tocarse la barbilla) y finalmente al tono de voz.</li><li><strong>Acompasa el Ritmo:</strong> Si la persona habla rápido, acelera un poco tu ritmo. Si habla lento, hazlo más pausado.</li></ul></div><div><h2 class="text-xl font-semibold text-blue-400 mb-2">3. Ejemplo en Acción</h2><div class="bg-gray-800 p-4 rounded-lg border border-gray-700"><p class="text-gray-300"><strong class="text-white">Escenario:</strong> Un cliente está con los brazos cruzados, escéptico.</p><p class="text-gray-300 mt-2"><strong class="text-white">Tu Jugada:</strong> En lugar de una postura abierta y agresiva, adopta una postura neutra. Cuando él hable, inclina la cabeza para mostrar escucha. Si él descruza los brazos y pone una mano en la mesa, espera unos segundos y haz un gesto similar. Has creado un puente sin decir una palabra.</p></div></div></div>` },
            'lc-b1': { title: 'La Línea Base', content: `<h2>¿Qué es la Línea Base?</h2><p>Es el comportamiento normal y relajado de una persona. Antes de interpretar un gesto, debes saber cómo actúa esa persona sin estrés. Es tu punto de referencia para detectar cambios significativos.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Colega Nervioso:</b> Tu colega siempre juega con un bolígrafo. Si deja de hacerlo cuando le preguntas por un proyecto, ese cambio es más significativo que el movimiento en sí.</li><li><b>Amigo Tímido:</b> Un amigo que normalmente evita el contacto visual de repente te mira fijamente. Este cambio brusco en su línea base es un dato importante.</li><li><b>Familiar Expresivo:</b> Tu hermano siempre habla con las manos. Si de repente las mete en los bolsillos mientras te cuenta algo, es una señal de que podría estar ocultando información o sintiéndose inseguro.</li></ul>` },
            'lc-b2': { title: 'Proxémica', content: `<h2>La Danza del Espacio</h2><p>La distancia que mantenemos con otros revela nuestra relación y nivel de comodidad. Acercarse puede significar interés; alejarse, incomodidad.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Interés en una Cita:</b> Si dos personas en una cita se inclinan sobre la mesa para estar más cerca, es una fuerte señal de interés mutuo.</li><li><b>Incomodidad en el Trabajo:</b> Si le das feedback a un empleado y este da un paso sutil hacia atrás, está creando distancia, lo que puede indicar que se siente incómodo o en desacuerdo.</li><li><b>Espacio Público:</b> En un autobús casi vacío, una persona que se sienta justo a tu lado está rompiendo una norma social, lo que puede ser percibido como extraño o amenazante.</li></ul>` },
            'lc-b3': { title: 'Posturas de Poder', content: `<h2>Posturas de Poder vs. Sumisión</h2><p>Las posturas expansivas (ocupar espacio) comunican confianza. Las posturas contraídas (encogerse) comunican inseguridad.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>La Pose de "Superman":</b> Antes de una presentación, poner las manos en las caderas y expandir el pecho durante dos minutos puede aumentar químicamente tu confianza.</li><li><b>Sumisión en una Discusión:</b> Una persona que se encorva, cruza los tobillos y mete las manos entre las piernas durante una discusión, está adoptando una postura sumisa y de autoprotección.</li><li><b>Dominancia en una Reunión:</b> El jefe que se reclina en su silla con las manos detrás de la cabeza está mostrando una postura de dominio y control sobre el entorno.</li></ul>` },
            'lc-b4': { title: 'Gestos Abiertos vs. Cerrados', content: `<h2>Gestos Abiertos y Cerrados</h2><p>Mostrar las palmas de las manos es un gesto de apertura y honestidad. Cruzar los brazos crea una barrera física y psicológica.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Negociación Exitosa:</b> Durante una negociación, si tu contraparte empieza con los brazos cruzados pero los descruza a medida que hablas, es una señal de que se está abriendo a tus ideas.</li><li><b>Rechazo de una Idea:</b> En una lluvia de ideas, si un colega cruza los brazos inmediatamente después de que presentas tu propuesta, es una señal no verbal de que la ha rechazado, incluso antes de hablar.</li><li><b>Creando Confianza:</b> Un orador que gesticula con las palmas hacia arriba es percibido como más honesto y creíble por la audiencia.</li></ul>` },
            'lc-i1': { title: 'Gestos Pacificadores', content: `<h2>Detectando Incomodidad</h2><p>Son movimientos inconscientes para calmar el estrés, como tocarse el cuello o frotarse el brazo. Son señales muy fiables de tensión interna.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>El Político en Apuros:</b> Cuando un periodista le hace una pregunta difícil, el político se ajusta el nudo de la corbata. Este gesto ayuda a calmar la ansiedad que siente en el cuello.</li><li><b>El Estudiante que Miente:</b> Un estudiante le dice al profesor que ha hecho los deberes, pero mientras lo dice, se tapa la boca con la mano. Es un intento inconsciente de "bloquear" la mentira.</li><li><b>Nervios en una Cita:</b> Una persona en una cita que se frota constantemente el brazo está tratando de auto-calmarse debido a los nervios o la inseguridad.</li></ul>` },
            'lc-i2': { title: 'Claves de Acceso Ocular', content: `<h2>El Mapa de los Ojos</h2><p>Los movimientos de los ojos pueden indicar si una persona está recordando una imagen, un sonido, o si lo está construyendo (imaginando).</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Recordando una Imagen (Vr):</b> Preguntas "¿Cómo era tu habitación de niño?" y la persona mira arriba a la izquierda para "ver" el recuerdo.</li><li><b>Creando una Imagen (Vc):</b> Preguntas "¿Cómo te verías con el pelo rosa?" y la persona mira arriba a la derecha para "imaginar" la escena.</li><li><b>Diálogo Interno (Ad):</b> Le pides a alguien que piense en qué decir a continuación y mira abajo a la izquierda, "hablando" consigo mismo.</li></ul>` },
            'lc-i3': { title: 'Incongruencia', content: `<h2>Cuando el Cuerpo Grita</h2><p>Ocurre cuando las palabras dicen una cosa y el cuerpo otra (ej. decir "sí" mientras se niega sutilmente con la cabeza). El cuerpo suele decir la verdad.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>El "Sí" Dudoso:</b> Tu amigo acepta ir a un plan diciendo "Sí, me apetece", pero lo acompaña con un ligero encogimiento de hombros. El gesto delata su falta de convicción.</li><li><b>La Disculpa Falsa:</b> Alguien dice "Lo siento mucho" con una sonrisa de desprecio (una comisura del labio se eleva). La microexpresión revela su verdadero sentimiento.</li><li><b>Miedo Oculto:</b> Una persona dice "No tengo miedo" pero sus pupilas están dilatadas y su respiración es superficial. Su fisiología contradice sus palabras.</li></ul>` },
            'lc-i4': { title: 'Gestos con las Manos', content: `<h2>El Significado de las Manos</h2><p>Las manos enfatizan nuestro discurso. Gestos amplios muestran confianza, mientras que esconder las manos puede indicar inseguridad.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>El Gesto de la Confianza (Steeple):</b> Un jefe une las yemas de sus dedos formando una especie de campanario. Este es un gesto de alta confianza y autoridad.</li><li><b>Ocultando las Manos:</b> En una entrevista de trabajo, un candidato que mantiene las manos debajo de la mesa o en los bolsillos puede ser percibido como alguien que oculta algo o que no es de fiar.</li><li><b>Medir con las Manos:</b> Cuando alguien describe el tamaño de algo, la distancia entre sus manos suele ser más honesta que sus palabras.</li></ul>` },
            'lc-a1': { title: 'Microexpresiones Faciales', content: `<h2>Las 7 Emociones Universales</h2><p>Son expresiones faciales extremadamente rápidas (menos de un segundo) que revelan una emoción oculta. Son universales en todas las culturas.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Desprecio Oculto:</b> Le das un cumplido a un rival y, por un instante, una de las comisuras de sus labios se eleva. Es una microexpresión de desprecio.</li><li><b>Miedo Reprimido:</b> Anuncias un cambio en la empresa. Un empleado muestra un flash de miedo (ojos muy abiertos, cejas levantadas) antes de componer una expresión neutra.</li><li><b>Tristeza Verdadera:</b> Un amigo te cuenta que "está bien" después de una ruptura, pero ves un rápido descenso de las comisuras de sus labios. Esa es la verdadera emoción.</li></ul>` },
            'lc-a2': { title: 'Territorios y Barreras', content: `<h2>Barreras en Reuniones</h2><p>Las personas a menudo usan objetos (una taza de café, un portátil) para crear barreras territoriales cuando se sienten inseguras o en desacuerdo.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>El Muro del Portátil:</b> En una reunión, si un colega abre su portátil y lo pone de pie entre tú y él, está creando una barrera, indicando que está menos receptivo.</li><li><b>Reclamando Espacio:</b> Una persona que esparce sus papeles por toda la mesa está reclamando territorio y mostrando una actitud dominante.</li><li><b>La Bolsa en el Asiento:</b> Alguien que pone su bolso o mochila en el asiento de al lado en un lugar público está marcando su territorio para evitar que otros se sienten cerca.</li></ul>` },
            'lc-a3': { title: 'Sincronización Avanzada', content: `<h2>Liderazgo No Verbal</h2><p>Después de establecer rapport (espejo), puedes empezar a "liderar". Si cambias de postura y la otra persona te sigue, has logrado una conexión profunda.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>La Prueba del Vaso de Agua:</b> Después de reflejar sutilmente a tu interlocutor durante unos minutos, coge tu vaso de agua y bebe. Si él hace lo mismo poco después, has establecido un liderazgo no verbal.</li><li><b>Cambiando la Energía del Grupo:</b> En un grupo tenso, si tú (como líder) adoptas conscientemente una postura más relajada y abierta, es probable que los demás empiecen a imitarte y la tensión disminuya.</li><li><b>Cerrando un Trato:</b> En una venta, si después de un buen rapport te inclinas hacia adelante y coges el bolígrafo para firmar, tu cliente será mucho más propenso a imitar el gesto y cerrar el trato.</li></ul>` },
            'pnl-b1': { title: 'Sistemas Representacionales', content: `<h2>VAK: Visual, Auditivo, Kinestésico</h2><p>Las personas procesan el mundo principalmente a través de uno de estos tres canales. Hablar en su "idioma" (ej. "veo lo que dices" a un visual) crea una conexión instantánea.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Venta Visual:</b> A un cliente que dice "Necesito ver el panorama general", le muestras un gráfico claro. Usas su lenguaje: "Como puede ver, la perspectiva es brillante".</li><li><b>Conexión Auditiva:</b> Tu amigo te dice "No me suena bien esa idea". Le respondes: "Te escucho. Dime qué es lo que te hace ruido para que encontremos el tono correcto".</li><li><b>Confianza Kinestésica:</b> Un socio dice "No siento que estemos en la misma página". Le respondes: "Entiendo. ¿Cómo podemos conectar mejor para que sientas una base sólida para avanzar?".</li></ul>` },
            'pnl-b2': { title: 'El Poder del "Sí"', content: `<h2>Creando Momentum de Acuerdo</h2><p>Al hacer una serie de preguntas cuya respuesta obvia es "sí", predispones a la persona a estar de acuerdo contigo en temas más importantes.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>En una Venta:</b> "¿Busca una solución que sea eficiente, verdad? (Sí). Y que le ahorre tiempo, ¿correcto? (Sí). Y que sea fácil de implementar, ¿cierto? (Sí). Excelente, entonces nuestro producto es lo que necesita".</li><li><b>Con un Niño:</b> "¿Quieres terminar rápido para ir a jugar? (Sí). Y para eso hay que hacer los deberes, ¿verdad? (Sí). Entonces, si empezamos ahora, terminaremos antes, ¿no crees? (Sí)".</li><li><b>Planificando en Pareja:</b> "Ambos estamos cansados, ¿verdad? (Sí). Y queremos unas vacaciones para relajarnos, ¿no? (Sí). Entonces, un destino de playa tranquilo sería ideal, ¿cierto? (Sí)".</li></ul>` },
            'pnl-b3': { title: 'Anclajes', content: `<h2>Creando "Botones" Emocionales</h2><p>Un ancla es un estímulo (un gesto, una palabra) que se asocia a un estado emocional. Puedes crear anclas para acceder a estados de confianza o calma a voluntad.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Ancla de Confianza:</b> Antes de una presentación, recuerda un momento de éxito total. En el pico de la emoción, aprieta el pulgar y el índice. Repítelo varias veces. Antes de salir, dispara el ancla (aprieta los dedos) para evocar esa confianza.</li><li><b>Ancla Auditiva:</b> Escuchar una canción específica de tu adolescencia te transporta instantáneamente a esa época. La canción es un ancla auditiva de la nostalgia.</li><li><b>Ancla en Terapia:</b> Un terapeuta puede pedirle a un paciente que recuerde un momento de calma y, en el pico de la sensación, se toque la muñeca. Luego, en momentos de ansiedad, el paciente puede tocarse la muñeca para evocar esa calma.</li></ul>` },
            'pnl-i1': { title: 'Reencuadre', content: `<h2>Cambiando el Significado</h2><p>Ninguna situación tiene un significado inherente. El reencuadre te permite cambiar el "marco" de una experiencia negativa para verla como una oportunidad o un aprendizaje.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>"Fracaso" a "Aprendizaje":</b> En lugar de "El lanzamiento del producto fue un fracaso", reencuadra a "El lanzamiento nos dio datos muy valiosos sobre lo que el mercado no quiere. Ahora sabemos cómo acertar".</li><li><b>"Problema" a "Oportunidad":</b> "Tenemos un problema de logística" se convierte en "Tenemos la oportunidad de rediseñar nuestro sistema logístico para ser mucho más eficientes".</li><li><b>"Estoy Atrapado" a "Tiempo para Mí":</b> "Estoy atrapado en el tráfico" se reencuadra a "Qué bien, tengo 30 minutos sin interrupciones para escuchar mi audiolibro favorito".</li></ul>` },
            'pnl-i2': { title: 'Submodalidades', content: `<h2>Ajustando tu Percepción</h2><p>Son las "cualidades" de tus pensamientos (brillo, tamaño, distancia de una imagen mental). Modificarlas puede cambiar la intensidad de una emoción o recuerdo.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Reducir un Miedo:</b> Visualiza la imagen de lo que te da miedo. Ahora, hazla más pequeña, ponla en blanco y negro y aléjala hasta que sea un punto diminuto. Nota cómo la emoción disminuye.</li><li><b>Aumentar la Motivación:</b> Piensa en tu objetivo cumplido. Haz la imagen mental más grande, más brillante, con colores más vivos y acércala. Siente cómo aumenta tu deseo de alcanzarlo.</li><li><b>Cambiar un Antojo:</b> Visualiza esa comida que se te antoja. Ahora, quítale el color, ponle un olor desagradable y escucha un sonido molesto al morderla. El antojo probablemente disminuirá.</li></ul>` },
            'pnl-i3': { title: 'Meta-Modelo del Lenguaje', content: `<h2>Haciendo las Preguntas Correctas</h2><p>Es un conjunto de preguntas precisas para clarificar información, desafiar generalizaciones y recuperar información omitida en una conversación.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Generalización:</b> "Nadie me valora en el trabajo". Pregunta: "¿Nadie, nunca? ¿Quién específicamente no te valora y cómo lo sabes?".</li><li><b>Omisión:</b> "Estoy frustrado". Pregunta: "¿Frustrado por qué, específicamente?".</li><li><b>Lectura Mental:</b> "Sé que no le caigo bien". Pregunta: "¿Cómo sabes exactamente lo que él está pensando?".</li></ul>` },
            'men-b1': { title: 'Lectura en Frío y Efecto Barnum', content: `<h2>El Arte de la Generalidad</h2><p>La lectura en frío consiste en usar afirmaciones de alta probabilidad que suenan específicas (declaraciones Barnum) para crear la ilusión de que conoces a alguien profundamente.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>En una fiesta:</b> "Pareces una persona sociable y amigable, pero a veces necesitas tu propio espacio para recargar energías". (Aplica a casi todos).</li><li><b>A un colega:</b> "Has pasado por algunas dificultades, pero te han hecho una persona mucho más fuerte y resiliente". (Es una experiencia universal).</li><li><b>A un nuevo conocido:</b> "Valoras mucho la lealtad y te sientes decepcionado cuando la gente no cumple con tus expectativas". (Describe un rasgo humano común).</li></ul>` },
            'men-b2': { title: 'Acompasar y Liderar', content: `<h2>La Danza de la Conversación</h2><p>Primero, acompasas (validas) la realidad y el estado emocional de la persona. Una vez creada la conexión, puedes empezar a liderar la conversación hacia donde deseas.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Cliente Enojado:</b> Acompasas diciendo "Entiendo su frustración, tiene toda la razón en estar molesto". Luego lideras con "Y ahora, esto es lo que vamos a hacer para solucionarlo".</li><li><b>Amigo Triste:</b> Acompasas con un tono de voz suave y una postura similar. "Realmente parece que esto te ha afectado". Luego lideras sutilmente: "Recordemos alguna vez que superaste algo similar...".</li><li><b>Negociación:</b> Acompasas su postura corporal y ritmo de habla. Una vez en sintonía, te inclinas ligeramente hacia adelante para mostrar más interés (lideras) y es probable que te sigan.</li></ul>` },
            'men-b3': { title: 'Forzaje Psicológico', content: `<h2>La Ilusión de la Libre Elección</h2><p>Es el arte de guiar a alguien a una elección predeterminada (un número, una carta, una idea) mientras cree que está eligiendo libremente, usando énfasis sutiles.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>El Menú del Restaurante:</b> Un camarero dice: "¿Les gustaría nuestro famoso filete o el salmón?". Al describir el filete, su tono es más entusiasta y hace un gesto con la mano. Es más probable que elijas el filete.</li><li><b>Elección de un Número:</b> "Piensa en un número del 1 al 4. El 1 y el 4 son muy obvios... ¿ya tienes uno?". Esto empuja sutilmente hacia el 2 o el 3.</li><li><b>Plan de Fin de Semana:</b> "¿Quieres ir al cine o hacemos esa caminata por la montaña que tanto nos gusta y respiramos aire fresco?". La segunda opción está cargada de lenguaje positivo, forzando la elección.</li></ul>` },
            'men-i1': { title: 'Calibración Aguda', content: `<h2>Leyendo Cambios de Estado</h2><p>La calibración es la habilidad de notar los cambios fisiológicos mínimos (respiración, color de la piel, tensión muscular) que indican un cambio en el estado emocional de una persona.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Señal de Interés:</b> Durante una venta, al mencionar el precio, notas que las pupilas del cliente se dilatan ligeramente. Es una señal de alto interés o excitación.</li><li><b>Detectando Tensión:</b> Hablas de un tema delicado y observas que la mandíbula de tu interlocutor se tensa y su respiración se vuelve más superficial. Has detectado un punto de estrés.</li><li><b>Cambio de Opinión:</b> En una discusión, la persona pasa de tener los labios apretados a relajarlos. Es un indicador de que su resistencia está disminuyendo.</li></ul>` },
            'men-i2': { title: 'El Principio de la Rata de Laboratorio', content: `<h2>La Gente Quiere Ayudar</h2><p>La gente inconscientemente quiere que aciertes. Si lanzas una idea general, buscarán en su mente ejemplos que la confirmen, dándote más información para continuar.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>La Declaración del Viaje:</b> Dices "Siento que has estado pensando mucho en un viaje". La persona responde "¡Sí! ¿Cómo lo supiste? Quiero ir a la playa". Te ha dado el detalle específico.</li><li><b>La Conexión Artística:</b> "Percibo una conexión con la música o el arte en tu pasado". La persona dice "Bueno, de pequeño tocaba el piano". Ahora puedes explorar ese tema.</li><li><b>La Decisión Pendiente:</b> "Últimamente ha habido una decisión importante rondando tu mente". Es muy probable que la persona confirme y te diga si es sobre trabajo, familia, etc.</li></ul>` },
            'men-i3': { title: 'Sugestión e Implantación de Ideas', content: `<h2>Sembrando Pensamientos</h2><p>A través del lenguaje y la presuposición, puedes "plantar" una idea en la mente de alguien de forma tan sutil que crea que la idea fue suya.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>La Presuposición:</b> En lugar de "¿Quieres salir este fin de semana?", preguntas "¿Prefieres que salgamos el viernes o el sábado?". Das por hecho que saldréis.</li><li><b>La Orden Encubierta:</b> Dices "Es fácil para una persona inteligente como tú **darse cuenta de la oportunidad** que esto representa". La orden está en negrita.</li><li><b>El Poder de la Negación:</b> "No tienes por qué sentirte completamente relajado ahora mismo...". El subconsciente ignora el "no" y procesa la instrucción de relajarse.</li></ul>` },
            'hip-b1': { title: 'Mitos y Verdades del Trance', content: `<h2>¿Qué es el Trance?</h2><p>No es control mental ni estar dormido. El trance es un estado natural de enfoque intenso, similar a estar absorto en una película. La hipnosis simplemente induce este estado a propósito para comunicarnos con el subconsciente.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Conducir en "Piloto Automático":</b> Cuando llegas a tu destino sin recordar conscientemente partes del trayecto. Tu subconsciente estaba al mando.</li><li><b>Absorto en una Película:</b> Estás tan inmerso en la trama que no escuchas a alguien que te llama por tu nombre. Estás en un trance ligero.</li><li><b>Soñar Despierto:</b> Cuando tu mente divaga y te pierdes en tus pensamientos, estás experimentando un estado de trance natural.</li></ul>` },
            'hip-b2': { title: 'El Lenguaje Hipnótico', content: `<h2>El Modelo Milton</h2><p>Es un estilo de comunicación "artísticamente vago" que utiliza sugestiones indirectas y presuposiciones. Permite que la persona llene los espacios con su propia experiencia, reduciendo la resistencia.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Presuposición:</b> "No sé qué tan rápido te darás cuenta de lo relajado que te sientes". (Presupone que te sentirás relajado, la única duda es cuándo).</li><li><b>Causa-Efecto Implícita:</b> "Escuchar el sonido de mi voz puede hacer que tu respiración se vuelva más profunda y tranquila". (Conecta dos ideas que no están necesariamente relacionadas).</li><li><b>Lectura Mental:</b> "Sé que te estás preguntando si esto funcionará para ti". (Valida el posible escepticismo del oyente y lo normaliza).</li></ul>` },
            'hip-b3': { title: 'Inducción de Manos Magnéticas', content: `<h2>Tu Primer Ejercicio Práctico</h2><p>Es una inducción clásica y segura donde se guía a una persona a sentir una fuerza magnética entre sus manos. Demuestra de forma poderosa la conexión mente-cuerpo.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Enfoque en la Imaginación:</b> "Imagina que en cada palma tienes un imán increíblemente potente... siente esa energía...".</li><li><b>Uso de Fenómenos Fisiológicos:</b> "Puedes empezar a notar un ligero hormigueo o calor en las manos, y eso es una señal de que la conexión se está creando...".</li><li><b>Sugestión de Inevitabilidad:</b> "...y tus manos se acercan más y más, por sí solas, sin que tengas que hacer nada conscientemente...".</li></ul>` },
            'hip-i1': { title: 'Auto-Hipnosis para el Enfoque', content: `<h2>Programando tu Mente</h2><p>Aprender a guiarte a ti mismo a un estado de trance te permite darte sugestiones positivas para mejorar la concentración, la relajación o la motivación.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Para Estudiar:</b> Entras en un trance ligero y te dices a ti mismo: "Cada palabra que leo se queda grabada en mi mente. Mi concentración es total y absoluta".</li><li><b>Para Dormir:</b> Te guías a un estado de relajación profunda y te das la sugestión: "Con cada respiración, mi cuerpo y mi mente se preparan para un sueño profundo y reparador".</li><li><b>Para el Deporte:</b> Antes de un partido, visualizas la jugada perfecta y te anclas la sensación de éxito, diciéndote: "Mi cuerpo sabe exactamente qué hacer. Confío en mis instintos".</li></ul>` },
            'hip-i2': { title: 'Inducciones Conversacionales', content: `<h2>Hipnosis sin que Parezca Hipnosis</h2><p>Es el arte de usar patrones de lenguaje hipnótico en una conversación normal para guiar el estado emocional y el enfoque de una persona de manera sutil y ética.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>En una Venta:</b> "No te pido que tomes una decisión ahora... solo imagina por un momento la tranquilidad que sentirás cuando este problema esté resuelto". (Guía a la persona a un estado emocional futuro).</li><li><b>Ayudando a un Amigo:</b> "Recuerdo una vez que te sentías así y encontraste una fuerza interior increíble. Quizás puedas empezar a recordar cómo se sentía eso...". (Dirige su atención hacia recursos internos).</li><li><b>En una Negociación:</b> "Mientras hablamos de los detalles, puedes empezar a sentirte más y más cómodo con la idea de que podemos llegar a un acuerdo beneficioso para ambos".</li></ul>` },
            'hip-i3': { title: 'Creación de Metáforas', content: `<h2>Contando Historias que Sanan</h2><p>El subconsciente ama las historias. Aprender a construir metáforas que reflejen el problema de una persona y ofrezcan una solución puede generar cambios profundos.</p><h3 class="font-semibold mt-4 mb-2">Ejemplos Prácticos:</h3><ul class="list-disc list-inside"><li><b>Para la Procrastinación:</b> "Es como un gran barco en el puerto. Tiene todo lo necesario para zarpar, pero sigue esperando el 'momento perfecto'. A veces, solo necesita que el capitán (tú) levante el ancla para empezar el viaje".</li><li><b>Para la Ansiedad Social:</b> "Imagina que cada persona es un libro en una biblioteca. Al principio, solo ves las portadas, algunas intimidantes. Pero cuando te atreves a abrir uno, descubres una historia fascinante que te enriquece".</li><li><b>Para Superar un Obstáculo:</b> "Un río no lucha contra una roca en su camino. Simplemente, fluye a su alrededor, la rodea, y sigue su curso hacia el mar, volviéndose más fuerte. Tú puedes ser como ese río".</li></ul>` },
          'is-b1': { 
    title: 'El Principio de Reciprocidad', 
    content: `<div class="space-y-6">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">1. ¿Qué es? (La Regla Social Implícita)</h2>
            <p class="text-gray-300">El principio de reciprocidad es una de las reglas más poderosas y arraigadas del comportamiento humano. Dicta que nos sentimos obligados a devolver, de alguna forma, lo que otra persona nos ha proporcionado primero. Ya sea un favor, un regalo, una concesión o una ayuda, se genera una sensación de "deuda" psicológica que anhelamos saldar. La clave es que el favor inicial debe sentirse genuino y desinteresado para activar este resorte social.</p>
        </div>
        <img src="https://placehold.co/600x400/374151/E5E7EB?text=Reciprocidad" class="rounded-lg shadow-lg" alt="Dos personas intercambiando un gesto de ayuda, simbolizando la reciprocidad.">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">2. ¿Cómo se aplica éticamente? (La Práctica)</h2>
            <ul class="list-disc list-inside text-gray-300 space-y-2">
                <li><strong>Sé el primero en dar:</strong> No esperes a que te pidan ayuda. Ofrece información útil, un cumplido sincero, una pequeña ayuda con una tarea. Da valor sin esperar nada a cambio de inmediato.</li>
                <li><strong>Asegúrate de que sea significativo:</strong> El valor no es monetario. Un favor personalizado y meditado (recordar algo que le gusta a alguien) tiene un impacto mucho mayor que un gesto genérico.</li>
                <li><strong>Crea un sentimiento de sorpresa:</strong> Un favor o regalo inesperado es mucho más poderoso. Rompe los patrones y genera un impacto emocional positivo.</li>
                <li><strong>No lo conviertas en una transacción:</strong> Nunca digas "te di esto, ahora me debes aquello". El principio funciona a nivel subconsciente. Verbalizarlo lo destruye y lo convierte en un burdo intercambio.</li>
            </ul>
        </div>
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">3. Ejemplos en Acción</h2>
            <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 space-y-3">
                <p class="text-gray-300"><strong class="text-white">Escenario Profesional:</strong> Un compañero de otro departamento está agobiado con un informe. Tú, que tienes experiencia en ese tema, le dedicas 20 minutos a darle un par de ideas clave que le desbloquean. Semanas más tarde, cuando necesitas urgentemente datos de su departamento, esa persona no solo te los dará, sino que probablemente priorizará tu petición sobre otras.</p>
                <p class="text-gray-300"><strong class="text-white">Escenario Social:</strong> Recuerdas que a un amigo le apasiona un tema muy específico. Un día, ves un artículo online muy interesante sobre ello, lo guardas y se lo envías con un mensaje como "Vi esto y me acordé de ti, ¡pensé que te gustaría!". Has fortalecido la relación y has creado un fuerte deseo en tu amigo de corresponderte de alguna manera.</p>
                 <p class="text-gray-300"><strong class="text-white">Escenario de Negociación:</strong> Un cliente potencial recibe una propuesta tuya. Antes de que responda, le envías un informe de mercado que puede serle útil para su negocio (sin relación directa con tu venta). Le estás proporcionando valor de forma proactiva, lo que te diferencia de la competencia y le predispone a ver tu propuesta con mejores ojos.</p>
            </div>
        </div>
    </div>` 
},
  'is-b2': { 
    title: 'Pretexto y Justificación Legítima', 
    content: `<div class="space-y-6">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">1. ¿Qué es? (El Poder del "Porque")</h2>
            <p class="text-gray-300">En 1978, un famoso estudio de la psicóloga Ellen Langer demostró algo asombroso: las personas están mucho más dispuestas a cumplir una petición si se les da una razón, sin importar cuán obvia sea. La palabra "porque" activa un resorte mental de cumplimiento automático. Nuestro cerebro está programado para buscar causas y efectos, y al proporcionar una justificación, satisfacemos esa necesidad y reducimos la resistencia, haciendo que nuestra petición parezca más legítima y menos arbitraria.</p>
        </div>
        <img src="https://placehold.co/600x400/374151/E5E7EB?text=Porque..." class="rounded-lg shadow-lg" alt="Una persona explicando sus razones a otra, que asiente comprensivamente.">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">2. ¿Cómo se aplica? (La Práctica)</h2>
            <ul class="list-disc list-inside text-gray-300 space-y-2">
                <li><strong>Usa siempre una razón:</strong> Acostúmbrate a añadir un "porque" a tus peticiones, especialmente a las pequeñas. "Disculpa, ¿puedo pasar antes?, <strong class="text-yellow-300">porque</strong> tengo una reunión en cinco minutos".</li>
                <li><strong>La calidad de la razón importa en peticiones grandes:</strong> Para peticiones pequeñas, casi cualquier razón funciona. Para peticiones más grandes o importantes, la justificación debe ser lógica y sólida.</li>
                <li><strong>Enfoca la razón en el beneficio para el otro:</strong> La justificación más poderosa es la que implica un beneficio para la otra persona. "Me gustaría que revisaras este borrador ahora, <strong class="text-yellow-300">porque</strong> así podremos adelantar el trabajo y salir todos a nuestra hora el viernes".</li>
                <li><strong>Crea un pretexto creíble:</strong> Un pretexto es una razón preparada para una interacción. Sirve para iniciar una conversación o hacer una petición de forma natural. "¿Puedo hacerte una pregunta rápida? <strong class="text-yellow-300">Porque</strong> veo que sabes mucho de este tema y valoro tu opinión".</li>
            </ul>
        </div>
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">3. Ejemplos en Acción</h2>
            <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 space-y-3">
                <p class="text-gray-300"><strong class="text-white">Escenario de Oficina (Petición pequeña):</strong> Quieres usar la impresora, pero hay alguien delante. En lugar de esperar en silencio, dices: "Disculpa, ¿te importaría si imprimo solo esta hoja? <strong class="text-yellow-300">Porque</strong> es para el jefe y me la está pidiendo ahora mismo". La probabilidad de que te dejen pasar aumenta drásticamente.</p>
                <p class="text-gray-300"><strong class="text-white">Escenario de Venta (Beneficio para el cliente):</strong> Quieres que un cliente se decida pronto. En lugar de presionar, justificas: "Te recomiendo que tomemos la decisión esta semana, <strong class="text-yellow-300">porque</strong> así puedo asegurarte la entrega antes de fin de mes y podrás empezar a ver resultados cuanto antes".</p>
                 <p class="text-gray-300"><strong class="text-white">Escenario Social (Iniciar conversación):</strong> Ves a alguien interesante en un evento. En lugar de un simple "hola", creas un pretexto: "Disculpa que te moleste, he visto que estabas hablando de [tema X] y me he acercado, <strong class="text-yellow-300">porque</strong> es un tema que me apasiona y rara vez encuentro a alguien con quien hablar de ello".</p>
            </div>
        </div>
    </div>` 
},
  'is-b3': { 
    title: 'Elicitación: El Arte de Escuchar lo que no se Dice', 
    content: `<div class="space-y-6">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">1. ¿Qué es? (Pescar Información con Sutileza)</h2>
            <p class="text-gray-300">La elicitación es el conjunto de técnicas para obtener información de una persona o grupo de manera indirecta, sin hacer preguntas directas que puedan activar sus defensas. En lugar de preguntar "¿A qué te dedicas?", utilizas afirmaciones o preguntas abiertas que invitan a la otra persona a compartir detalles de forma natural. Es el arte de guiar una conversación para que la información que buscas simplemente "aparezca", haciendo que la otra persona sienta que está compartiendo voluntariamente.</p>
        </div>
        <img src="https://placehold.co/600x400/374151/E5E7EB?text=Elicitaci%C3%B3n" class="rounded-lg shadow-lg" alt="Dos personas en una conversación profunda y natural en una cafetería.">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">2. Técnicas Clave de Elicitación (La Práctica)</h2>
            <ul class="list-disc list-inside text-gray-300 space-y-2">
                <li><strong>Afirmaciones Provocadoras:</strong> Haz una afirmación que sea ligeramente incorrecta o controvertida. La gente tiene un impulso natural por corregir a los demás. Ejemplo: "He oído que es casi imposible conseguir un ascenso en tu empresa". Probablemente te responderán con detalles sobre cómo funciona el proceso.</li>
                <li><strong>Asumir Conocimiento:</strong> Habla como si ya supieras algo sobre un tema. "Con lo complicado que está el mercado de [su sector], seguro que ha sido un año de retos". Esto invita a la persona a darte detalles específicos sobre esos "retos".</li>
                <li><strong>Compartir para Recibir:</strong> Ofrece un poco de información tuya, a menudo personal pero inofensiva, para que la otra persona se sienta cómoda correspondiendo con información similar. "Estoy agotado, mi nuevo proyecto me tiene trabajando hasta tarde. ¿Tú también andas muy liado?".</li>
                <li><strong>Elogio y Reconocimiento:</strong> Un elogio sincero puede abrir puertas. "Tu presentación fue brillante, la forma en que manejaste los datos fue impresionante. Debe llevar años dominar eso". Esto puede llevarlos a hablar de su experiencia, formación y tiempo en la empresa.</li>
            </ul>
        </div>
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">3. Ejemplos en Acción</h2>
            <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 space-y-3">
                <p class="text-gray-300"><strong class="text-white">Objetivo: Saber si un colega busca otro trabajo.</strong><br>
                <strong class="text-yellow-300">Técnica:</strong> Afirmación Provocadora / Compartir para recibir.<br>
                <strong class="text-white">Tú dices:</strong> "He visto que varios reclutadores de LinkedIn andan muy activos últimamente, deben estar ofreciendo cosas muy interesantes. Con lo bueno que eres, seguro que te han llovido las ofertas, aunque tal y como está el mercado, es para pensárselo". Dejas la puerta abierta para que confirme, niegue o comparta su propia experiencia.</p>
                
                <p class="text-gray-300"><strong class="text-white">Objetivo: Entender las prioridades de un cliente potencial.</strong><br>
                <strong class="text-yellow-300">Técnica:</strong> Asumir Conocimiento.<br>
                <strong class="text-white">Tú dices:</strong> "Imagino que ahora mismo, con el final del trimestre, vuestra máxima prioridad será optimizar los costes de producción antes que explorar nuevos mercados, ¿verdad?". Esta afirmación casi les obliga a corregirte o matizar, dándote información valiosísima sobre sus verdaderas prioridades.</p>

                <p class="text-gray-300"><strong class="text-white">Objetivo: Conocer los hobbies de alguien en un evento social.</strong><br>
                <strong class="text-yellow-300">Técnica:</strong> Compartir para recibir.<br>
                <strong class="text-white">Tú dices:</strong> "Este fin de semana por fin tengo tiempo para una buena ruta en bici, que falta me hace para desconectar. ¿Tú tienes algún plan para recargar pilas?". Es una forma mucho más natural y efectiva que preguntar "¿Qué hobbies tienes?".</p>
            </div>
        </div>
    </div>` 
},
  'is-b4': { 
    title: 'Validación y Escucha Activa', 
    content: `<div class="space-y-6">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">1. ¿Qué es? (El Superpoder de Hacer Sentir Escuchado)</h2>
            <p class="text-gray-300">La escucha activa no es simplemente oír palabras; es el esfuerzo consciente por entender el mensaje completo que se está comunicando, tanto verbal como no verbalmente. La validación es el paso siguiente: comunicar a la otra persona que lo que siente y piensa es comprensible y legítimo desde su perspectiva (incluso si no estás de acuerdo). Cuando alguien se siente verdaderamente escuchado y validado, sus defensas bajan, la confianza se dispara y la conexión se vuelve genuina. Es la forma más rápida de desarmar la hostilidad y construir rapport.</p>
        </div>
        <img src="https://placehold.co/600x400/374151/E5E7EB?text=Escucha+Activa" class="rounded-lg shadow-lg" alt="Una persona escuchando atentamente a otra, mostrando empatía y conexión.">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">2. Las 3 Herramientas de la Escucha Activa (La Práctica)</h2>
            <ul class="list-disc list-inside text-gray-300 space-y-2">
                <li><strong>Parafraseo:</strong> Repite la idea principal de la otra persona con tus propias palabras. Esto demuestra que has entendido. Ejemplo: "Entonces, si no he entendido mal, lo que más te preocupa es que el plazo de entrega es demasiado ajustado, ¿correcto?".</li>
                <li><strong>Etiquetado Emocional:</strong> Dale un nombre a la emoción que percibes. Conecta directamente con el Lenguaje Corporal y la Calibración. Ejemplo: "Parece que este tema te genera bastante frustración" o "Suenas muy entusiasmado con esta nueva oportunidad".</li>
                <li><strong>Silencio Estratégico:</strong> No te apresures a llenar cada pausa. Unos segundos de silencio después de que alguien ha hablado le invitan a seguir, a profundizar y a compartir más de lo que pretendía inicialmente. Es una señal de que estás procesando, no solo esperando tu turno para hablar.</li>
            </ul>
        </div>
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">3. Ejemplos en Acción</h2>
            <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 space-y-3">
                <p class="text-gray-300"><strong class="text-white">Escenario: Un cliente se queja airadamente de un problema.</strong><br>
                <strong class="text-yellow-300">Técnica:</strong> Etiquetado + Parafraseo.<br>
                <strong class="text-white">Respuesta Ineficaz:</strong> "Cálmese, vamos a ver qué pasa".<br>
                <strong class="text-white">Respuesta Maestra:</strong> "Entiendo perfectamente su <strong class="text-yellow-300">(Etiquetado)</strong> enfado. Si he entendido bien, <strong class="text-yellow-300">(Parafraseo)</strong> usted esperaba recibir el producto el martes y todavía no ha llegado, lo cual ha retrasado todo su proyecto. Tiene toda la razón en estar molesto. Déjeme ver ahora mismo qué ha pasado".</p>
                
                <p class="text-gray-300"><strong class="text-white">Escenario: Un amigo te cuenta un problema personal de forma vaga.</strong><br>
                <strong class="text-yellow-300">Técnica:</strong> Etiquetado + Silencio Estratégico.<br>
                <strong class="text-white">Tú dices:</strong> "Suena a que ha sido una situación realmente <strong class="text-yellow-300">decepcionante</strong> para ti...". Y luego, te callas <strong class="text-yellow-300">(Silencio)</strong>. Miras con atención y asientes levemente. Casi con total seguridad, tu amigo llenará ese silencio con los detalles importantes que antes omitió.</p>

                <p class="text-gray-300"><strong class="text-white">Escenario: En una reunión, un colega expone una idea con la que no estás de acuerdo.</strong><br>
                <strong class="text-yellow-300">Técnica:</strong> Parafraseo para asegurar la comprensión.<br>
                <strong class="text-white">En lugar de atacar la idea, validas:</strong> "Ok, déjame asegurarme de que lo he captado bien. <strong class="text-yellow-300">Tu propuesta es</strong> centralizar los informes en un nuevo software para que todos tengamos acceso en tiempo real y así mejorar la coordinación. ¿Es esa la idea principal?". Una vez que confirma, puedes presentar tus dudas o alternativas sobre una base de entendimiento mutuo, no de confrontación.</p>
            </div>
        </div>
    </div>` 
},
  'is-i1': { 
    title: 'Compromiso y Coherencia', 
    content: `<div class="space-y-6">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">1. ¿Qué es? (La Obsesión por Ser Consecuente)</h2>
            <p class="text-gray-300">Este principio describe nuestro deseo casi obsesivo de ser (y parecer) coherentes con nuestras decisiones pasadas. Una vez que tomamos una postura o hacemos una elección, especialmente si es de forma pública, nos enfrentamos a una fuerte presión interna y externa para comportarnos de manera consecuente con ese compromiso inicial. Actúa como un piloto automático: en lugar de reevaluar cada situación, simplemente actuamos de acuerdo a nuestras decisiones previas. Es una trampa mental en la que caemos constantemente.</p>
        </div>
        <img src="https://placehold.co/600x400/374151/E5E7EB?text=Compromiso" class="rounded-lg shadow-lg" alt="Una persona firmando un documento, simbolizando un compromiso activo.">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">2. Claves para Aplicarlo (La Práctica)</h2>
            <ul class="list-disc list-inside text-gray-300 space-y-2">
                <li><strong>La Técnica del "Pie en la Puerta":</strong> Es la táctica por excelencia. Comienza con una petición muy pequeña y fácil de aceptar. Una vez que la persona ha dicho "sí" a eso, estará mucho más predispuesta a aceptar una petición más grande y relacionada, porque negarse sería incoherente con su acción inicial.</li>
                <li><strong>Busca un Compromiso Activo:</strong> Los compromisos son más poderosos si son activos en lugar de pasivos. Es más efectivo que alguien escriba algo, levante la mano o realice una pequeña acción a que simplemente lo piense.</li>
                <li><strong>Hazlo Público:</strong> Un compromiso expresado en público (frente a otros) es el más potente de todos. Nadie quiere ser visto como una persona inconsistente o poco fiable.</li>
                <li><strong>El Esfuerzo Justifica la Decisión:</strong> Cuanto más esfuerzo requiere un compromiso (tiempo, dinero, sacrificio), más lo valoramos y más nos aferramos a él para justificar el esfuerzo invertido.</li>
            </ul>
        </div>
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">3. Ejemplos en Acción</h2>
            <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 space-y-3">
                <p class="text-gray-300"><strong class="text-white">Escenario de Venta:</strong> Un vendedor de coches no te pide que lo compres. Primero te hace una petición pequeña: "¿Le gustaría probarlo? Sin compromiso". <strong class="text-yellow-300">(Pie en la puerta)</strong>. Una vez que lo conduces <strong class="text-yellow-300">(compromiso activo y con esfuerzo)</strong>, ya has empezado a verte como el dueño. Rechazar la compra se vuelve psicológicamente más difícil.</p>
                
                <p class="text-gray-300"><strong class="text-white">Escenario Laboral:</strong> Quieres que tu equipo adopte un nuevo método de trabajo. En lugar de imponerlo, preguntas en una reunión: "¿Todos estamos de acuerdo en que nuestro objetivo es ser más eficientes?". Todos levantarán la mano <strong class="text-yellow-300">(compromiso público y activo)</strong>. Luego presentas tu método como la solución lógica para alcanzar esa eficiencia que todos acaban de aceptar como objetivo.</p>

                <p class="text-gray-300"><strong class="text-white">Escenario de Desarrollo Personal:</strong> Quieres empezar a hacer ejercicio. Si solo lo piensas, es fácil fallar. Si se lo cuentas a tus amigos <strong class="text-yellow-300">(público)</strong>, escribes tus metas en un papel <strong class="text-yellow-300">(activo)</strong> y pagas un mes de gimnasio por adelantado <strong class="text-yellow-300">(esfuerzo)</strong>, has creado una poderosa red de coherencia que te obligará a mantener el compromiso.</p>
            </div>
        </div>
    </div>` 
},
  'is-i2': { 
    title: 'Prueba Social: La Fuerza del Grupo', 
    content: `<div class="space-y-6">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">1. ¿Qué es? (La Seguridad de los Números)</h2>
            <p class="text-gray-300">El principio de prueba social describe nuestra tendencia a considerar que un comportamiento es más correcto si vemos que otras personas lo están realizando. Es un atajo mental: si mucha gente lo hace, debe ser por una buena razón. Actuamos como un rebaño porque, evolutivamente, desviarse del grupo era peligroso. Este principio es especialmente poderoso en momentos de incertidumbre; cuando no estamos seguros de qué hacer, miramos a los demás para que nos guíen.</p>
        </div>
        <img src="https://placehold.co/600x400/374151/E5E7EB?text=Prueba+Social" class="rounded-lg shadow-lg" alt="Una multitud de personas eligiendo el mismo camino, simbolizando la prueba social.">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">2. Formas de Aplicarla (La Práctica)</h2>
            <ul class="list-disc list-inside text-gray-300 space-y-2">
                <li><strong>Muestra Testimonios y Reseñas:</strong> Es la forma más clásica. Las valoraciones online, los casos de éxito y las citas de clientes satisfechos son prueba social pura. Su poder aumenta si el testimonio es de alguien similar al público objetivo.</li>
                <li><strong>Usa la Fuerza de los Números:</strong> "Más de 50,000 descargas". "Únete a los 10,000 profesionales que ya confían en nosotros". Las cifras grandes implican que la decisión es segura y acertada.</li>
                <li><strong>Destaca la Popularidad:</strong> Señalar un producto como "El más vendido" o un plan como "El más popular" utiliza la prueba social para guiar la elección del cliente, eliminando la parálisis por análisis.</li>
                <li><strong>La Prueba Social de los Expertos:</strong> Si una figura de autoridad o un experto en la materia respalda tu idea o producto, su credibilidad se transfiere, proporcionando una poderosa prueba social.</li>
            </ul>
        </div>
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">3. Ejemplos en Acción</h2>
            <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 space-y-3">
                <p class="text-gray-300"><strong class="text-white">Escenario Online:</strong> Estás dudando entre dos productos casi idénticos en Amazon. Uno tiene 12 reseñas y el otro tiene 4,500 con una media de 4.8 estrellas. Casi con total seguridad, elegirás el segundo. La incertidumbre se disipa por la prueba social masiva.</p>
                
                <p class="text-gray-300"><strong class="text-white">Escenario Social:</strong> Llegas a una ciudad nueva y buscas un sitio para cenar. Ves dos restaurantes, uno al lado del otro. Uno está casi vacío y el otro tiene una fila de gente esperando. La mayoría de la gente interpretará que el restaurante concurrido es mejor y estará dispuesta a esperar.</p>

                <p class="text-gray-300"><strong class="text-white">Escenario Laboral:</strong> Quieres convencer a tu jefe para implementar una nueva estrategia de marketing. En lugar de solo dar tu opinión, presentas un informe que dice: "Nuestros tres principales competidores ya han implementado con éxito una estrategia similar este año, aumentando su cuota de mercado en un promedio del 15%". El miedo a quedarse atrás (basado en la prueba social de los competidores) es un motivador muy poderoso.</p>
            </div>
        </div>
    </div>` 
},
  'is-i3': { 
    title: 'Simpatía y Afinidad (Liking)', 
    content: `<div class="space-y-6">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">1. ¿Qué es? (La Conexión que Persuade)</h2>
            <p class="text-gray-300">Este principio establece que somos mucho más propensos a decir "sí" a las peticiones de alguien que conocemos y que nos agrada. La simpatía actúa como un lubricante social que reduce la fricción en las interacciones. Cuando sentimos una conexión o afinidad con alguien, bajamos la guardia, confiamos más y estamos más dispuestos a colaborar. No es solo cuestión de amistad; se puede generar un sentimiento de afinidad de manera rápida y ética para facilitar la comunicación.</p>
        </div>
        <img src="https://placehold.co/600x400/374151/E5E7EB?text=Afinidad" class="rounded-lg shadow-lg" alt="Dos personas riendo y conectando en un ambiente relajado.">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">2. Los 4 Pilares de la Simpatía (La Práctica)</h2>
            <ul class="list-disc list-inside text-gray-300 space-y-2">
                <li><strong>Similaridad:</strong> Nos gustan las personas que son como nosotros. Busca puntos en común genuinos: aficiones, orígenes, opiniones, forma de vestir, etc. La técnica del "Espejo" (Rapport) del módulo de Lenguaje Corporal es una forma de crear similaridad a nivel no verbal.</li>
                <li><strong>Elogios y Cumplidos:</strong> Nos encanta recibir halagos y, por extensión, nos agradan las personas que nos los hacen. Un cumplido sincero sobre una habilidad, una decisión o incluso un accesorio de alguien puede ser increíblemente efectivo.</li>
                <li><strong>Contacto y Cooperación:</strong> Nos gustan más las personas con las que tenemos un contacto familiar y con las que trabajamos hacia metas comunes. Estar en el mismo "equipo", incluso de forma temporal, crea un vínculo de unidad.</li>
                <li><strong>Asociación Positiva:</strong> Nuestra mente crea conexiones. Si te asocias con cosas positivas (buen humor, éxito, soluciones), la gente te verá de forma más positiva. Es el motivo por el que las marcas usan a famosos en sus anuncios.</li>
            </ul>
        </div>
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">3. Ejemplos en Acción</h2>
            <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 space-y-3">
                <p class="text-gray-300"><strong class="text-white">Escenario de Venta:</strong> Un buen vendedor no habla solo del producto. Busca puntos en común <strong class="text-yellow-300">(similaridad)</strong>: "¿Así que también eres de [ciudad]? ¡Qué coincidencia!". O elogia una decisión pasada del cliente: "La elección que hicisteis con vuestro proveedor anterior fue muy inteligente en su momento <strong class="text-yellow-300">(elogio)</strong>".</p>
                
                <p class="text-gray-300"><strong class="text-white">Escenario de Negociación:</strong> Antes de empezar a negociar los puntos difíciles, un buen negociador busca un objetivo común: "Ambos queremos que este proyecto sea un éxito y beneficie a nuestras empresas, ¿verdad? <strong class="text-yellow-300">(cooperación)</strong>". Esto cambia el marco de "tú contra mí" a "nosotros contra el problema".</p>

                <p class="text-gray-300"><strong class="text-white">Escenario Social:</strong> Para conectar con alguien nuevo en un grupo, busca algo que admirar sinceramente: "Me ha encantado la forma en que has explicado ese tema tan complejo <strong class="text-yellow-300">(elogio)</strong>". Luego, busca un punto en común: "A mí también me apasiona [tema relacionado] <strong class="text-yellow-300">(similaridad)</strong>". La conexión se establece casi de inmediato.</p>
            </div>
        </div>
    </div>` 
},
  'is-i4': { 
    title: 'El Principio de Autoridad', 
    content: `<div class="space-y-6">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">1. ¿Qué es? (La Deferencia al Experto)</h2>
            <p class="text-gray-300">Desde pequeños, se nos enseña que obedecer a la autoridad legítima es correcto y desobedecer es incorrecto. Este principio describe nuestra tendencia a seguir las directrices de figuras que percibimos como expertas o con autoridad. El famoso y controvertido experimento de Stanley Milgram demostró que la gente estaba dispuesta a infligir un dolor extremo a otros simplemente porque una persona con una bata de científico se lo ordenaba. Confiamos en los expertos para que nos guíen, cediendo nuestra propia capacidad de decisión.</p>
        </div>
        <img src="https://placehold.co/600x400/374151/E5E7EB?text=Autoridad" class="rounded-lg shadow-lg" alt="Una persona con bata de doctor explicando algo a un paciente, simbolizando autoridad.">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">2. Los Símbolos de la Autoridad (La Práctica Ética)</h2>
            <p class="text-gray-300">La autoridad no se impone, se proyecta. La clave ética es construir una autoridad genuina basada en tu conocimiento real. Los siguientes son símbolos que la gente usa para evaluar la autoridad:</p>
            <ul class="list-disc list-inside text-gray-300 space-y-2 mt-2">
                <li><strong>Títulos y Credenciales:</strong> Un "Dr." antes del nombre, un diploma en la pared, o certificaciones profesionales (PMP, CFA) son atajos que comunican conocimiento y estatus.</li>
                <li><strong>Vestimenta y Apariencia:</strong> Los uniformes (médico, policía) o la vestimenta profesional (un traje bien cortado en el mundo de los negocios) pueden evocar un aura de autoridad y credibilidad.</li>
                <li><strong>Experiencia y Conocimiento Real:</strong> Este es el pilar más importante y ético. Cuando demuestras un dominio profundo de tu tema, hablas con confianza y ofreces valor real, construyes una autoridad sólida y respetada que no depende de trucos.</li>
            </ul>
        </div>
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">3. Ejemplos en Acción</h2>
            <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 space-y-3">
                <p class="text-gray-300"><strong class="text-white">Escenario de Marketing:</strong> Una marca de pasta de dientes utiliza a un actor con bata blanca en su anuncio que afirma: "Recomendado por 9 de cada 10 odontólogos". Están usando los símbolos de la autoridad <strong class="text-yellow-300">(bata, título implícito)</strong> para persuadirte.</p>
                
                <p class="text-gray-300"><strong class="text-white">Escenario Profesional:</strong> Vas a presentar una propuesta importante. Te preparas a fondo <strong class="text-yellow-300">(conocimiento real)</strong>, vistes de forma profesional y cuidada <strong class="text-yellow-300">(vestimenta)</strong> y en tu introducción mencionas brevemente un proyecto exitoso anterior que lideraste <strong class="text-yellow-300">(credencial de experiencia)</strong>. La audiencia estará mucho más receptiva a tu mensaje porque has establecido tu autoridad desde el principio.</p>

                <p class="text-gray-300"><strong class="text-white">Escenario de Consultoría:</strong> Un consultor financiero no solo muestra sus títulos. Analiza tu situación y te dice: "He visto este patrón en docenas de clientes. Los que hicieron X obtuvieron este resultado, y los que hicieron Y, este otro. Basado en tu perfil, te recomiendo X". Su autoridad no viene solo del título, sino de la demostración de una experiencia vasta y relevante.</p>
            </div>
        </div>
    </div>` 
},
  'is-a1': { 
    title: 'Control del Marco (Frame Control)', 
    content: `<div class="space-y-6">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">1. ¿Qué es un Marco? (La Lente de la Realidad)</h2>
            <p class="text-gray-300">Un "marco" es la perspectiva subconsciente, el contexto y las creencias a través de las cuales se interpreta una interacción. Es la lente que define el significado de lo que sucede. Cada conversación tiene un marco: ¿es una entrevista de trabajo?, ¿una discusión?, ¿una venta?, ¿un coqueteo? El Control del Marco es la habilidad de imponer tu perspectiva, haciendo que los demás reaccionen a tu realidad y jueguen según tus reglas, sin necesidad de ser agresivo. Cuando dos marcos se encuentran, el más fuerte siempre absorbe al más débil.</p>
        </div>
        <img src="https://placehold.co/600x400/374151/E5E7EB?text=Frame+Control" class="rounded-lg shadow-lg" alt="Una pieza de ajedrez dominando el tablero, simbolizando el control estratégico.">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">2. Técnicas para Imponer tu Marco (La Práctica)</h2>
            <ul class="list-disc list-inside text-gray-300 space-y-2">
                <li><strong>El Marco de Poder (Power Framing):</strong> Actúa con la convicción de que tú eres el premio. No buscas la aprobación de los demás; son ellos los que deben cualificar para ti. Se basa en la calma, el lenguaje corporal relajado y un ligero toque de humor o diversión.</li>
                <li><strong>El Reencuadre (Reframing):</strong> Toma la energía de su marco y dale un nuevo significado. Si un cliente dice "Su producto es muy caro" (marco de coste), tú lo reencuadras: "No es una cuestión de coste, sino de la inversión en tranquilidad/eficiencia que obtendrás" (marco de valor). Conecta directamente con la lección de PNL.</li>
                <li><strong>Ignorar y Redirigir:</strong> A veces, la mejor forma de destruir un marco no deseado (una queja, un insulto, un drama) es ignorarlo por completo y redirigir la conversación hacia lo que tú consideras importante. Esto comunica que su intento de imponer un marco es irrelevante.</li>
            </ul>
        </div>
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">3. Batallas de Marcos: Ejemplos en Acción</h2>
            <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 space-y-3">
                <p class="text-gray-300">
                    <strong class="text-white">Escenario: Un cliente te dice con aire de superioridad: "Convénceme de por qué debería contratarte a ti y no a tu competencia". (Su marco: Él es el juez, tú el suplicante).</strong><br>
                    <strong class="text-yellow-300">Respuesta Débil (Acepta el marco):</strong> "Bueno, somos los mejores, tenemos más experiencia, nuestros precios son buenos...".<br>
                    <strong class="text-white">Respuesta Maestra (Impone el marco de Poder):</strong> Con calma, te reclinas y dices: "Yo no estoy aquí para convencer a nadie. Yo expongo cómo soluciono problemas. Solo trabajo con clientes que son serios y están listos para actuar. Quizás primero deberías convencerme de por qué eres el tipo de cliente con el que deberíamos asociarnos".
                </p>
                
                <p class="text-gray-300">
                    <strong class="text-white">Escenario: Alguien intenta hacerte una broma para ponerte a prueba: "¡Vaya! Parece que esa idea se te ocurrió en la ducha". (Su marco: Tu idea es simplona y ridícula).</strong><br>
                    <strong class="text-yellow-300">Respuesta Débil (Se defiende):</strong> "¡Oye, es una buena idea, he trabajado mucho en ella!".<br>
                    <strong class="text-white">Respuesta Maestra (Reencuadre):</strong> Sonríes y dices: "Las mejores ideas siempre llegan cuando uno está relajado. Me alegro de que hayas captado su genialidad y simpleza. Ahora, centrémonos en el punto A...".
                </p>

                <p class="text-gray-300">
                    <strong class="text-white">Escenario: Un colega entra en pánico en una crisis: "¡Es el fin! ¡Vamos a perder al cliente por este error!". (Su marco: Catástrofe y desesperación).</strong><br>
                     <strong class="text-yellow-300">Respuesta Débil (Se contagia):</strong> "¡Dios mío, tienes razón, qué desastre!".<br>
                    <strong class="text-white">Respuesta Maestra (Ignora y Redirige):</strong> Ignoras el pánico y dices con calma: "Ok, entiendo. Ahora mismo el pánico no nos sirve. Céntrate. ¿Cuál es el estado exacto del problema? Necesito datos, no drama".
                </p>
            </div>
        </div>
    </div>` 
},
  'is-a2': { 
    title: 'Pensamiento en Capas: El Juego a Largo Plazo', 
    content: `<div class="space-y-6">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">1. ¿Qué es? (Ver Más Allá de la Superficie)</h2>
            <p class="text-gray-300">El pensamiento en capas es la habilidad de analizar una interacción no solo por lo que es en la superficie, sino por sus implicaciones a múltiples niveles. La mayoría de la gente opera en una sola capa: la transacción inmediata ("¿qué gano yo ahora?"). Un maestro de la influencia piensa en cuatro: la transacción, la reputación, la relación y el posicionamiento estratégico. Se trata de entender que cada conversación y cada acción es una pieza en un juego mucho más grande y a largo plazo.</p>
        </div>
        <img src="https://placehold.co/600x400/374151/E5E7EB?text=Pensamiento+en+Capas" class="rounded-lg shadow-lg" alt="Un tablero de ajedrez visto desde arriba, mostrando múltiples capas de estrategia.">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">2. Las 4 Capas de la Interacción (La Práctica)</h2>
            <ul class="list-disc list-inside text-gray-300 space-y-2">
                <li><strong>Capa 1 (La Transacción):</strong> Es la capa superficial. ¿Cuál es el objetivo inmediato de la conversación? (ej. vender un producto, pedir ayuda, dar una orden). Es importante ser competente aquí, pero es el nivel más básico.</li>
                <li><strong>Capa 2 (La Reputación):</strong> ¿Cómo afecta esta interacción a la forma en que los demás me perciben? Cada acción te etiqueta: ¿eres el útil, el quejica, el líder, el vago? Una buena reputación es un activo que te abre puertas en el futuro.</li>
                <li><strong>Capa 3 (La Relación):</strong> ¿Esta interacción construye o erosiona mi relación con esta persona y su red? ¿Estoy creando un aliado a largo plazo o ganando una batalla para perder la guerra? A veces, "perder" en la Capa 1 (ej. ceder en un punto) es una victoria en la Capa 3.</li>
                <li><strong>Capa 4 (El Posicionamiento):</strong> ¿Cómo me posiciona esta acción para mis metas a largo plazo? ¿Me da acceso a nuevas oportunidades, información, o círculos de influencia? Es el "juego final", donde tus acciones de hoy te preparan para las grandes victorias de mañana.</li>
            </ul>
        </div>
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">3. Ejemplos en Acción</h2>
            <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 space-y-3">
                <p class="text-gray-300">
                    <strong class="text-white">Escenario: Un colega te pide ayuda con una tarea que no es tu responsabilidad.</strong><br>
                    <strong class="text-yellow-300">Pensamiento de 1 Capa:</strong> "No es mi problema, estoy muy ocupado". Ganas 20 minutos ahora, pero no ganas nada más.<br>
                    <strong class="text-white">Pensamiento de 4 Capas:</strong> "Claro, te ayudo (Capa 1). Esto me hace ver como un colaborador proactivo y un experto en el tema (Capa 2). Fortalezco mi relación con este colega, que ahora me deberá un favor (Capa 3). Esto me posiciona como un futuro líder de equipo y me da visibilidad frente a la dirección (Capa 4)".
                </p>
                
                <p class="text-gray-300">
                    <strong class="text-white">Escenario: Cometes un error que afecta a un cliente.</strong><br>
                    <strong class="text-yellow-300">Pensamiento de 1 Capa:</strong> Intentar minimizar el error o culpar a factores externos para evitar el conflicto inmediato.<br>
                    <strong class="text-white">Pensamiento de 4 Capas:</strong> "Llamo al cliente de inmediato y asumo la responsabilidad (Capa 1). Esto, paradójicamente, refuerza mi reputación como alguien honesto y fiable (Capa 2). Al gestionar la crisis de forma eficaz, puedo incluso fortalecer la lealtad del cliente (Capa 3). Esta situación se convierte en una oportunidad para demostrar la excelencia de nuestro servicio postventa, lo que nos posiciona como un socio estratégico y no como un simple proveedor (Capa 4)".
                </p>
            </div>
        </div>
    </div>` 
},
  'is-a3': { 
    title: 'Creación de Pretextos y Escenarios', 
    content: `<div class="space-y-6">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">1. ¿Qué es? (Ser el Arquitecto de la Situación)</h2>
            <p class="text-gray-300">Un "pretexto" es una razón cuidadosamente elaborada para iniciar una interacción o hacer una petición. Un "escenario" es el entorno completo y la narrativa que diseñas para que un resultado deseado se sienta como la conclusión más natural y lógica. Esta es la culminación de todas tus habilidades: en lugar de esperar una oportunidad, la fabricas. Implica entender las motivaciones de los demás, controlar el marco y preparar el terreno para que tus ideas sean recibidas de la forma más favorable posible.</p>
        </div>
        <img src="https://placehold.co/600x400/374151/E5E7EB?text=Dise%C3%B1o+de+Escenarios" class="rounded-lg shadow-lg" alt="Planos de un arquitecto, simbolizando el diseño meticuloso de una situación.">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">2. Pasos para Construir un Escenario (La Práctica)</h2>
            <ul class="list-disc list-inside text-gray-300 space-y-2">
                <li><strong>1. Define tu Objetivo Preciso:</strong> ¿Qué quieres lograr exactamente? No "hablar con el jefe", sino "conseguir que el jefe apruebe 15 minutos de su tiempo para escuchar mi propuesta sobre el problema X".</li>
                <li><strong>2. Analiza a tu Objetivo:</strong> ¿Qué valora? ¿El tiempo, los datos, la audacia? ¿Cuándo está más receptivo? ¿Cuál es su estado de ánimo habitual?</li>
                <li><strong>3. Diseña el Pretexto Perfecto:</strong> Tu razón para la interacción debe ser creíble, lógica y, si es posible, beneficiosa para la otra persona. "¿Puedo robarte un minuto?" es un mal pretexto. "He encontrado un dato que podría impactar tu proyecto, ¿tienes un momento para verlo?" es un gran pretexto.</li>
                <li><strong>4. Monta el Escenario:</strong> Controla las variables: el lugar (su oficina vs. un café neutral), el momento (a primera hora vs. cuando está a punto de irse), y los materiales de apoyo (un resumen de una página vs. un PowerPoint de 50 diapositivas).</li>
            </ul>
        </div>
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">3. Ejemplos en Acción</h2>
            <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 space-y-3">
                <p class="text-gray-300">
                    <strong class="text-white">Escenario: Quieres presentar una idea innovadora pero arriesgada a tu jefa.</strong><br>
                    <strong class="text-yellow-300">Método Reactivo:</strong> Asaltarla en el pasillo o enviarle un email largo que probablemente no leerá con atención.<br>
                    <strong class="text-white">Diseño de Escenario:</strong>
                    <ol class="list-decimal list-inside ml-4 mt-2">
                        <li><strong>Objetivo:</strong> Que mi jefa vea mi idea como una solución proactiva a un problema que a ella le importa.</li>
                        <li><strong>Análisis:</strong> Ella valora la eficiencia y odia las reuniones sin un propósito claro.</li>
                        <li><strong>Pretexto:</strong> En lugar de "tengo una idea", el pretexto es: "Hola [Jefa], he estado trabajando en una forma de optimizar el proceso X que nos costó retrasos el mes pasado. Tengo un borrador que creo que podría ahorrarnos 5 horas a la semana. ¿Tendrías 15 minutos para darle un vistazo y darme tu opinión experta?".</li>
                        <li><strong>Resultado del Escenario:</strong> Has enmarcado la reunión no como una petición de tu tiempo, sino como una oferta de una solución a su problema. Has establecido tu autoridad y proactividad antes incluso de empezar a hablar.</li>
                    </ol>
                </p>
                
                <p class="text-gray-300">
                    <strong class="text-white">Escenario: Quieres conocer a una persona influyente en una conferencia.</strong><br>
                    <strong class="text-yellow-300">Método Reactivo:</strong> Acercarte torpemente y decir "Hola, admiro mucho tu trabajo".<br>
                    <strong class="text-white">Diseño de Escenario:</strong>
                     <ol class="list-decimal list-inside ml-4 mt-2">
                        <li><strong>Objetivo:</strong> Crear una breve interacción memorable que pueda llevar a una conversación futura.</li>
                        <li><strong>Análisis:</strong> La persona probablemente está aburrida de los halagos genéricos.</li>
                        <li><strong>Pretexto:</strong> Te acercas después de su charla y dices: "Ha sido una charla fantástica. La parte en la que mencionaste [detalle específico e interesante] me ha hecho pensar en cómo se aplica a [un problema de tu sector]. No quiero robarte tiempo ahora, pero ¿te importaría si te envío una pregunta muy breve por email al respecto?".</li>
                        <li><strong>Resultado del Escenario:</strong> Has demostrado que has escuchado atentamente, has hecho un cumplido específico, has mostrado respeto por su tiempo y has creado una razón legítima para un contacto futuro.</li>
                    </ol>
                </p>
            </div>
        </div>
    </div>` 
},
  'is-a4': { 
    title: 'La Ética de la Influencia: El Dilema del Poder', 
    content: `<div class="space-y-6">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">1. La Diferencia Crucial: Influencia vs. Manipulación</h2>
            <p class="text-gray-300">Las habilidades que has aprendido son herramientas de un poder inmenso. Y como toda herramienta poderosa, pueden usarse para construir o para destruir. Aquí yace la diferencia fundamental:</p>
            <ul class="list-disc list-inside text-gray-300 space-y-2 mt-3">
                <li><strong class="text-white">Influencia:</strong> Es el arte de la persuasión para un <strong class="text-green-400">beneficio mutuo (Ganar-Ganar)</strong>. Busca alinear intereses, crear valor y mejorar las situaciones para todas las partes. La influencia construye confianza y relaciones a largo plazo.</li>
                <li><strong class="text-white">Manipulación:</strong> Es el uso de la persuasión para un <strong class="text-red-400">beneficio propio a costa de otros (Ganar-Perder)</strong>. Implica engaño, explotación de debilidades y falta de transparencia sobre la intención final. La manipulación destruye la confianza y las relaciones.</li>
            </ul>
        </div>
        <img src="https://placehold.co/600x400/374151/E5E7EB?text=%C3%89tica" class="rounded-lg shadow-lg" alt="Una balanza equilibrada, simbolizando la justicia y la ética.">
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">2. El Marco de Decisión Ética (Tu Brújula Interna)</h2>
            <p class="text-gray-300">Antes de usar una técnica de influencia, haz una pausa y pásala por este filtro de 4 preguntas:</p>
            <ul class="list-disc list-inside text-gray-300 space-y-2">
                <li><strong>La Pregunta de la Transparencia:</strong> Si la otra persona supiera exactamente qué técnica estoy usando y por qué, ¿se sentiría respetada o engañada?</li>
                <li><strong>La Pregunta del Valor:</strong> ¿Mi objetivo final crea valor genuino para la otra persona o solo para mí?</li>
                <li><strong>La Pregunta de la Relación:</strong> ¿Esta acción fortalecerá o debilitará la confianza y la relación a largo plazo?</li>
                <li><strong>La Pregunta de la Empatía (La Regla de Oro):</strong> ¿Me gustaría que alguien usara esta técnica conmigo de esta misma forma y con esta misma intención?</li>
            </ul>
        </div>
        <div>
            <h2 class="text-xl font-semibold text-yellow-400 mb-2">3. Casos de Estudio: La Misma Técnica, Dos Caminos</h2>
            <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 space-y-4">
                <p class="text-gray-300">
                    <strong class="text-white">Técnica:</strong> Principio de Autoridad.<br>
                    <strong class="text-green-400">Uso Ético (Influencia):</strong> Un médico utiliza su conocimiento y su título para convencer a un paciente de que adopte hábitos más saludables, mejorando su calidad de vida.<br>
                    <strong class="text-red-400">Uso No Ético (Manipulación):</strong> Una persona con una falsa credencial de "experto financiero" utiliza su supuesta autoridad para convencer a personas vulnerables de que inviertan en una estafa.
                </p>
                <p class="text-gray-300">
                    <strong class="text-white">Técnica:</strong> Compromiso y Coherencia.<br>
                    <strong class="text-green-400">Uso Ético (Influencia):</strong> Le pides a un amigo que se comprometa a ser tu "compañero de responsabilidad" para ir al gimnasio, ayudándose mutuamente a alcanzar un objetivo que ambos desean.<br>
                    <strong class="text-red-400">Uso No Ético (Manipulación):</strong> Un vendedor te hace firmar un formulario de "sondeo sin compromiso" para luego presionarte, diciendo "pero si ya has mostrado tu interés por escrito", para que compres algo que no necesitas.
                </p>
            </div>
            <p class="text-center font-bold text-lg mt-6 text-yellow-300">El verdadero poder no reside en saber cómo influir, sino en tener la sabiduría para saber cuándo, cómo y, lo más importante, por qué hacerlo.</p>
        </div>
    </div>` 
}
        };
      
      
      
        const challenges = { 
            'c-1': { title: 'Reto: Gestos Pacificadores', scenario: 'Estás en una reunión y le preguntas a un colega sobre el retraso de un proyecto. Él responde: "No te preocupes, todo está bajo control".', question: 'Mientras lo dice, ¿cuáles de los siguientes gestos podrían indicar que se siente internamente estresado, a pesar de sus palabras? <strong>Selecciona todos los que apliquen.</strong>', options: [ {text: 'Se toca la parte posterior del cuello.', correct: true}, {text: 'Mantiene contacto visual directo y firme.', correct: false}, {text: 'Se frota el brazo o la pierna.', correct: true}, {text: 'Se ajusta el nudo de la corbata o el collar.', correct: true} ]},
            'c-2': { title: 'Reto: Incongruencia en una Cita', scenario: 'Al final de una primera cita, le preguntas a la otra persona: "¿Te gustaría que nos volviéramos a ver?". Te responde "¡Sí, claro!", pero mientras lo dice, se encoge ligeramente de hombros y sus pies apuntan hacia la salida.', question: '¿Cuál es el mensaje más probable?', options: [ {text: 'Está muy entusiasmada y quiere volver a verte.', correct: false}, {text: 'Sus palabras son amables, pero su cuerpo indica duda o deseo de irse.', correct: true}, {text: 'Está pensando en su agenda para la próxima cita.', correct: false} ]},
            'c-3': { title: 'Reto: Posturas de Poder', scenario: 'Estás en una negociación. La otra persona se reclina en su silla, entrelaza las manos detrás de la cabeza y pone los pies sobre la mesa.', question: '¿Qué está comunicando esta postura?', options: [ {text: 'Se siente en una posición dominante, de control y muy cómodo.', correct: true}, {text: 'Está aburrido y desinteresado en la conversación.', correct: false}, {text: 'Está nervioso y tratando de parecer más grande.', correct: false} ]},
            'c-4': { title: 'Reto: Proxémica en el Ascensor', scenario: 'Entras en un ascensor casi vacío. Otra persona entra después y se para justo a tu lado, a pesar de haber mucho espacio disponible.', question: '¿Qué indica este comportamiento?', options: [ {text: 'Es una persona muy amigable que busca conversación.', correct: false}, {text: 'Puede ser una invasión del espacio personal, indicando poca conciencia social o una posible actitud de confrontación.', correct: true}, {text: 'Simplemente no se fijó dónde se paraba.', correct: false} ]},
            'c-5': { title: 'Reto: Claves Oculares (Construcción)', scenario: 'Le preguntas a un amigo: "¿Qué hiciste el fin de semana?". Mientras te cuenta una historia, sus ojos se mueven constantemente hacia arriba y a su derecha (tu izquierda).', question: '¿Qué podría indicar este movimiento ocular?', options: [ {text: 'Está recordando vívidamente los eventos tal como ocurrieron.', correct: false}, {text: 'Está accediendo a sus sentimientos sobre el fin de semana.', correct: false}, {text: 'Podría estar construyendo o adornando la historia, más que simplemente recordándola.', correct: true} ]},
            'c-6': { title: 'Reto: Microexpresión de Sorpresa', scenario: 'Le das una buena noticia inesperada a un compañero de trabajo. Por una fracción de segundo, antes de sonreír, sus cejas se arquean y su boca se abre ligeramente.', question: '¿Qué emoción inicial delató?', options: [ {text: 'Alegría', correct: false}, {text: 'Sorpresa', correct: true}, {text: 'Miedo', correct: false} ]},
            'c-7': { title: 'Reto: Gestos con las Manos', scenario: 'Un vendedor te presenta un producto. Durante toda la explicación, mantiene las palmas de sus manos abiertas y visibles hacia ti.', question: '¿Qué mensaje subconsciente está enviando?', options: [ {text: 'Está tratando de hipnotizarte.', correct: false}, {text: 'Comunica honestidad, apertura y que no tiene nada que ocultar.', correct: true}, {text: 'Indica que no está seguro de lo que está diciendo.', correct: false} ]},
            'c-8': { title: 'Reto: Creando Barreras', scenario: 'Estás debatiendo una idea con un colega en una mesa. Cuando empiezas a exponer un punto contrario al suyo, él desliza su taza de café y su teléfono al centro de la mesa, entre ustedes dos.', question: '¿Qué podría significar esta acción?', options: [ {text: 'Simplemente está reorganizando sus cosas.', correct: false}, {text: 'Está aburrido y busca una distracción.', correct: false}, {text: 'Inconscientemente, está creando una barrera, mostrando desacuerdo o poniéndose a la defensiva.', correct: true} ]},
            'c-9': { title: 'Reto: Bloqueo de la Boca', scenario: 'Le preguntas a alguien si está de acuerdo con una decisión. Responde "Sí, totalmente", pero se tapa la boca con la mano justo después de decirlo.', question: '¿Qué indica esta incongruencia?', options: [ {text: 'Le duele una muela.', correct: false}, {text: 'Su cerebro está tratando de bloquear o retener palabras que no son del todo ciertas.', correct: true}, {text: 'Está a punto de estornudar.', correct: false} ]},
            'c-10': { title: 'Reto: Interés Genuino', scenario: 'Mientras le cuentas una historia a un amigo, él inclina la cabeza hacia un lado, se inclina ligeramente hacia ti y mantiene un buen contacto visual.', question: '¿Qué conjunto de señales está mostrando?', options: [ {text: 'Señales de aburrimiento y está buscando una vía de escape.', correct: false}, {text: 'Señales clásicas de escucha activa, curiosidad y compromiso con lo que estás diciendo.', correct: true}, {text: 'Está tratando de intimidarte con su mirada.', correct: false} ]},
            'c-11': { title: 'Reto: Entrevista de Trabajo', scenario: 'Un candidato a un puesto dice: "Tengo mucha experiencia liderando equipos". Sin embargo, mientras lo dice, su voz es baja y se frota las manos nerviosamente.', question: '¿Qué deberías considerar?', options: [ {text: 'Sus palabras son lo más importante, la experiencia es clara.', correct: false}, {text: 'Su lenguaje corporal sugiere nerviosismo o falta de confianza en su propia afirmación.', correct: true}, {text: 'Probablemente solo está nervioso por la entrevista en general.', correct: true} ]},
            'c-12': { title: 'Reto: Venta de Coche', scenario: 'Un cliente mira un coche y dice: "Es un poco más de lo que pensaba gastar...". Al decirlo, se rasca la barbilla y mira el coche de arriba abajo de nuevo.', question: '¿Qué indica este cluster de gestos?', options: [ {text: 'Ha perdido todo el interés y se va a ir.', correct: false}, {text: 'Está en un proceso de toma de decisiones, evaluando si el valor del coche justifica el precio.', correct: true}, {text: 'No le gusta el color del coche.', correct: false} ]},
            'c-13': { title: 'Reto: Conversación Casual', scenario: 'Estás hablando con alguien en una fiesta. Te hace preguntas, pero su torso y pies están constantemente orientados hacia la puerta o hacia otro grupo de personas.', question: '¿Cuál es la señal no verbal más fuerte aquí?', options: [ {text: 'Está muy interesado en tu conversación.', correct: false}, {text: 'Su cuerpo está "diciendo" que quiere irse o unirse a otra conversación, a pesar de sus palabras educadas.', correct: true}, {text: 'Tiene frío y busca un lugar más cálido.', correct: false} ]},
            'c-14': { title: 'Reto: Acuerdo Falso', scenario: 'En una reunión de equipo, tu jefe propone una nueva idea. Un colega dice "Suena genial", pero lo dice con un ligero tono sarcástico y una sonrisa tensa que no llega a sus ojos.', question: '¿Qué es lo más probable?', options: [ {text: 'Está 100% de acuerdo con el jefe.', correct: false}, {text: 'No está de acuerdo, pero no quiere decirlo directamente. Su tono y su sonrisa falsa lo delatan.', correct: true}, {text: 'Simplemente está teniendo un mal día.', correct: false} ]},
            'c-15': { title: 'Reto: Ocultando Información', scenario: 'Le preguntas a tu compañero de piso si ha visto tus llaves. Responde "No, ni idea" pero evita completamente tu mirada y se encoge de hombros de forma exagerada.', question: '¿Qué podría indicar su comportamiento?', options: [ {text: 'Está diciendo la verdad y no sabe nada.', correct: false}, {text: 'El encogimiento de hombros exagerado y la falta de contacto visual son señales de alerta. Podría saber más de lo que dice.', correct: true}, {text: 'Está demasiado ocupado para ayudarte a buscar.', correct: false} ]},
            'c-16': { title: 'Reto: Coqueteo Sutil', scenario: 'Una persona en un bar te escucha atentamente. Mientras hablas, se arregla el pelo y su pie apunta directamente hacia ti.', question: '¿Qué está comunicando probablemente?', options: [ {text: 'Se está aburriendo y quiere irse.', correct: false}, {text: 'Son gestos de acicalamiento y de interés, a menudo asociados con la atracción.', correct: true}, {text: 'Tiene el cuello rígido.', correct: false} ]},
            'c-17': { title: 'Reto: Feedback Laboral', scenario: 'Le das una crítica constructiva a un empleado. Inmediatamente después, cruza los brazos y aprieta la mandíbula.', question: '¿Cuál es su reacción no verbal?', options: [ {text: 'Está completamente abierto y receptivo a tus comentarios.', correct: false}, {text: 'Se ha puesto a la defensiva. Ha creado una barrera y muestra tensión.', correct: true}, {text: 'Está reflexionando profundamente sobre tus palabras.', correct: false} ]},
            'c-18': { title: 'Reto: Mentira Infantil', scenario: 'Le preguntas a un niño de 5 años si se comió la última galleta. Abre mucho los ojos, dice "no" muy rápido y mantiene una mirada fija y sin parpadear en ti.', question: '¿Qué es una señal común de mentira en los niños?', options: [ {text: 'Mirar hacia abajo y sentirse culpable.', correct: true}, {text: 'El contacto visual excesivo y forzado, porque creen que así es como se ve a alguien que dice la verdad.', correct: true}, {text: 'Empezar a hablar de otra cosa para cambiar de tema.', correct: true} ]},
            'c-19': { title: 'Reto: Empatía Genuina', scenario: 'Le cuentas un problema a un agente de servicio al cliente. Él te escucha, inclina la cabeza, asiente a un ritmo similar al de tu habla y refleja tu expresión facial de preocupación.', question: '¿Qué habilidad está demostrando?', options: [ {text: 'Está mostrando una empatía fingida para terminar rápido la llamada.', correct: false}, {text: 'Está construyendo rapport activamente y mostrando empatía genuina a través de la sincronización y el reflejo.', correct: true}, {text: 'Está distraído y solo imita por inercia.', correct: false} ]},
            'c-20': { title: 'Reto: Dominancia en un Saludo', scenario: 'Alguien te da la mano para saludarte, pero gira su mano para que su palma quede hacia abajo y la tuya hacia arriba.', question: '¿Qué puede significar este tipo de apretón de manos?', options: [ {text: 'Es un saludo estándar sin ningún significado oculto.', correct: false}, {text: 'Es un intento sutil y a menudo inconsciente de establecer dominio en la interacción.', correct: true}, {text: 'Simplemente tiene una forma extraña de dar la mano.', correct: false} ]},
            'c-21': { title: 'Reto: Ojos que Recuerdan', scenario: 'Le preguntas a tu amigo: "¿De qué color era tu primer coche?". Él mira hacia arriba y a su izquierda antes de responder.', question: '¿Qué proceso mental está realizando?', options: [ {text: 'Está inventando un color.', correct: false}, {text: 'Está accediendo a un recuerdo visual.', correct: true}, {text: 'Está sintiendo la emoción de su primer coche.', correct: false} ]},
            'c-22': { title: 'Reto: Ojos que Crean', scenario: 'Le pides a un colega que imagine cómo se vería un dragón morado en la oficina. Él mira hacia arriba y a su derecha mientras sonríe.', question: '¿Por qué sus ojos se mueven en esa dirección?', options: [ {text: 'Está recordando haber visto un dragón.', correct: false}, {text: 'Está construyendo una imagen mental que nunca ha visto.', correct: true}, {text: 'Está escuchando el rugido del dragón en su mente.', correct: false} ]},
            'c-23': { title: 'Reto: Ojos que Escuchan (Recuerdo)', scenario: 'Le preguntas a alguien: "¿Cómo sonaba la voz de tu abuela?". La persona mira hacia su lado izquierdo.', question: '¿Qué está haciendo su cerebro?', options: [ {text: 'Recordando un sonido específico del pasado.', correct: true}, {text: 'Imaginando un sonido nuevo.', correct: false}, {text: 'Hablando consigo mismo sobre la pregunta.', correct: false} ]},
            'c-24': { title: 'Reto: Ojos que Escuchan (Creación)', scenario: 'Le dices a un músico: "Intenta imaginar cómo sonaría una trompeta mezclada con el canto de una ballena". Él mira hacia su lado derecho, pensativo.', question: '¿Qué indica este movimiento?', options: [ {text: 'Está recordando una canción que ya conoce.', correct: false}, {text: 'Está creando un sonido nuevo y complejo en su mente.', correct: true}, {text: 'Está visualizando la partitura.', correct: false} ]},
            'c-25': { title: 'Reto: Ojos que Sienten', scenario: 'Le preguntas a un amigo: "¿Recuerdas la sensación de la arena caliente en tus pies durante las vacaciones?". Él baja la mirada hacia su derecha.', question: '¿A qué tipo de información está accediendo?', options: [ {text: 'A un recuerdo visual de la playa.', correct: false}, {text: 'A una sensación física o una emoción (kinestésico).', correct: true}, {text: 'A un sonido, como el de las olas.', correct: false} ]},
            'c-26': { title: 'Reto: Ojos que Piensan', scenario: 'Le pides a alguien que calcule mentalmente cuánto es 17 por 3. Mientras lo hace, baja la mirada hacia su izquierda.', question: '¿Qué está ocurriendo en su mente?', options: [ {text: 'Está visualizando los números.', correct: false}, {text: 'Está hablando consigo mismo, procesando la lógica del cálculo (diálogo interno).', correct: true}, {text: 'Está sintiendo la dificultad del problema.', correct: false} ]},
            'c-27': { title: 'Reto: Ojos que Mienten', scenario: 'Le preguntas a un empleado que llegó tarde: "¿El tráfico estaba mal en la autopista principal?". Él responde "Sí, terrible" mientras mira hacia arriba y a la derecha. Sabes que él normalmente toma una ruta secundaria.', question: '¿Qué sugiere su respuesta no verbal?', options: [ {text: 'Está recordando el tráfico que vio.', correct: false}, {text: 'Está construyendo una imagen visual para justificar su retraso, lo que podría indicar una mentira.', correct: true}, {text: 'Está recordando el sonido del claxon de los coches.', correct: false} ]},
            'c-28': { title: 'Reto: Proceso Doble', scenario: 'Le dices a una amiga: "Tu presentación fue increíble". Ella responde "Gracias" y mira hacia su lado izquierdo, y luego baja la mirada a su derecha.', question: '¿Qué proceso doble podría estar ocurriendo?', options: [ {text: 'Está construyendo una mentira y luego sintiéndose mal por ello.', correct: false}, {text: 'Está recordando tus palabras exactas (Auditivo Recordado) y luego conectando con el sentimiento de orgullo (Kinestésico).', correct: true}, {text: 'Está hablando consigo misma y luego visualizando el futuro.', correct: false} ]},
            'c-29': { title: 'Reto: El Plan del Arquitecto', scenario: 'Un arquitecto te explica los planos de una casa. Cuando le preguntas sobre el color de las paredes, mira hacia arriba a la izquierda. Cuando le preguntas por qué eligió una viga de soporte específica, mira hacia abajo a la izquierda.', question: '¿Qué indican estos dos movimientos?', options: [ {text: 'Recordó el color (Visual Recordado) y luego procesó la lógica de la viga (Diálogo Interno).', correct: true}, {text: 'Inventó el color y luego recordó la lógica.', correct: false}, {text: 'Sintió el color y luego escuchó el sonido de la viga.', correct: false} ]},
            'c-30': { title: 'Reto: Calibración Inversa', scenario: 'Antes de una pregunta importante, calibras a una persona zurda. Le preguntas por el color de su coche (mira arriba-derecha) y luego le pides que imagine un perro verde (mira arriba-izquierda).', question: '¿Qué has descubierto?', options: [ {text: 'La persona está mintiendo sobre el color de su coche.', correct: false}, {text: 'Esta persona tiene el mapa de claves oculares invertido, lo cual es común en personas zurdas.', correct: true}, {text: 'Las claves oculares no funcionan con esta persona.', correct: false} ]}, 'c-31': { 
    title: 'Reto: El Primer Paso (Reciprocidad)', 
    scenario: 'Eres nuevo en un departamento y quieres construir una buena relación con un colega senior que parece muy ocupado y reservado. Quieres aplicar el principio de reciprocidad.', 
    question: '¿Cuál sería el primer paso más efectivo y ético?', 
    options: [ 
        {text: 'Pedirle un favor importante para demostrar que valoras su experiencia.', correct: false}, 
        {text: 'Encontrar una forma genuina de ayudarle en algo pequeño sin que te lo pida, como enviarle un artículo útil sobre un problema que le oíste mencionar.', correct: true}, 
        {text: 'Esperar a que él te ofrezca su ayuda primero para no molestarle.', correct: false}
    ]
},
'c-32': { 
    title: 'Reto: La Interrupción Justificada', 
    scenario: 'Necesitas hacerle una pregunta urgente a tu jefa, que está visiblemente concentrada en una tarea importante.', 
    question: '¿Cuál es la forma más eficaz de interrumpirla usando una justificación legítima?', 
    options: [ 
        {text: 'Decir: "Disculpa, ¿tienes un minuto? Es importante".', correct: false}, 
        {text: 'Decir: "Jefa, sé que estás ocupada, pero necesito una respuesta sobre el proyecto X porque el cliente está esperando en la otra línea".', correct: true},
        {text: 'Esperar a que termine, aunque la pregunta sea urgente.', correct: false} 
    ]
},
'c-33': { 
    title: 'Reto: El Pie en la Puerta', 
    scenario: 'Quieres que un amigo muy ocupado te ayude con una tarea grande, como revisar a fondo un proyecto personal tuyo.', 
    question: 'Aplicando la técnica del "Pie en la Puerta", ¿cuál debería ser tu petición INICIAL?', 
    options: [ 
        {text: 'Pedirle directamente que dedique una tarde a revisar tu proyecto.', correct: false}, 
        {text: 'Preguntarle si se considera un buen amigo que ayuda a los demás.', correct: false},
        {text: 'Pedirle si puede echarle un vistazo de 5 minutos a una sola página del proyecto para darte su opinión sobre el título.', correct: true}
    ]
},
'c-34': { 
    title: 'Reto: La Fuerza del Grupo', 
    scenario: 'Estás en una reunión tratando de convencer a tu equipo de adoptar una nueva metodología de trabajo. Hay bastante escepticismo.', 
    question: '¿Qué argumento se basa más fuertemente en el principio de Prueba Social?', 
    options: [ 
        {text: 'Explicar detalladamente por qué, en tu opinión, esta metodología es superior.', correct: false}, 
        {text: 'Mencionar que el equipo de al lado, con retos similares, la adoptó hace un mes y ya reporta una mejora del 20% en su eficiencia.', correct: true},
        {text: 'Decir que si no innovan, la empresa podría quedarse atrás.', correct: false}
    ]
}, 'c-35': { 
    title: 'Reto: Conexión Instantánea (Afinidad)', 
    scenario: 'Estás en un evento de networking y quieres conectar con un ponente que te interesa. Sabes que un simple "me ha gustado tu charla" es demasiado genérico.', 
    question: '¿Qué frase utiliza mejor el principio de Afinidad a través de la similaridad y el elogio sincero?', 
    options: [ 
        {text: '"Hola, ¿puedo hacerte una pregunta sobre tu trabajo?".', correct: false}, 
        {text: '"La forma en que explicaste [Concepto X] fue brillante. Me recordó a un problema que tuve en [Tu Campo], lo que demuestra lo universal que es tu punto. Soy [Tu Nombre], por cierto".', correct: true},
        {text: '"Necesito tu consejo sobre un tema, ¿tienes un minuto?".', correct: false} 
    ]
},
'c-36': { 
    title: 'Reto: Proyectando Credibilidad (Autoridad)', 
    scenario: 'Eres un profesional freelance y un cliente potencial duda de tu capacidad para manejar su proyecto porque eres un "equipo de uno".', 
    question: '¿Cuál es la mejor manera de proyectar autoridad sin sonar arrogante?', 
    options: [ 
        {text: '"No te preocupes, soy muy bueno en lo que hago y tengo mucha experiencia".', correct: false},
        {text: '"Entiendo tu duda. Precisamente por eso, en mi web puedes ver testimonios de clientes como [Cliente Importante] y un caso de estudio detallado de cómo resolví un problema similar al tuyo".', correct: true},
        {text: '"Te aseguro que soy más eficiente que muchas agencias grandes".', correct: false}
    ]
},
'c-37': { 
    title: 'Reto: La Batalla de Marcos', 
    scenario: 'Un entrevistador te lanza una pregunta para ponerte a prueba: "¿Por qué debería contratarte a ti si tengo a otros diez candidatos con más experiencia?". Su marco es: "Tú eres uno más del montón".', 
    question: '¿Cuál es la mejor forma de tomar el control del marco (Frame Control)?', 
    options: [ 
        {text: 'Defenderte diciendo: "Aunque tengan más años, mi experiencia es más relevante y aprendo rápido".', correct: false},
        {text: 'Reencuadrar con calma: "Esa es una buena pregunta. No se trata de años de experiencia, sino de resultados. En mi último puesto, lideré un proyecto que generó [Resultado Concreto]. La pregunta es si buscáis a alguien que acumule años o a alguien que genere resultados".', correct: true},
        {text: 'Aceptar su marco y decir: "Es cierto, hay gente con más experiencia, pero yo le pondré más ganas que nadie".', correct: false}
    ]
},
'c-38': { 
    title: 'Reto: El Juego a Largo Plazo', 
    scenario: 'Un cliente te pide un pequeño descuento en un proyecto que, si lo haces bien, podría llevar a una colaboración mucho más grande y duradera.', 
    question: '¿Cómo evalúas la situación con un "Pensamiento en Capas"?', 
    options: [ 
        {text: 'Capa 1 (Transacción): Rechazas el descuento porque reduce tu beneficio inmediato.', correct: false},
        {text: 'Capa 4 (Posicionamiento): Aceptas el pequeño descuento, verbalizando que lo haces como gesto de confianza para iniciar una relación a largo plazo, posicionándote como un socio flexible y estratégico.', correct: true},
        {text: 'Capa 2 (Reputación): Te niegas firmemente para construir una reputación de que no negocias tus precios.', correct: false}
    ]
},
'c-39': { 
    title: 'Reto: El Escenario Perfecto', 
    scenario: 'Quieres proponer a tu equipo un cambio importante que requiere más trabajo al principio, pero que traerá grandes beneficios después. Sabes que si lo propones en la reunión semanal, habrá quejas por la carga de trabajo extra.', 
    question: '¿Cuál es la mejor forma de "diseñar el escenario" para tu propuesta?', 
    options: [ 
        {text: 'Enviar un email masivo a todo el equipo con la propuesta detallada para que todos la lean.', correct: false},
        {text: 'Hablar primero en privado con el miembro más influyente y respetado del equipo, convencerle de los beneficios y pedirle su apoyo. Luego, presentar la idea al resto del equipo con su respaldo.', correct: true},
        {text: 'Presentar la idea por sorpresa en la reunión para que no tengan tiempo de coordinar una respuesta negativa.', correct: false}
    ]
},
'c-40': { 
    title: 'Reto: El Dilema Ético', 
    scenario: 'Descubres una forma de usar la "Prueba Social" mostrando estadísticas de una manera que, aunque técnicamente es cierta, es engañosa y podría llevar a los clientes a comprar un producto que no es el mejor para ellos.', 
    question: 'Aplicando el marco de decisión ética, ¿qué pregunta es la más importante que debes hacerte?', 
    options: [ 
        {text: '"¿Es legal hacer esto?".', correct: false},
        {text: '"Si mis clientes supieran exactamente cómo estoy presentando los datos, ¿se sentirían respetados o engañados?".', correct: true},
        {text: '"¿Podría la competencia usar esta misma táctica contra mí?".', correct: false}
    ]
},
'c-41': { 
    title: 'Reto Avanzado: Rompiendo el Marco', 
    scenario: 'En una negociación, la otra parte intenta intimidarte diciendo: "Tenemos otras ofertas mucho mejores sobre la mesa. Tienes una hora para aceptar o nos vamos". Su marco es de urgencia y escasez.', 
    question: '¿Cuál es la respuesta más poderosa para romper su marco?', 
    options: [ 
        {text: 'Apresurarte y tratar de mejorar tu oferta dentro de esa hora.', correct: false},
        {text: 'Con calma, levantarte, sonreír y decir: "Entiendo. Parece que no estamos en el mismo punto. Tómense el tiempo que necesiten con las otras ofertas. Si algo cambia, saben dónde encontrarme". Y te vas.', correct: true},
        {text: 'Preguntarles cuáles son esas otras ofertas para poder igualarlas.', correct: false}
    ]
},
'c-42': { 
    title: 'Reto Avanzado: La Reputación Silenciosa', 
    scenario: 'En tu empresa, hay dos expertos en un tema. El Experto A habla constantemente de sus logros. El Experto B rara vez habla de sí mismo, pero dedica tiempo a ayudar a otros a resolver sus problemas más difíciles, a menudo sin pedir nada a cambio.', 
    question: 'Desde la perspectiva del "Pensamiento en Capas", ¿quién está construyendo un poder y una reputación más sólidos a largo plazo?', 
    options: [ 
        {text: 'El Experto A, porque se asegura de que todos conozcan sus éxitos (Capa 1 y 2).', correct: false},
        {text: 'El Experto B, porque sus acciones (ayudar a otros) construyen una reputación de valor incalculable y una red de aliados que le apoyarán en el futuro (Capa 2, 3 y 4).', correct: true},
        {text: 'Ambos construyen el mismo nivel de poder, pero de formas diferentes.', correct: false}
    ]
},
        };
      
      const simulations = {
    'sim-1': {
        title: 'El Colega Escéptico',
        description: 'Tu objetivo: Presentar una nueva idea a un colega experimentado pero cínico y conseguir que acepte explorarla en una breve reunión, en lugar de rechazarla de plano.',
        npc: { name: 'Javier', mood: 'Escéptico' },
        conversation: {
            'start': {
                npc_line: 'Hola. Oye, he visto tu email sobre la "nueva iniciativa". Suena a más trabajo y a la típica idea del mes. ¿De qué va esto?',
                options: [
                    { text: 'Defender la idea directamente.', technique: 'Argumentación Lógica', target_node: 'node_defense' },
                    { text: 'Validar su escepticismo primero.', technique: 'Validación y Escucha Activa', target_node: 'node_validate' },
                    { text: 'Intentar imponer un marco de poder.', technique: 'Control del Marco (Agresivo)', target_node: 'node_frame_power' }
                ]
            },
            'node_defense': {
                npc_line: 'Ya, ya. "Eficiencia", "optimización"... siempre es la misma historia. Al final, solo son más dolores de cabeza para los que de verdad hacemos el trabajo. No tengo tiempo para esto.',
                is_end: true,
                feedback: 'Resultado: RECHAZO. Al defender tu idea directamente, ignoraste su estado emocional. Chocaste contra su muro en lugar de rodearlo. No se sintió escuchado y se cerró en banda.'
            },
            'node_validate': {
                npc_line: 'Bueno, al menos no eres un optimista ciego. Tienes razón, hemos visto muchas ideas ir y venir. ¿Qué hace que esto sea diferente?',
                options: [
                    { text: 'Presentar la idea como una solución a su "dolor".', technique: 'Reencuadre + Justificación', target_node: 'node_reframe' },
                    { text: 'Presumir de los beneficios de la idea.', technique: 'Argumentación Lógica', target_node: 'node_defense' }
                ]
            },
            'node_frame_power': {
                npc_line: '¿Perdona? Mira, no sé de dónde vienes tú, pero aquí valoramos la experiencia, no las ínfulas de grandeza. Si crees que esto va a funcionar, buena suerte. Yo no cuentes conmigo.',
                is_end: true,
                feedback: 'Resultado: HOSTILIDAD. Intentaste imponer un marco de poder sin haber construido rapport ni autoridad. Se sintió atacado y reaccionó de forma agresiva. El control del marco sin calibración es un desastre.'
            },
            'node_reframe': {
                npc_line: 'Hmm... eso que dices sobre los informes manuales es cierto, es una pérdida de tiempo enorme. ¿De verdad crees que tu idea puede solucionar eso?',
                options: [
                    { text: 'Cerrar con una petición grande.', technique: 'Exageración', target_node: 'node_fail_close' },
                    { text: 'Cerrar con una petición pequeña y concreta.', technique: 'Pie en la Puerta', target_node: 'node_success_close' }
                ]
            },
            'node_fail_close': {
                npc_line: '¡Uf! ¿Implementar todo un sistema nuevo? Olvídalo. Es demasiado riesgo y demasiado trabajo. No va a pasar.',
                is_end: true,
                feedback: 'Resultado: ABUMADO. Has pasado de 0 a 100. La idea le interesaba, pero tu petición fue demasiado grande y activó de nuevo su aversión al riesgo. Debiste pedir un paso más pequeño.'
            },
            'node_success_close': {
                npc_line: '¿Una reunión de 15 minutos? Sin PowerPoints, solo tú, yo y una pizarra... Vale, eso es razonable. El jueves por la mañana tengo un hueco. A ver qué tienes.',
                is_end: true,
                feedback: '¡ÉXITO! Has validado su emoción, reencuadrado la idea como una solución a su problema y has cerrado con una petición pequeña y de bajo riesgo. Has convertido a un escéptico en un posible colaborador.'
            }
        }
    },
        'sim-2': {
    title: 'La Guardiana',
    description: 'Tu objetivo: Necesitas hablar urgentemente con un directivo (Sr. Morales), pero su asistente personal (Laura) es extremadamente protectora y tiene instrucciones de no interrumpirle.',
    npc: { name: 'Laura', mood: 'Profesional y firme' },
    conversation: {
        'start': {
            npc_line: 'Buenas tardes, oficina del Sr. Morales. ¿En qué puedo ayudarle?',
            options: [
                { text: 'Exigir hablar con él por la urgencia.', technique: 'Presión', target_node: 'node_demand' },
                { text: 'Validar su rol y crear afinidad.', technique: 'Validación + Afinidad', target_node: 'node_ally' },
                { text: 'Intentar engañarla sobre la importancia.', technique: 'Engaño', target_node: 'node_deceive' }
            ]
        },
        'node_demand': {
            npc_line: 'Entiendo que es urgente para usted, pero el Sr. Morales está en una reunión crucial y me ha pedido explícitamente que no le interrumpa. Si me deja el recado, me aseguraré de que lo reciba.',
            is_end: true,
            feedback: 'Resultado: BLOQUEADO. Tu urgencia no es su urgencia. Al presionarla, la pusiste a la defensiva y activaste su modo "guardiana".'
        },
        'node_deceive': {
            npc_line: '¿Un asunto personal? El Sr. Morales no me ha informado de que esperara ninguna llamada personal. Tendrá que darme más detalles o dejar un recado como todo el mundo.',
            is_end: true,
            feedback: 'Resultado: SOSPECHA. Intentaste un engaño poco creíble. Los asistentes experimentados han oído todas las excusas y tu falta de transparencia te ha hecho parecer poco fiable.'
        },
        'node_ally': {
            npc_line: 'Le agradezco su comprensión. Es un día complicado. ¿De qué se trata exactamente?',
            options: [
                { text: 'Explicar el problema y pedirle su consejo.', technique: 'Posicionarla como experta', target_node: 'node_expert' },
                { text: 'Minimizar el problema para no preocuparla.', technique: 'Restar importancia', target_node: 'node_minimize' }
            ]
        },
        'node_minimize': {
            npc_line: 'Si es un "pequeño detalle", entonces seguro que puede esperar. Le daré el recado cuando el Sr. Morales se desocupe.',
            is_end: true,
            feedback: 'Resultado: POSPUESTO. Al minimizar el problema, le diste la excusa perfecta para no tratarlo como una prioridad. Contradijiste tu propia necesidad de urgencia.'
        },
        'node_expert': {
            npc_line: 'Vaya, eso que me cuentas sobre el servidor sí que suena importante... y él odia los problemas técnicos. Mira, ahora mismo es imposible, pero tiene una pausa de 5 minutos en 15 minutos. Si te acercas a su despacho entonces, le pasaré una nota diciendo que es una emergencia técnica. Es lo mejor que puedo ofrecer.',
            is_end: true,
            feedback: '¡ÉXITO! No luchaste contra la guardiana, la convertiste en tu aliada. Validaste su rol, le diste la información de forma transparente y le pediste consejo, posicionándola como la experta que puede solucionar tu problema de acceso. Ella te ha abierto la puerta.'
        }
    }
},
'sim-3': {
    title: 'El Cliente Furioso',
    description: 'Tu objetivo: Un cliente llama furioso porque un producto llegó tarde y defectuoso. Debes calmarlo y encontrar una solución para retenerlo.',
    npc: { name: 'Cliente', mood: 'Furioso' },
    conversation: {
        'start': {
            npc_line: '¡Estoy harto! ¡No solo el pedido llega tres días tarde, sino que la caja está rota y el producto no funciona! ¡Es inaceptable! ¡Quiero mi dinero de vuelta ahora mismo!',
            options: [
                { text: 'Pedirle que se calme y explicarle el procedimiento.', technique: 'Racionalización', target_node: 'node_calm_down' },
                { text: 'Disculparse inmediatamente y ofrecer una solución.', technique: 'Solución Rápida', target_node: 'node_quick_fix' },
                { text: 'Dejar que se desahogue y etiquetar su emoción.', technique: 'Escucha Activa + Etiquetado', target_node: 'node_listen' }
            ]
        },
        'node_calm_down': {
            npc_line: '¡No me digas que me calme! ¡Tengo todo el derecho a estar enfadado! ¡Pásame con tu supervisor ahora mismo!',
            is_end: true,
            feedback: 'Resultado: ESCALADA. Nunca le pidas a alguien enfadado que se calme. Se interpreta como una invalidación de sus sentimientos y solo aumenta su ira.'
        },
        'node_quick_fix': {
            npc_line: 'No quiero otro producto, ¿no me has oído? ¡Vuestra empresa es un desastre! ¡Quiero mi dinero y punto!',
            is_end: true,
            feedback: 'Resultado: RECHAZO. Te adelantaste. Al ofrecer una solución antes de que el cliente se sintiera escuchado, pareció que solo querías quitarte el problema de encima, no que entendías su frustración.'
        },
        'node_listen': {
            npc_line: '¡Pues claro que estoy frustrado! ¡He perdido tiempo y dinero por vuestra culpa! ... (suspira) ... Vale, ¿y ahora qué?',
            options: [
                { text: 'Explicar por qué ocurrió el problema.', technique: 'Justificación', target_node: 'node_explain' },
                { text: 'Ofrecer una solución que compense el daño.', technique: 'Reciprocidad + Solución', target_node: 'node_solution' }
            ]
        },
        'node_explain': {
            npc_line: '¡A mí no me importan vuestros problemas de logística! ¡Me importa que me habéis fallado! ¡Esto es increíble!',
            is_end: true,
            feedback: 'Resultado: IRRELEVANTE. Al cliente no le importan tus excusas o razones, solo su problema. Justificar el error solo echa más leña al fuego de su frustración.'
        },
        'node_solution': {
            npc_line: '¿Un reembolso completo y me envían uno nuevo sin coste por las molestias? ... Bueno... supongo que es aceptable. Al menos alguien se hace responsable. De acuerdo, procedamos así.',
            is_end: true,
            feedback: '¡ÉXITO! Dejaste que el cliente expresara su ira, validaste su emoción y luego ofreciste una solución que no solo arreglaba el problema, sino que compensaba las molestias. Convertiste un desastre en una oportunidad para demostrar un excelente servicio al cliente.'
        }
    }
},
'sim-4': {
    title: 'La Entrevista de Trabajo',
    description: 'Estás en una entrevista para un puesto que realmente quieres. El entrevistador te lanza la pregunta clásica para ponerte a prueba.',
    npc: { name: 'Entrevistador', mood: 'Analítico' },
    conversation: {
        'start': {
            npc_line: 'Tu currículum es impresionante. Pero todo el mundo tiene puntos débiles. Dime, ¿cuál es tu mayor debilidad?',
            options: [
                { text: 'Dar una falsa debilidad que es en realidad una fortaleza.', technique: 'Respuesta Cliché', target_node: 'node_cliche' },
                { text: 'Mencionar una debilidad real pero irrelevante para el puesto.', technique: 'Evasión', target_node: 'node_irrelevant' },
                { text: 'Admitir una debilidad real y enmarcarla en el crecimiento.', technique: 'Reencuadre Honesto', target_node: 'node_reframe' }
            ]
        },
        'node_cliche': {
            npc_line: 'Ya veo. "Perfeccionista". Es la respuesta que da todo el mundo. Seamos un poco más originales, por favor.',
            is_end: true,
            feedback: 'Resultado: PÉRDIDA DE CREDIBILIDAD. Esta respuesta es tan usada que suena falsa y poco original. El entrevistador la interpreta como una falta de autoconciencia.'
        },
        'node_irrelevant': {
            npc_line: 'Entiendo. Bueno, es bueno saber que no se te da bien cocinar, pero me gustaría que nos centráramos en el ámbito profesional. Volvamos a la pregunta.',
            is_end: true,
            feedback: 'Resultado: EVASIVO. El entrevistador percibe que estás esquivando la pregunta, lo que puede interpretarse como que tienes algo que ocultar.'
        },
        'node_reframe': {
            npc_line: 'Interesante. Así que reconoces que la delegación era un punto a mejorar y has tomado pasos activos para solucionarlo. Eso demuestra madurez y autoconciencia. Muy bien. Hablemos ahora de tus expectativas salariales.',
            is_end: true,
            feedback: '¡ÉXITO! No has negado tener una debilidad, lo cual te hace humano y creíble. Has elegido una debilidad real, has demostrado que eres consciente de ella y, lo más importante, has probado que eres proactivo para mejorar. Has convertido una pregunta trampa en una demostración de tu capacidad de crecimiento.'
        }
    }
},
'sim-5': {
    title: 'El Grupo Cerrado',
    description: 'Estás en un evento y ves a un grupo de personas, incluyendo a alguien que te interesa conocer. El grupo está en una conversación animada y parece difícil entrar.',
    npc: { name: 'Grupo', mood: 'Animado y cerrado' },
    conversation: {
        'start': {
            npc_line: '(El grupo está riendo sobre una broma interna. Te acercas y hay una pausa mientras te miran).',
            options: [
                { text: 'Presentarte directamente e interrumpir.', technique: 'Interrupción', target_node: 'node_interrupt' },
                { text: 'Quedarte cerca en silencio, esperando que te incluyan.', technique: 'Pasividad', target_node: 'node_passive' },
                { text: 'Escuchar, encontrar un punto de entrada y hacer una pregunta abierta.', technique: 'Escucha Activa + Pregunta Abierta', target_node: 'node_listen_ask' }
            ]
        },
        'node_interrupt': {
            npc_line: '(Sonrisas educadas pero forzadas). "Hola". La conversación se detiene torpemente y luego alguien intenta retomarla, excluyéndote sutilmente.',
            is_end: true,
            feedback: 'Resultado: EXCLUSIÓN. Interrumpir una conversación fluida es socialmente torpe. El grupo, para proteger su dinámica, te ha dejado fuera.'
        },
        'node_passive': {
            npc_line: '(El grupo te ignora educadamente y continúa su conversación. Te sientes cada vez más incómodo y fuera de lugar).',
            is_end: true,
            feedback: 'Resultado: IGNORADO. La gente absorta en una conversación rara vez se detiene para incluir a un extraño. La responsabilidad de entrar era tuya.'
        },
        'node_listen_ask': {
            npc_line: '"¡Exacto! Estábamos hablando de la última temporada de esa serie. ¿Tú también la has visto?".',
            is_end: true,
            feedback: '¡ÉXITO! No interrumpiste, sino que demostraste que estabas prestando atención. Tu pregunta abierta sobre el tema que ya estaban tratando fue la invitación perfecta para que te incluyeran. Has entrado en el círculo.'
        }
    }
},
'sim-6': {
    title: 'Conflicto de Equipo',
    description: 'Dos miembros clave de tu equipo, Ana (creativa) y David (analítico), están discutiendo acaloradamente sobre cómo abordar un nuevo proyecto.',
    npc: { name: 'Ana y David', mood: 'Enfrentados' },
    conversation: {
        'start': {
            npc_line: 'Ana: "¡Tu enfoque es demasiado rígido, matará la creatividad!". David: "¡Y tu enfoque es un caos, nos hará perder tiempo y dinero!".',
            options: [
                { text: 'Tomar partido por la idea que crees que es mejor.', technique: 'Tomar Partido', target_node: 'node_side' },
                { text: 'Decirles que dejen de discutir y se pongan a trabajar.', technique: 'Autoritarismo', target_node: 'node_authoritarian' },
                { text: 'Mediar, validando ambos puntos de vista.', technique: 'Mediación y Reencuadre', target_node: 'node_mediate' }
            ]
        },
        'node_side': {
            npc_line: '(El miembro al que no apoyaste se cruza de brazos, resentido). "Vale, si creéis que esa es la mejor forma, allá vosotros. Luego no digáis que no os lo advertí".',
            is_end: true,
            feedback: 'Resultado: EQUIPO DIVIDIDO. Al tomar partido, has creado un ganador y un perdedor. Has alienado a un miembro del equipo y has dañado la moral del grupo.'
        },
        'node_authoritarian': {
            npc_line: '(Ambos te miran con resentimiento. La discusión se detiene, pero la tensión es palpable. El trabajo se hará de mala gana).',
            is_end: true,
            feedback: 'Resultado: CALMA Tensa. Has detenido la discusión, pero no has resuelto el conflicto. La tensión subyacente afectará negativamente al proyecto.'
        },
        'node_mediate': {
            npc_line: 'Ana: "Bueno, supongo que un poco de estructura no vendría mal...". David: "Y supongo que podríamos ser más flexibles en la fase inicial...".',
            is_end: true,
            feedback: '¡ÉXITO! No tomaste partido. En lugar de eso, actuaste como un líder. Validaste las preocupaciones de ambos, reencuadraste el problema como un objetivo común y les hiciste responsables de encontrar una solución conjunta. Has transformado un conflicto en una colaboración.'
        }
    }
},
'sim-7': {
    title: 'La Negociación Salarial',
    description: 'Te han ofrecido un puesto que te encanta, pero el salario ofrecido es un 10% menor de lo que esperabas y de lo que crees que vales.',
    npc: { name: 'Director de RRHH', mood: 'Amable pero firme' },
    conversation: {
        'start': {
            npc_line: 'Estamos muy contentos de ofrecerte el puesto con un salario de 50.000€. Creemos que es una oferta muy competitiva.',
            options: [
                { text: 'Aceptar la oferta por miedo a perder el puesto.', technique: 'Conformismo', target_node: 'node_accept' },
                { text: 'Rechazar la oferta de plano si no suben a 55.000€.', technique: 'Ultimátum', target_node: 'node_ultimatum' },
                { text: 'Agradecer la oferta y presentar un caso basado en valor.', technique: 'Negociación Basada en Valor', target_node: 'node_value' }
            ]
        },
        'node_accept': {
            npc_line: '¡Fantástico! Nos alegramos de tenerte a bordo. Te enviaré el contrato ahora mismo.',
            is_end: true,
            feedback: 'Resultado: ACEPTADO PERO... Has conseguido el trabajo, pero has dejado dinero sobre la mesa y probablemente sentirás un ligero resentimiento. Has perdido la oportunidad de ser valorado en tu justo precio.'
        },
        'node_ultimatum': {
            npc_line: 'Entiendo. 50.000€ es nuestra oferta final para este nivel. Es una pena, te deseamos mucha suerte en tu búsqueda.',
            is_end: true,
            feedback: 'Resultado: OFERTA RETIRADA. Un ultimátum cierra la puerta a la negociación. La empresa prefiere perder un candidato a ceder ante una demanda inflexible.'
        },
        'node_value': {
            npc_line: 'Entiendo tu punto. El valor que aportas en [área específica] es ciertamente alto. Déjame ver qué puedo hacer. ¿Qué te parecerían 53.500€ y una revisión en 6 meses? Es lo máximo que puedo estirar el presupuesto.',
            is_end: true,
            feedback: '¡ÉXITO! No has exigido, has justificado. Al expresar tu entusiasmo, reafirmar tu valor con datos y mantener la conversación abierta, has conseguido que el director de RRHH se convierta en tu aliado para encontrar una solución. Has negociado un aumento significativo y has ganado respeto.'
        }
    }
},
'sim-8': {
    title: 'El Rival "Amistoso"',
    description: 'En una reunión de equipo, después de tu presentación, un colega conocido por ser muy competitivo te lanza un cumplido envenenado.',
    npc: { name: 'Colega Rival', mood: 'Sarcástico' },
    conversation: {
        'start': {
            npc_line: '¡Vaya presentación! Es increíble cómo has conseguido montar algo tan decente con tan poco tiempo. ¡Felicidades!',
            options: [
                { text: 'Enfrentarte a él directamente.', technique: 'Confrontación', target_node: 'node_confront' },
                { text: 'Ignorar el sarcasmo y agradecer el "cumplido".', technique: 'Pasividad', target_node: 'node_passive_agressive' },
                { text: 'Aceptar el cumplido y reencuadrar el veneno con humor.', technique: 'Reencuadre (Amused Mastery)', target_node: 'node_reframe_humor' }
            ]
        },
        'node_confront': {
            npc_line: '"¡Oye, tranquilo! ¡Solo era una broma! Parece que alguien no se aguanta nada..." (El resto del equipo se siente incómodo).',
            is_end: true,
            feedback: 'Resultado: PIERDES ESTATUS. Has caído en su trampa. Al reaccionar a la defensiva, le has dado el poder y has quedado como alguien que no tiene sentido del humor o que es demasiado sensible.'
        },
        'node_passive_agressive': {
            npc_line: '(Sonríe, satisfecho). "De nada".',
            is_end: true,
            feedback: 'Resultado: HAS PERDIDO. Al aceptar el cumplido envenenado, has aceptado su marco. Él te ha menospreciado sutilmente y tú lo has permitido.'
        },
        'node_reframe_humor': {
            npc_line: '(Se queda ligeramente descolocado por tu respuesta, sin saber cómo continuar. El resto del equipo sonríe ante tu ingenio).',
            is_end: true,
            feedback: '¡ÉXITO! Has demostrado un control del marco magistral. No has reaccionado a su provocación. Has cogido la parte positiva (el cumplido), has exagerado la parte negativa con humor y has mantenido un estatus alto. Le has desarmado por completo.'
        }
    }
},
'sim-9': {
    title: 'La Cita Incómoda',
    description: 'Estás en una primera cita. La conversación inicial ha fluido bien, pero de repente se produce un silencio incómodo y ambos os quedáis sin saber qué decir.',
    npc: { name: 'Cita', mood: 'Nerviosa/o' },
    conversation: {
        'start': {
            npc_line: '(Silencio... ambos miráis alrededor, evitando el contacto visual).',
            options: [
                { text: 'Hacer una pregunta genérica y aburrida.', technique: 'Pregunta de Relleno', target_node: 'node_boring' },
                { text: 'Entrar en pánico y hablar de ti mismo sin parar.', technique: 'Monólogo Nervioso', target_node: 'node_monologue' },
                { text: 'Reconocer el silencio con humor y cambiar de tema.', technique: 'Romper el Marco', target_node: 'node_break_frame' }
            ]
        },
        'node_boring': {
            npc_line: '"Sí, hace buen tiempo..." (La conversación muere de nuevo, la incomodidad aumenta).',
            is_end: true,
            feedback: 'Resultado: MÁS INCOMODIDAD. Has intentado rellenar el silencio con algo aburrido, lo que solo ha acentuado la falta de conexión en ese momento.'
        },
        'node_monologue': {
            npc_line: '(Asiente educadamente, pero sus ojos parecen vidriosos. Está claro que ha desconectado y está abrumado por tu verborrea).',
            is_end: true,
            feedback: 'Resultado: DESCONEXIÓN. El pánico te ha hecho egocéntrico. En lugar de crear una conversación de dos, la has convertido en un monólogo que ha alejado a la otra persona.'
        },
        'node_break_frame': {
            npc_line: '(Se ríe, visiblemente aliviada). "¡Totalmente! ¡Jajaja! Vale, mi turno. Pregunta aleatoria: ¿cuál es el viaje más raro que has hecho?".',
            is_end: true,
            feedback: '¡ÉXITO! Has hecho lo más valiente y efectivo: has reconocido la situación (el marco de "silencio incómodo") y lo has destruido con humor. Al hacerlo, has eliminado toda la presión y has demostrado confianza y habilidades sociales, permitiendo que la conversación se reinicie de forma divertida y relajada.'
        }
    }
},
'sim-10': {
    title: 'El Vago del Grupo',
    description: 'Estás en un proyecto universitario importante. Un miembro del equipo, Carlos, no ha entregado su parte y está poniendo en riesgo la nota de todos.',
    npc: { name: 'Carlos', mood: 'Evasivo' },
    conversation: {
        'start': {
            npc_line: 'Cuando le preguntas por su parte, te dice: "Sí, sí, tranquilo. Lo tengo casi listo. He estado súper liado con otras cosas".',
            options: [
                { text: 'Acusarle directamente de vago y amenazar con hablar con el profesor.', technique: 'Confrontación Agresiva', target_node: 'node_threat' },
                { text: 'Hacer su parte del trabajo para evitar el conflicto.', technique: 'Evasión del Conflicto', target_node: 'node_avoidance' },
                { text: 'Usar un enfoque de "nosotros" y establecer un compromiso claro.', technique: 'Marco Colaborativo', target_node: 'node_collaborative' }
            ]
        },
        'node_threat': {
            npc_line: '"¿Ah, sí? ¡Pues habla con el profesor! ¡A ver qué te dice! ¡Yo también puedo contarle un par de cosas! ¡Ahora sí que no hago nada!"',
            is_end: true,
            feedback: 'Resultado: GUERRA ABIERTA. La agresión ha generado más agresión. Carlos se ha puesto a la defensiva y ahora saboteará activamente el proyecto. El equipo está roto.'
        },
        'node_avoidance': {
            npc_line: '"¡Genial, gracias! ¡Sabía que podía contar contigo!".',
            is_end: true,
            feedback: 'Resultado: RESENTIMIENTO. Has evitado el conflicto, pero has creado un precedente terrible. Carlos ha aprendido que puede aprovecharse de ti, y tú te sentirás resentido, lo que afectará a tu motivación y a la dinámica del grupo.'
        },
        'node_collaborative': {
            npc_line: '(Suspira, un poco avergonzado). "Tienes razón... he estado procrastinando. Vale, me comprometo. Esta tarde a las 7 te envío mi parte terminada. Gracias por el toque".',
            is_end: true,
            feedback: '¡ÉXITO! No le has atacado a él, sino al problema. Has usado un marco de "nosotros" para recordarle que estáis en el mismo barco. Has validado su "estar liado" pero sin aceptar la excusa, y le has hecho verbalizar un compromiso específico (hora y fecha). Has salvado el proyecto y mantenido la integridad del equipo.'
        }
    }
}
        
};
      
      const mentalism_exercises = {
    'me-1': {
        title: 'Ejercicio: Forzaje de un Número (1-4)',
        description: 'Tu objetivo es guiar a un sujeto a elegir el NÚMERO 3, pero haciendo que sienta que la elección fue suya. Debes usar la lógica para eliminar sutilmente las otras opciones.',
        target_choice: 'El número 3',
        npc: { name: 'Sujeto de Prueba Alfa' },
        script_options: [
            {
                text: '"Piensa en un número del 1 al 4. Concéntrate. ¿Ya lo tienes? Era el 3, ¿verdad?".',
                technique_summary: 'Adivinación Directa (Baja Probabilidad)',
                is_correct: false,
                feedback: 'INCORRECTO. Esto no es mentalismo, es una simple adivinanza. No has hecho nada para guiar al sujeto, simplemente has apostado. La probabilidad de éxito es solo del 25% y no demuestra ninguna habilidad.'
            },
            {
                text: '"Quiero que pienses en un número del 1 al 4. La gente suele elegir el 3, así que concéntrate en ese número. Piensa en el 3. ¿Lo tienes?".',
                technique_summary: 'Instrucción Directa (Obvio)',
                is_correct: false,
                feedback: 'INCORRECTO. Esto es una orden, no una siembra sutil. El sujeto es consciente de que le estás diciendo qué pensar. El efecto de "leer su mente" se pierde por completo, ya que no hubo libre elección.'
            },
            {
                text: '"Piensa en un número del 1 al 4. Generalmente, evitamos los extremos como el 1 y el 4 por ser demasiado obvios. Entre el 2 y el 3, el 2 es el único par, lo que lo hace destacar. Simplemente deja que el número más neutral y libre aparezca en tu mente... ¿lo tienes ya?".',
                technique_summary: 'Eliminación Lógica (Correcta)',
                is_correct: true,
                feedback: '¡CORRECTO! Esta es la técnica clásica. Has creado un laberinto psicológico que guía al sujeto. Descartaste el 1 y el 4 como "obvios" y el 2 como "demasiado único", dejando el 3 como la opción más cómoda y aparentemente "libre". Has maximizado tus probabilidades de forma elegante.'
            }
        ]
    },
        'me-2': {
    title: 'Ejercicio: Forzaje de un Color (Primado)',
    description: 'Tu objetivo es hacer que el sujeto piense en el color ROJO. No puedes mencionarlo directamente. Debes usar el "primado", tejiendo sutilmente palabras y conceptos asociados al rojo en tu guion inicial.',
    target_choice: 'El color ROJO',
    npc: { name: 'Sujeto de Prueba Beta' },
    script_options: [
        {
            text: '"Voy a ser muy directo. Piensa en coches de bomberos, en señales de stop, en la cruz roja... ahora, sin que te influya, elige un color. El que sea".',
            technique_summary: 'Lista Directa (Demasiado Obvio)',
            is_correct: false,
            feedback: 'INCORRECTO. Esto no es primado, es una lista de la compra. Has revelado tu intención de forma tan evidente que el sujeto es consciente del truco. El efecto se rompe y es probable que elija otro color solo por rebeldía o para demostrar que no es tan fácil de manipular.'
        },
        {
            text: '"Quiero que te relajes. Conecta con una emoción poderosa... la PASIÓN... la FUERZA... siente la ENERGÍA que fluye, como el latido de tu CORAZÓN. Deja que un color que represente esa intensidad aparezca en tu mente... ¿lo tienes?".',
            technique_summary: 'Primado Emocional (Correcta)',
            is_correct: true,
            feedback: '¡CORRECTO! Esta es la ejecución perfecta del primado. No has mencionado el color, pero has activado todos los conceptos neurológicamente asociados a él: pasión, fuerza, energía, corazón. Has preparado su mente para que "ROJO" sea la respuesta más disponible y natural, pareciendo una elección totalmente interna.'
        },
        {
            text: '"Visualiza los colores del mundo. El azul profundo del OCÉANO, la furia roja de un VOLCÁN, el verde tranquilo de un BOSQUE, la alegría amarilla del SOL... elige el que más te llame".',
            technique_summary: 'Primado Múltiple (Confuso)',
            is_correct: false,
            feedback: 'INCORRECTO. Has creado "ruido" mental. Al dar el mismo peso y descripciones vívidas a múltiples colores, has diluido el efecto y has convertido el ejercicio en una elección verdaderamente libre. El primado efectivo requiere enfocar toda la energía sutil en un solo objetivo.'
        }
    ]
},
    'me-3': {
    type: 'reading', // <-- ¡Nueva propiedad importante!
    title: 'Ejercicio: La Elección Oculta (Lectura No Verbal)',
    description: 'Un sujeto ha escondido una moneda en una de sus manos. Tu objetivo es adivinar en cuál. No puedes ver la moneda, solo puedes hacer preguntas de prueba y analizar las descripciones de sus reacciones no verbales para detectar la verdad.',
    npc: { name: 'Sujeto de Prueba Gamma' },
    secret_location: 'derecha', // La respuesta correcta.
    probing_questions: [
        {
            id: 'q1',
            text: 'Preguntar por la mano DERECHA',
            reaction: 'El sujeto traga saliva. Hay una microtensión en sus labios, casi imperceptible. Sus pupilas se dilatan ligeramente por una fracción de segundo mientras se concentra en esa mano.'
        },
        {
            id: 'q2',
            text: 'Preguntar por la mano IZQUIERDA',
            reaction: 'El sujeto asiente con la cabeza de forma un poco más obvia y su rostro parece relajado, casi demasiado. Parpadea sin tensión aparente.'
        }
    ],
    final_choices: {
        'derecha': {
            is_correct: true,
            feedback: '¡CORRECTO! Las pistas estaban en la mano DERECHA. La tensión en los labios, el tragar saliva y la dilatación de las pupilas son signos de una mayor carga cognitiva. Su cerebro estaba trabajando más para proteger el secreto que guardaba en esa mano.'
        },
        'izquierda': {
            is_correct: false,
            feedback: 'INCORRECTO. La aparente calma y relajación al pensar en la mano IZQUIERDA era la verdadera pista. A menudo, es más fácil para el cerebro construir una mentira (una mano vacía) que ocultar una verdad (la mano con la moneda), por lo que la reacción es menos tensa.'
        }
    }
},
    'me-4': {
    type: 'reading',
    title: 'Ejercicio: Detectar la Mentira',
    description: 'Un sujeto va a hacer una afirmación. Primero, establecerás una línea base de su comportamiento al decir la verdad. Luego, analizarás su reacción a la afirmación clave para determinar si miente.',
    npc: { name: 'Sujeto de Prueba Delta' },
    secret_location: 'mentira', // La respuesta correcta.
    probing_questions: [
        {
            id: 'q1',
            text: 'Establecer Línea Base: "¿Qué desayunaste hoy?"',
            reaction: 'Responde "Un café y tostadas". Su contacto visual es estable, sin tensión en la cara, y su cuerpo está relajado. Esta es su apariencia normal al decir la verdad.'
        },
        {
            id: 'q2',
            text: 'Analizar Afirmación Clave: "La semana pasada escalé una montaña".',
            reaction: 'Mientras lo dice, toca brevemente su nariz (un gesto pacificador), y sus ojos se desvían hacia la derecha (construcción visual para un diestro). Su parpadeo aumenta ligeramente.'
        }
    ],
    final_choices: {
        'verdad': {
            is_correct: false,
            feedback: 'INCORRECTO. Los gestos pacificadores (tocarse la cara) y las claves de acceso ocular que apuntan a la "construcción" en lugar de al "recuerdo" son fuertes indicadores de que el cerebro está trabajando más de lo normal para inventar una historia. La reacción se desvía de su línea base.'
        },
        'mentira': {
            is_correct: true,
            feedback: '¡CORRECTO! Has detectado las señales. El tocarse la nariz es un intento inconsciente de calmar el estrés de mentir. El desvío de la mirada hacia la zona de "construcción visual" (en lugar de la de recuerdo) sugiere que está inventando la imagen en lugar de recordarla. ¡Excelente calibración!'
        }
    }
},
'me-5': {
    title: 'Ejercicio: Forzar una Forma Simple (Estrella)',
    description: 'Tu objetivo es implantar la idea de una ESTRELLA en la mente del sujeto, usando únicamente el primado verbal y conceptual.',
    target_choice: 'La forma de una ESTRELLA',
    npc: { name: 'Sujeto de Prueba Epsilon' },
    script_options: [
        {
            text: '"Imagina el cielo nocturno. Piensa en algo que BRILLA a lo lejos, un símbolo de la FAMA y el ÉXITO. Algo a lo que le pides un DESEO. Una forma con cinco PUNTAS... Deja que esa forma se dibuje en tu mente".',
            technique_summary: 'Primado Conceptual y Poético (Correcta)',
            is_correct: true,
            feedback: '¡PERFECTO! Has utilizado un enfoque múltiple: cielo nocturno, brillar, fama, deseo, puntas. Cada concepto es un camino que lleva directamente a la idea de una estrella, haciendo que esta elección sea casi inevitable pero sintiéndose poética y personal.'
        },
        {
            text: '"Piensa en una forma geométrica. No un círculo, no un cuadrado. Piensa en la bandera de Estados Unidos o en la que ponen en el árbol de Navidad. Concéntrate en esa forma".',
            technique_summary: 'Ejemplos Directos (Poco Sutil)',
            is_correct: false,
            feedback: 'INCORRECTO. Aunque podrías acertar, esto es demasiado directo. Estás dando ejemplos explícitos en lugar de permitir que la idea surja de conceptos más abstractos. El sujeto es consciente de que le estás guiando, lo que reduce el impacto del efecto mentalista.'
        },
        {
            text: '"Voy a ser claro. Olvídate de los círculos, cuadrados y triángulos. Piensa en una estrella. La forma que tienes en mente es una estrella, ¿a que sí?".',
            technique_summary: 'Adivinanza con Pista Obvia',
            is_correct: false,
            feedback: 'INCORRECTO. Esto elimina toda sutileza y arte. Simplemente estás declarando la respuesta que quieres, lo que no tiene nada que ver con la implantación psicológica. No hay efecto de "lectura mental".'
        }
    ]
},
'me-6': {
    title: 'Ejercicio: Forzar un Animal (Elefante)',
    description: 'Tu objetivo es hacer que el sujeto piense en un ELEFANTE. Para ello, combinarás la eliminación de categorías con la famosa técnica de la negación.',
    target_choice: 'Un ELEFANTE',
    npc: { name: 'Sujeto de Prueba Zeta' },
    script_options: [
        {
            text: '"Piensa en un animal grande. Podría ser un león, una jirafa, un rinoceronte o un elefante. Elige uno de ellos".',
            technique_summary: 'Opción Múltiple (Reduce Probabilidades)',
            is_correct: false,
            feedback: 'INCORRECTO. Al dar una lista de opciones válidas, conviertes el ejercicio en una elección consciente. Has reducido el universo de "todos los animales" a solo cuatro, pero no has forzado una elección específica.'
        },
        {
            text: '"Quiero que pienses en un animal. No un animal doméstico como un perro o un gato. Tampoco un rey de la selva como un león. Piensa en algo GRANDE, pesado, de color gris, con una MEMORIA prodigiosa... y por favor, NO pienses en un ELEFANTE".',
            technique_summary: 'Primado por Negación (Correcta)',
            is_correct: true,
            feedback: '¡MAGISTRAL! Esta es la técnica del "oso blanco". Para procesar la orden de "no pensar en un elefante", el cerebro primero debe visualizar un elefante, anclando la imagen con fuerza. Combinado con las pistas previas (grande, gris, memoria), has hecho casi imposible que piense en otra cosa.'
        },
        {
            text: '"Piensa en un animal que viva en África o en la India. Uno muy, muy grande. ¿Lo tienes?".',
            technique_summary: 'Demasiado Amplio',
            is_correct: false,
            feedback: 'INCORRECTO. Tu descripción es demasiado vaga. Un rinoceronte, un hipopótamo y otros animales encajan en esa descripción. El primado no ha sido lo suficientemente específico para asegurar el resultado.'
        }
    ]
},
'me-7': {
    type: 'reading',
    title: 'Ejercicio: Identificar la Emoción Genuina',
    description: 'Un colega te comunica una decisión. Sus palabras dicen una cosa, pero su lenguaje no verbal podría decir otra. Tu objetivo es identificar la emoción real que está sintiendo.',
    npc: { name: 'Colega' },
    secret_location: 'decepción', // La emoción real
    probing_questions: [
        {
            id: 'q1',
            text: 'Analizar la afirmación: "El jefe ha decidido darle el proyecto a Laura. Honestamente, me alegro por ella. Es la mejor decisión para el equipo."',
            reaction: 'Al decir "me alegro por ella", sus hombros caen muy ligeramente por una fracción de segundo y las comisuras de sus labios se tensan hacia abajo antes de forzar una sonrisa.'
        }
    ],
    final_choices: {
        'alegría': {
            is_correct: false,
            feedback: 'INCORRECTO. La sonrisa fue forzada y posterior a la verdadera emoción. La clave estaba en las señales que aparecieron ANTES de la expresión socialmente aceptable.'
        },
        'decepción': {
            is_correct: true,
            feedback: '¡CORRECTO! Has detectado la incongruencia. La caída de hombros y la microexpresión de tristeza (comisuras hacia abajo) son una fuga de su verdadera emoción: la decepción por no haber recibido él el proyecto. Su sonrisa posterior fue una máscara social.'
        },
        'indiferencia': {
            is_correct: false,
            feedback: 'INCORRECTO. La indiferencia se caracteriza por una falta de reacción. Sin embargo, aquí hubo una reacción clara y emocional, aunque fuera rápida y reprimida. Su cuerpo demostró que sí le importaba.'
        }
    }
},
'me-8': {
    title: 'Ejercicio: Forzar una Ciudad (París)',
    description: 'Tu objetivo es hacer que el sujeto piense en la ciudad de PARÍS, evocando imágenes y sensaciones sin dar pistas geográficas obvias.',
    target_choice: 'PARÍS',
    npc: { name: 'Sujeto de Prueba Theta' },
    script_options: [
        {
            text: '"Piensa en una ciudad europea famosa por su gastronomía y su historia. Podría ser Roma, Madrid, Lisboa, París... deja que una te llegue".',
            technique_summary: 'Lista de Opciones',
            is_correct: false,
            feedback: 'INCORRECTO. Esto es una elección, no un forzaje. Al dar una lista de opciones igualmente válidas, no estás guiando la mente del sujeto hacia una respuesta específica.'
        },
        {
            text: '"Imagina que estás en un viaje. Es la ciudad del AMOR. Oyes un acordeón sonando mientras paseas por un río. Por la noche, una TORRE icónica se llena de LUCES parpadeantes. Hueles a pan recién hecho... Concéntrate en esa ciudad".',
            technique_summary: 'Primado Multisensorial (Correcta)',
            is_correct: true,
            feedback: '¡EXCELENTE! Has atacado múltiples sentidos y emociones. Amor, acordeón, torre de luces, pan... cada pista es un ancla que apunta inequívocamente a París. Has pintado un cuadro mental tan vívido que es difícil escapar de él.'
        },
        {
            text: '"Piensa en la capital de Francia. La ciudad donde está el museo del Louvre y la catedral de Notre Dame. ¿Ya sabes cuál es?".',
            technique_summary: 'Pregunta de Trivial',
            is_correct: false,
            feedback: 'INCORRECTO. Esto no es mentalismo, es una pregunta de geografía. Estás pidiendo un dato, no implantando una idea. El efecto de "leer la mente" es nulo.'
        }
    ]
},
'me-9': {
    type: 'reading',
    title: 'Ejercicio: ¿Qué Objeto Visualiza?',
    description: 'El sujeto ha elegido mentalmente uno de tres objetos que le has mostrado: una LLAVE, un ANILLO, una PELOTA. Debes adivinar cuál es analizando sus reacciones al nombrarlos.',
    npc: { name: 'Sujeto de Prueba Iota' },
    secret_location: 'anillo', // La respuesta correcta
    probing_questions: [
        {
            id: 'q1',
            text: 'Nombrar el primer objeto: "Concéntrate en la LLAVE. Visualízala."',
            reaction: 'El sujeto mantiene una expresión neutra. No hay cambios visibles.'
        },
        {
            id: 'q2',
            text: 'Nombrar el segundo objeto: "Ahora olvida la llave. Concéntrate en el ANILLO."',
            reaction: 'Justo al oír la palabra, muestra una levísima sonrisa, una microexpresión de placer que desaparece al instante. Su respiración se detiene por un momento.'
        },
        {
            id: 'q3',
            text: 'Nombrar el tercer objeto: "Finalmente, borra todo lo demás y visualiza la PELOTA."',
            reaction: 'El sujeto frunce el ceño ligeramente, como si le costara trabajo visualizar el objeto.'
        }
    ],
    final_choices: {
        'llave': {
            is_correct: false,
            feedback: 'INCORRECTO. La reacción a "llave" fue completamente neutra, lo que indica que no había ninguna conexión emocional o mental con ese objeto.'
        },
        'anillo': {
            is_correct: true,
            feedback: '¡CORRECTO! La microexpresión de placer (la sonrisa fugaz) fue la clave. Los objetos con valor personal o emocional (como un anillo) a menudo provocan una reacción genuina que es muy difícil de reprimir. La contención de la respiración también indica un pico de atención.'
        },
        'pelota': {
            is_correct: false,
            feedback: 'INCORRECTO. El ceño fruncido indica dificultad o confusión, no el reconocimiento de un pensamiento ya presente. Probablemente le costó crear la imagen mental porque su cerebro ya estaba "ocupado" con el anillo.'
        }
    }
},
'me-10': {
    title: 'Ejercicio: Forzar un Sentimiento (Calma)',
    description: 'Tu objetivo es inducir un estado de CALMA en el sujeto utilizando lenguaje hipnótico y anclajes verbales.',
    target_choice: 'Un estado de CALMA',
    npc: { name: 'Sujeto de Prueba Kappa' },
    script_options: [
        {
            text: '"Escucha el sonido de mi voz... y mientras lo haces, puedes EMPEZAR A SENTIR cómo cada músculo de tu cuerpo se RELAJA... tu respiración se vuelve más LENTA y PROFUNDA... y una sensación de PAZ te invade... sin prisa... simplemente permitiendo que la CALMA llegue...".',
            technique_summary: 'Lenguaje Hipnótico (Correcta)',
            is_correct: true,
            feedback: '¡MUY BIEN! Has utilizado los principios del Modelo Milton de la hipnosis: frases permisivas ("puedes empezar a sentir"), palabras de proceso ("relaja", "lenta"), y sugestiones enlazadas ("mientras escuchas... sientes..."). Has guiado su estado interno de forma elegante.'
        },
        {
            text: '"¡Relájate ahora mismo! Tienes que calmarte. Deja de estar tenso y simplemente cálmate. ¡Es una orden!".',
            technique_summary: 'Comandos Directos y Agresivos',
            is_correct: false,
            feedback: 'INCORRECTO. La relajación no puede ser forzada con órdenes directas. Este enfoque genera resistencia y el efecto contrario. La mente se rebela contra los comandos autoritarios, especialmente en lo que respecta a estados internos.'
        },
        {
            text: '"¿Por qué no te relajas un poco? Parece que estás muy tenso. ¿Te ayudaría si te calmaras? Deberías intentar sentirte más en paz".',
            technique_summary: 'Preguntas y Lógica',
            is_correct: false,
            feedback: 'INCORRECTO. Estás intentando razonar con un estado emocional. Al preguntar y analizar, mantienes al sujeto en su mente consciente y analítica, lo que impide que acceda a un estado de calma subconsciente. La sugestión debe ser evocadora, no lógica.'
        }
    ]
},
    'me-11': {
    title: 'Ejercicio: Forzar un Destino de Viaje',
    description: 'Tu objetivo es hacer que el sujeto piense en la PLAYA. Debes evocar las sensaciones y emociones asociadas sin nombrar el lugar directamente.',
    target_choice: 'La PLAYA',
    npc: { name: 'Sujeto de Prueba Lambda' },
    script_options: [
        {
            text: '"Piensa en un lugar de vacaciones. Puede ser la montaña, una ciudad o la playa. Elige uno".',
            technique_summary: 'Elección Directa',
            is_correct: false,
            feedback: 'INCORRECTO. Esto es una elección libre. No estás influyendo en la decisión, solo presentando las opciones más comunes, lo que deja el resultado al azar.'
        },
        {
            text: '"Imagina que estás de vacaciones. Siente el CALOR del sol en tu piel, escucha el SONIDO rítmico de las OLAS, siente la ARENA entre los dedos de los pies y el olor a SAL en el aire... ¿En qué lugar estás pensando?".',
            technique_summary: 'Primado Sensorial Completo (Correcta)',
            is_correct: true,
            feedback: '¡PERFECTO! Has bombardeado al sujeto con anclajes sensoriales que apuntan inequívocamente a un solo lugar. Has activado el tacto (calor, arena), el oído (olas) y el olfato (sal). La playa se convierte en la única respuesta lógica a esa acumulación de sensaciones.'
        },
        {
            text: '"Piensa en un lugar con agua. Podría ser un río, un lago o el mar. Concéntrate en uno".',
            technique_summary: 'Demasiado Ambiguo',
            is_correct: false,
            feedback: 'INCORRECTO. Aunque has acotado las opciones, "un lugar con agua" sigue siendo demasiado amplio. Un lago y el mar evocan sensaciones muy diferentes. Tu siembra carece de la especificidad necesaria para asegurar el resultado.'
        }
    ]
},
'me-12': {
    type: 'reading',
    title: 'Ejercicio: El Dibujo Secreto (Círculo vs. Cuadrado)',
    description: 'Un sujeto ha dibujado una de dos formas en un papel que no puedes ver: un CÍRCULO o un CUADRADO. Tu objetivo es adivinar cuál es, analizando cómo describe su dibujo.',
    npc: { name: 'Sujeto de Prueba My' },
    secret_location: 'círculo', // La respuesta correcta
    probing_questions: [
        {
            id: 'q1',
            text: 'Pedir una descripción: "Sin decirme la forma, describe cómo te sientes al pensar en tu dibujo".',
            reaction: 'Responde: "Es... fluido... continuo... suave. No tiene principio ni fin. Es una forma muy natural y fluida".'
        }
    ],
    final_choices: {
        'cuadrado': {
            is_correct: false,
            feedback: 'INCORRECTO. Las palabras que eligió (fluido, continuo, suave, sin fin) son representaciones verbales de las cualidades de un círculo. Un cuadrado evocaría palabras como "sólido", "estructurado", "ángulos", "recto".'
        },
        'círculo': {
            is_correct: true,
            feedback: '¡CORRECTO! Has aplicado la lectura de lenguaje. Las palabras que una persona usa para describir algo revelan la cualidad de ese algo. "Fluido", "continuo" y "suave" son descripciones perfectas para un círculo. Has escuchado más allá de lo evidente.'
        }
    }
},
'me-13': {
    title: 'Ejercicio: Forzar un Nombre (David)',
    description: 'Tu objetivo es hacer que el sujeto piense en el nombre DAVID, utilizando una combinación de primado histórico y conceptual.',
    target_choice: 'DAVID',
    npc: { name: 'Sujeto de Prueba Ny' },
    script_options: [
        {
            text: '"Piensa en un nombre de hombre, uno muy común en nuestra cultura. Puede ser Juan, Pedro, Carlos, David... elige uno".',
            technique_summary: 'Lista de Sugerencias',
            is_correct: false,
            feedback: 'INCORRECTO. De nuevo, esto es una elección, no un forzaje. Al dar una lista, no estás guiando la mente, solo limitando las opciones de forma obvia.'
        },
        {
            text: '"Piensa en un nombre bíblico, uno famoso. Un REY de Israel. Un hombre conocido por su coraje, que venció a un GIGANTE con una sola piedra. El autor de los Salmos. Un nombre que representa la victoria contra todo pronóstico... Deja que ese nombre resuene en tu mente".',
            technique_summary: 'Primado por Referencia Cultural (Correcta)',
            is_correct: true,
            feedback: '¡EXCELENTE! Has utilizado la narrativa y la cultura compartida. Cada pista (rey, gigante, salmos) es un embudo que descarta otros nombres y dirige al sujeto directamente hacia David. La historia es tan conocida que el nombre se vuelve la única respuesta posible.'
        },
        {
            text: '"Piensa en un nombre masculino que empiece por la letra D. Daniel, Darío, Diego, David... elige el que más te guste".',
            technique_summary: 'Forzaje Alfabético Limitado',
            is_correct: false,
            feedback: 'INCORRECTO. Limitar por la inicial es una técnica, pero sigue ofreciendo demasiadas alternativas comunes. No hay una razón psicológica para que el sujeto prefiera David sobre Diego o Daniel, por lo que el resultado sigue siendo incierto.'
        }
    ]
},
'me-14': {
    title: 'Ejercicio: La Salida Múltiple (Número 1-100)',
    description: 'Esta es una técnica avanzada. Tu objetivo es "adivinar" un número en el que piensa un sujeto, pero teniendo preparadas varias "salidas" o revelaciones que parezcan específicas.',
    target_choice: 'Cualquier número', // El objetivo no es forzar, sino adivinar.
    npc: { name: 'Sujeto de Prueba Xi' },
    script_options: [
        {
            text: 'Revelación directa: "El número en el que piensas es el 37".',
            technique_summary: 'Adivinanza Pura (Muy Arriesgada)',
            is_correct: false,
            feedback: 'INCORRECTO. A menos que tengas una suerte increíble, fallarás. Esta técnica carece de red de seguridad. Un mentalista profesional nunca se deja a sí mismo con una única y arriesgada posibilidad de éxito.'
        },
        {
            text: 'Revelación por aproximación: "Veo dos dígitos... son similares... es un número repetido, como el 22, 33 o 44... ¿es uno de esos?".',
            technique_summary: 'Reducción de Opciones',
            is_correct: false,
            feedback: 'INCORRECTO. Aunque es mejor que adivinar un solo número, sigues dependiendo demasiado de la suerte. Si el número no es repetido, has fallado de forma muy obvia.'
        },
        {
            text: 'Revelación con "Múltiples Salidas": Escribes "37" en un papel y lo guardas. Preguntas: "¿Es un número par o impar?". Si dice IMPAR: "Como el que escribí". Si dice PAR, sigues: "¿Alto o bajo de 50?". Si dice ALTO: "Bien, y tu número, ¿tiene los dos dígitos diferentes?". Si dice SÍ, revelas "37" (o cualquier otro) como un acierto improbable. Si en cualquier punto la respuesta no encaja, dices: "Perfecto, eso es lo que necesitaba para borrar las otras opciones de mi mente. El número era el [número que sea]".',
            technique_summary: 'Múltiples Salidas (Correcta)',
            is_correct: true,
            feedback: '¡CORRECTO! Esta es la esencia de muchas rutinas de mentalismo. No adivinas, filtras la información. Cada pregunta que haces te permite eliminar posibilidades, pero lo enmarcas como si estuvieras "acercándote" a la respuesta. La revelación final parece un milagro, pero en realidad es el final de un proceso de eliminación lógico y astuto. El secreto es tener un plan para cada respuesta posible.'
        }
    ]
},
'me-15': {
    type: 'reading',
    title: 'Ejercicio: ¿Qué Mano Miente?',
    description: 'Un sujeto tiene ambas manos cerradas. En una, imagina la VERDAD (un recuerdo real). En la otra, la MENTIRA (un evento inventado). Debes detectar la mano de la mentira.',
    npc: { name: 'Sujeto de Prueba Ómicron' },
    secret_location: 'derecha', // La mentira está en la derecha.
    probing_questions: [
        {
            id: 'q1',
            text: 'Analizar la mano IZQUIERDA (La Verdad): "Concéntrate en la historia de esta mano".',
            reaction: 'Al hablar de ella, su tono es congruente. Hay un brillo de emoción genuina en sus ojos. Su lenguaje corporal es abierto y relajado.'
        },
        {
            id: 'q2',
            text: 'Analizar la mano DERECHA (La Mentira): "Ahora, háblame de la historia de esta otra mano".',
            reaction: 'Al hablar, su mano se acerca a su boca (gesto de bloqueo). El ritmo de su habla es ligeramente más lento, como si pensara cada palabra. Evita el contacto visual directo.'
        }
    ],
    final_choices: {
        'izquierda': {
            is_correct: false,
            feedback: 'INCORRECTO. La congruencia entre tono, emoción y lenguaje corporal en la mano izquierda son fuertes indicadores de que estaba accediendo a un recuerdo real y cómodo.'
        },
        'derecha': {
            is_correct: true,
            feedback: '¡CORRECTO! Has detectado las señales de la mentira. El gesto de bloqueo (mano a la boca), la ralentización del habla (mayor carga cognitiva para inventar) y la evitación del contacto visual son un cúmulo de pistas que apuntan a la fabricación de una historia.'
        }
    }
},
'me-16': {
    title: 'Ejercicio: El Doble Sentido',
    description: 'Esta es una técnica verbal avanzada. El objetivo es hacer una afirmación que pueda interpretarse de dos maneras. Si aciertas, parece que lo supiste todo el tiempo. Si fallas, tu afirmación sigue teniendo sentido.',
    target_choice: 'Un viaje reciente del sujeto',
    npc: { name: 'Sujeto de Prueba Pi' },
    script_options: [
        {
            text: '"Veo que has estado de viaje en la playa recientemente".',
            technique_summary: 'Afirmación Específica (Arriesgada)',
            is_correct: false,
            feedback: 'INCORRECTO. Es demasiado específico. Si no ha ido a la playa, has fallado. No tienes red de seguridad.'
        },
        {
            text: '"Noto una energía de movimiento a tu alrededor... como si hubieras estado viajando... o quizás anhelando hacerlo pronto. Hay una imagen de agua y sol en tu mente."',
            technique_summary: 'Doble Sentido y Lenguaje Barnum (Correcta)',
            is_correct: true,
            feedback: '¡CORRECTO! Esta es una obra maestra de la ambigüedad. "Viajando o anhelando viajar" cubre ambas posibilidades. "Agua y sol" puede ser una playa, un lago, una piscina... Si ha viajado, confirmará tu acierto. Si no, dirá "¡Sí, muero por irme de vacaciones a un lugar así!", y tu afirmación seguirá pareciendo perceptiva. Has ganado sin importar la respuesta.'
        },
        {
            text: '"¿Te has ido de vacaciones últimamente?".',
            technique_summary: 'Pregunta Directa',
            is_correct: false,
            feedback: 'INCORRECTO. Esto es una simple pregunta, no mentalismo. Estás pidiendo información, no demostrando una percepción especial.'
        }
    ]
},
'me-17': {
    title: 'Ejercicio: Forzar un Recuerdo de la Infancia',
    description: 'Tu objetivo es hacer que el sujeto piense en un recuerdo relacionado con un COLUMPIO, utilizando una narrativa evocadora.',
    target_choice: 'Recuerdo de un COLUMPIO',
    npc: { name: 'Sujeto de Prueba Rho' },
    script_options: [
        {
            text: '"Quiero que vuelvas a tu infancia. A un parque. Siente ese movimiento de vaivén... hacia adelante y hacia atrás... cada vez más alto... sintiendo el viento en la cara y esa sensación de volar por un instante. ¿Qué recuerdo te viene a la mente?".',
            technique_summary: 'Primado Kinestésico (Correcta)',
            is_correct: true,
            feedback: '¡PERFECTO! Has utilizado el primado kinestésico, enfocado en la sensación del movimiento. "Vaivén", "adelante y atrás", "cada vez más alto", "volar"... todas estas descripciones físicas apuntan a una única experiencia infantil común: el columpio. Es muy probable que hayas activado ese recuerdo específico.'
        },
        {
            text: '"Piensa en tu juguete favorito del parque cuando eras niño. ¿Era el tobogán, el columpio, el pasamanos?".',
            technique_summary: 'Lista de Opciones',
            is_correct: false,
            feedback: 'INCORRECTO. De nuevo, le estás dando a elegir de forma consciente. El poder del mentalismo reside en guiar la mente de forma subconsciente.'
        },
        {
            text: '"Recuerda cuando jugabas en el parque de niño. ¿Te gustaba columpiarte?".',
            technique_summary: 'Pregunta Cerrada',
            is_correct: false,
            feedback: 'INCORRECTO. Estás preguntando directamente, lo que arruina el efecto. El objetivo es que la idea del columpio surja en su mente como si fuera un recuerdo espontáneo que tú has sido capaz de "captar".'
        }
    ]
},
'me-18': {
    type: 'reading',
    title: 'Ejercicio: La Mentira por Omisión',
    description: 'Tu amigo te cuenta una historia, pero sospechas que está omitiendo un detalle clave. Tu objetivo es identificar la incongruencia que delata la omisión.',
    npc: { name: 'Amigo' },
    secret_location: 'incongruencia',
    probing_questions: [
        {
            id: 'q1',
            text: 'Escuchar la historia: "La reunión fue bien. Presenté los datos, respondí a las preguntas y el cliente pareció satisfecho. Cerramos todos los puntos de la agenda".',
            reaction: 'La historia es lógicamente coherente y su tono es seguro. Sin embargo, justo después de decir "el cliente pareció satisfecho", se encoge de hombros de forma casi imperceptible durante una fracción de segundo.'
        }
    ],
    final_choices: {
        'historia_completa': {
            is_correct: false,
            feedback: 'INCORRECTO. La historia verbal era perfecta, pero el cuerpo no miente. Un encogimiento de hombros es un gesto universal de duda o falta de convicción sobre lo que se acaba de decir.'
        },
        'incongruencia': {
            is_correct: true,
            feedback: '¡CORRECTO! Has detectado la fuga no verbal. El encogimiento de hombros contradice directamente la afirmación verbal "el cliente pareció satisfecho". Probablemente, el cliente mostró alguna señal de duda o desacuerdo que tu amigo está omitiendo. Ahí es donde debes indagar.'
        }
    }
},
'me-19': {
    title: 'Ejercicio: Forzar una Herramienta',
    description: 'El objetivo es que el sujeto piense en la herramienta más arquetípica: un MARTILLO.',
    target_choice: 'Un MARTILLO',
    npc: { name: 'Sujeto de Prueba Sigma' },
    script_options: [
        {
            text: '"Piensa en una caja de herramientas. Visualiza un destornillador, una llave inglesa, un martillo. Concéntrate en uno".',
            technique_summary: 'Elección Limitada',
            is_correct: false,
            feedback: 'INCORRECTO. Aunque es una de las opciones, no has hecho nada para que sea la elección más probable.'
        },
        {
            text: '"Nombra la primera herramienta que te venga a la mente".',
            technique_summary: 'Respuesta Espontánea',
            is_correct: false,
            feedback: 'INCORRECTO. Aunque "martillo" es una respuesta común, dependes de la estadística pura. No hay técnica ni influencia de tu parte.'
        },
        {
            text: '"Imagina que tienes que construir algo simple, de madera. Tienes que UNIR dos piezas. Necesitas GOLPEAR un clavo con FUERZA y PRECISIÓN. Piensa en la herramienta que usarías para CLAVAR esa idea en su sitio. ¿Qué herramienta tienes en la mente?".',
            technique_summary: 'Primado por Función y Metáfora (Correcta)',
            is_correct: true,
            feedback: '¡EXCELENTE! Has utilizado un enfoque muy inteligente. Has descrito la función ("golpear", "unir", "clavar") en lugar del objeto. La mente del sujeto busca automáticamente la herramienta que cumple esa función. Al final, usaste una metáfora ("clavar esa idea") que refuerza aún más el concepto. Muy sutil y efectivo.'
        }
    ]
},
'me-20': {
    title: 'Ejercicio: La Predicción Escrita (Billet Peek)',
    description: 'Esta es una simulación de una de las técnicas más potentes: el "Billet Peek". El sujeto escribe un dato secreto (el nombre de su mascota) y tú debes "adivinarlo".',
    target_choice: 'El nombre de la mascota',
    npc: { name: 'Sujeto de Prueba Tau' },
    script_options: [
        {
            text: 'Le das un papel, le pides que escriba el nombre, lo doble y te lo entregue para "sentir las vibraciones". Lo sostienes en tu frente y te concentras.',
            technique_summary: 'Actuación Mística',
            is_correct: false,
            feedback: 'INCORRECTO. Esto es solo teatro. Sin un método para conocer la información, no tienes ninguna posibilidad de acertar. La habilidad no está en "sentir", sino en obtener la información de forma encubierta.'
        },
        {
            text: 'Le das un papel y un portapapeles. Le pides que escriba el nombre. Mientras lo hace, le haces una pregunta para distraerle y miras disimuladamente lo que escribe.',
            technique_summary: 'Mirada Directa (Muy Arriesgada)',
            is_correct: false,
            feedback: 'INCORRECTO. Es un método muy arriesgado y poco sofisticado. Si te pillan mirando (lo que es muy probable), el truco queda expuesto y tu credibilidad destruida.'
        },
        {
            text: 'Le das un pequeño bloc de notas y un bolígrafo. Le pides que escriba el nombre en la hoja superior, la arranque y la doble. Mientras él dobla, tú sostienes el bloc y, con un movimiento natural, tu pulgar presiona la segunda hoja, dejando una leve marca del bolígrafo. Te quedas con el bloc (y la información) y él con el papel doblado.',
            technique_summary: 'Impresión Oculta (Técnica Clásica)',
            is_correct: true,
            feedback: '¡CORRECTO! Esta es una simulación de un método clásico. Has obtenido la información de forma secreta. La información no se adivina, se obtiene. El resto del acto (concentrarse, fingir leer la mente) es puro teatro para presentar la información que ya conoces de una manera impactante. La verdadera habilidad fue el movimiento sutil e invisible.'
        }
    ]
},
   'me-21': {
    type: 'reading',
    title: 'Ejercicio: Dos Verdades, Una Mentira',
    description: 'El sujeto dirá tres frases sobre sí mismo. Dos son ciertas, una es falsa. Tu objetivo es detectar la mentira analizando las diferencias en su comportamiento no verbal.',
    npc: { name: 'Sujeto de Prueba Alfa 2.0' },
    secret_location: 'frase_2', // La mentira
    probing_questions: [
        {
            id: 'q1',
            text: 'Frase 1: "Tengo dos hermanos".',
            reaction: 'Lo dice con un tono de voz neutro y relajado. Mantiene un contacto visual normal. No hay tensión.'
        },
        {
            id: 'q2',
            text: 'Frase 2: "Una vez gané un concurso de talentos cantando".',
            reaction: 'Al decirlo, una sonrisa muy leve y fugaz (casi una mueca) cruza su cara. Toca su cuello brevemente y su ritmo de habla es un poco más rápido de lo normal.'
        },
        {
            id: 'q3',
            text: 'Frase 3: "Mi comida favorita es la pasta".',
            reaction: 'Su expresión es congruente y relajada, similar a la primera afirmación. Asiente ligeramente al terminar, como reafirmando un hecho simple.'
        }
    ],
    final_choices: {
        'frase_1': {
            is_correct: false,
            feedback: 'INCORRECTO. La reacción a esta frase fue tu línea base. Su comportamiento era relajado y congruente, típico de alguien que declara un hecho simple y verdadero.'
        },
        'frase_2': {
            is_correct: true,
            feedback: '¡CORRECTO! Detectaste las anomalías. La sonrisa fugaz es conocida como "placer del engaño" (duper\'s delight). El tocarse el cuello es un gesto pacificador para calmar los nervios de mentir, y el habla acelerada es un intento de "salir" de la mentira lo antes posible. La mentira era la frase 2.'
        },
        'frase_3': {
            is_correct: false,
            feedback: 'INCORRECTO. Al igual que en la primera frase, el comportamiento aquí fue consistente con su línea base de verdad. No había señales de estrés o incongruencia.'
        }
    }
},
'me-22': {
    title: 'Ejercicio: Forzar una Emoción (Nostalgia)',
    description: 'Tu objetivo es evocar un sentimiento de NOSTALGIA en el sujeto, utilizando lenguaje evocador y sensorial.',
    target_choice: 'Sentimiento de NOSTALGIA',
    npc: { name: 'Sujeto de Prueba Beta 2.0' },
    script_options: [
        {
            text: '"Quiero que recuerdes tu infancia. Piensa en un momento feliz. ¿Ya lo tienes? Concéntrate en ese sentimiento".',
            technique_summary: 'Instrucción Directa',
            is_correct: false,
            feedback: 'INCORRECTO. Aunque la instrucción es clara, es demasiado lógica. Estás pidiendo que recuerde, no estás induciendo el estado emocional. La nostalgia es más compleja que la simple felicidad.'
        },
        {
            text: '"Permítete volver atrás por un momento... a una tarde de verano de hace mucho tiempo... el olor de la hierba o del asfalto mojado... una canción lejana que sonaba en la radio... esa sensación agridulce de un momento que ya pasó pero que te hace sonreír... deja que esa emoción te envuelva".',
            technique_summary: 'Inducción Sensorial y Evocadora (Correcta)',
            is_correct: true,
            feedback: '¡PERFECTO! Has creado un tapiz de sensaciones. Usaste disparadores universales (verano, música, olores) y definiste la emoción con precisión ("agridulce", "momento que ya pasó"). No le dijiste qué sentir, le diste los ingredientes para que su propia mente cocinara el sentimiento de nostalgia.'
        },
        {
            text: '"Piensa en algo que te ponga triste del pasado. Ahora piensa en algo que te ponga feliz. Mezcla los dos sentimientos".',
            technique_summary: 'Enfoque Analítico',
            is_correct: false,
            feedback: 'INCORRECTO. Este enfoque es demasiado mecánico y analítico. La mente consciente se interpone al tratar de "mezclar" emociones como si fueran colores, impidiendo que el sentimiento surja de forma natural y subconsciente.'
        }
    ]
},
'me-23': {
    title: 'Ejercicio: Forzar una Carta (Reina de Corazones)',
    description: 'Un clásico del mentalismo. Tu objetivo es guiar al sujeto a pensar en la REINA DE CORAZONES usando primado conceptual.',
    target_choice: 'La Reina de Corazones',
    npc: { name: 'Sujeto de Prueba Gamma 2.0' },
    script_options: [
        {
            text: '"Imagina una baraja. Concéntrate en las cartas de figuras. Ahora piensa en una carta roja. ¿Es la Reina de Corazones?".',
            technique_summary: 'Filtrado Progresivo',
            is_correct: false,
            feedback: 'INCORRECTO. Esto es un juego de 20 preguntas, no un forzaje. Estás reduciendo las opciones de forma lógica y obvia, no influyendo sutilmente en la elección inicial.'
        },
        {
            text: '"Visualiza una baraja. Olvida los números, son fríos. Céntrate en las figuras, que tienen personalidad. Piensa en la realeza... en el símbolo universal del AMOR, de la PASIÓN. La figura femenina más importante, el CORAZÓN de la baraja... Deja que esa carta se forme en tu mente".',
            technique_summary: 'Primado por Concepto y Metáfora (Correcta)',
            is_correct: true,
            feedback: '¡EXCELENTE! Has utilizado un lenguaje puramente conceptual. "Realeza femenina" apunta a las reinas. "Amor", "pasión" y "corazón" apuntan al palo de corazones de forma abrumadora. Has hecho que la Reina de Corazones sea la respuesta emocional y simbólica a tu acertijo poético.'
        },
        {
            text: '"Quiero que pienses en una carta. No es una pica. No es un trébol. No es un diamante. No es un Rey. No es una Jota. ¿En qué carta piensas?".',
            technique_summary: 'Eliminación Directa',
            is_correct: false,
            feedback: 'INCORRECTO. Aunque la eliminación puede funcionar, esta es una forma torpe y aburrida de hacerlo. No hay sutileza ni arte, y el sujeto es plenamente consciente de que lo estás acorralando.'
        }
    ]
},
'me-24': {
    type: 'reading',
    title: 'Ejercicio: El PIN Secreto',
    description: 'Un sujeto ha pensado en un PIN de 2 dígitos (ej. 25). Vas a "leer" su reacción mientras dices los números en voz alta para adivinar cada dígito.',
    npc: { name: 'Sujeto de Prueba Delta 2.0' },
    secret_location: '48', // El PIN secreto es 48.
    probing_questions: [
        {
            id: 'q1',
            text: 'Descubrir el PRIMER dígito: "Voy a contar del 1 al 5. Concéntrate... UNO... DOS... TRES... CUATRO... CINCO..."',
            reaction: 'En los números 1, 2, 3 y 5, el sujeto permanece impasible. Al decir "CUATRO", hay una súbita inhalación de aire, casi inaudible, y un parpadeo.'
        },
        {
            id: 'q2',
            text: 'Descubrir el SEGUNDO dígito: "Ahora el segundo dígito, del 6 al 9. Concéntrate... SEIS... SIETE... OCHO... NUEVE..."',
            reaction: 'En los números 6, 7 y 9, su rostro está relajado. Al decir "OCHO", los músculos alrededor de sus ojos se tensan por un instante, como si estuviera "reconociendo" el número.'
        }
    ],
    final_choices: {
        '48': {
            is_correct: true,
            feedback: '¡CORRECTO! El PIN era 48. Has identificado correctamente las microreacciones. La inhalación súbita al oír "cuatro" y la tensión ocular al oír "ocho" fueron las fugas de información que revelaron los dígitos correctos. La clave es buscar la reacción que es diferente a las demás.'
        },
        '28': {
            is_correct: false,
            feedback: 'INCORRECTO. Acertaste el segundo dígito, pero fallaste el primero. La reacción al "dos" fue neutra, mientras que la del "cuatro" (la inhalación) fue una clara señal de reconocimiento.'
        },
        '46': {
            is_correct: false,
            feedback: 'INCORRECTO. Acertaste el primer dígito, pero fallaste el segundo. La tensión ocular al oír "ocho" fue la pista clave. No hubo reacción anómala al "seis".'
        }
    }
},
'me-25': {
    title: 'Ejercicio: Forzar un Dibujo Simple',
    description: 'Tu objetivo es hacer que el sujeto dibuje una CASA, sin darle ninguna instrucción directa.',
    target_choice: 'Un dibujo de una CASA',
    npc: { name: 'Sujeto de Prueba Epsilon 2.0' },
    script_options: [
        {
            text: '"Dibuja algo simple. Un cuadrado con un triángulo encima. Añade una puerta y un par de ventanas. ¿Qué has dibujado?".',
            technique_summary: 'Instrucciones Geométricas',
            is_correct: false,
            feedback: 'INCORRECTO. Le has guiado como a un robot. No hay espacio para la interpretación ni para el efecto mentalista. Es un ejercicio de dictado, no de influencia.'
        },
        {
            text: '"Quiero que hagas un dibujo muy simple, como los que hacíamos de niños. Dibuja un lugar que represente SEGURIDAD, FAMILIA, un REFUGIO. El primer lugar que te venga a la mente cuando piensas en la palabra HOGAR. Un dibujo simple, con líneas rectas y un techo".',
            technique_summary: 'Primado por Concepto Emocional (Correcta)',
            is_correct: true,
            feedback: '¡PERFECTO! Has utilizado las palabras clave más poderosas asociadas con una casa: seguridad, familia, refugio, hogar. Al evocar la niñez, has activado el arquetipo de dibujo infantil de una casa. Las pistas finales ("líneas rectas", "techo") cierran el círculo sin ser demasiado obvias.'
        },
        {
            text: '"Dibuja tu casa. La casa donde vives ahora mismo".',
            technique_summary: 'Petición Directa',
            is_correct: false,
            feedback: 'INCORRECTO. Le estás pidiendo que copie algo real, lo que requiere un esfuerzo consciente y analítico. El objetivo del forzaje es que la idea surja de forma espontánea y subconsciente.'
        }
    ]
},
'me-26': {
    type: 'reading',
    title: 'Ejercicio: ¿Qué Emoción Oculta?',
    description: 'Tu amigo acaba de recibir una noticia. Te dice que está contento, pero sospechas que oculta otra cosa. Debes identificar la emoción real.',
    npc: { name: 'Amigo' },
    secret_location: 'miedo', // La emoción real
    probing_questions: [
        {
            id: 'q1',
            text: 'Analizar la afirmación: "¡Me han ascendido! ¡Por fin voy a liderar el proyecto! Estoy muy contento."',
            reaction: 'Dice "contento", pero su sonrisa es tensa y no involucra a los ojos. Sus ojos están más abiertos de lo normal y sus cejas ligeramente levantadas y juntas. Respira de forma superficial.'
        }
    ],
    final_choices: {
        'alegría': {
            is_correct: false,
            feedback: 'INCORRECTO. La sonrisa no era una sonrisa de Duchenne (una sonrisa genuina, que involucra los ojos). Los indicadores clave estaban en la parte superior del rostro.'
        },
        'miedo': {
            is_correct: true,
            feedback: '¡CORRECTO! Has leído las señales de forma brillante. Los ojos muy abiertos, las cejas levantadas y juntas, y la respiración superficial son los tres componentes clásicos de la microexpresión del miedo o la ansiedad. Probablemente está abrumado por la nueva responsabilidad. Sus palabras decían alegría, pero su cuerpo gritaba "miedo".'
        },
        'sorpresa': {
            is_correct: false,
            feedback: 'INCORRECTO. Aunque el miedo y la sorpresa comparten los ojos abiertos, la sorpresa implica cejas arqueadas pero no juntas, y la boca suele abrirse. La tensión en las cejas apuntaba al miedo.'
        }
    }
},
'me-27': {
    title: 'Ejercicio: La Palabra de la Revista (Forzaje)',
    description: 'Simulas un "test de libro". Tu objetivo es que el sujeto elija mentalmente una palabra CORTA y COMÚN de una página imaginaria, y que esa palabra sea LUZ.',
    target_choice: 'LUZ',
    npc: { name: 'Sujeto de Prueba Zeta 2.0' },
    script_options: [
        {
            text: '"Imagina una página de revista. Ahora quiero que pienses en la palabra más brillante de la página. La que más ilumine. ¿La tienes?".',
            technique_summary: 'Metáfora Directa',
            is_correct: false,
            feedback: 'INCORRECTO. La metáfora es demasiado obvia y poética. No se siente como una elección libre, sino como un acertijo. El sujeto es consciente de que intentas guiarle hacia una palabra relacionada con la luz.'
        },
        {
            text: '"Imagina una página llena de palabras. No te fijes en las de abajo, sino en la parte superior. No en las largas y complejas. Concéntrate en una palabra corta y simple. Una que represente la CLARIDAD, el CONOCIMIENTO, lo opuesto a la OSCURIDAD... Deja que esa palabra te llegue".',
            technique_summary: 'Forzaje por Concepto y Posición (Correcta)',
            is_correct: true,
            feedback: '¡EXCELENTE! Has usado múltiples capas. Has dirigido su atención espacialmente ("parte superior"), has definido las características ("corta", "simple") y, lo más importante, has primado el concepto ("claridad", "conocimiento", "opuesto a oscuridad"). La palabra "LUZ" se convierte en la solución lógica y natural a todas esas restricciones.'
        },
        {
            text: '"Elige cualquier palabra de una página imaginaria. Ahora, ¿la palabra tiene que ver con la iluminación?".',
            technique_summary: 'Pesca de Información',
            is_correct: false,
            feedback: 'INCORRECTO. Esto es simplemente adivinar y luego preguntar. No hay ninguna técnica de influencia o forzaje en la elección inicial.'
        }
    ]
},
'me-28': {
    title: 'Ejercicio: El Anclaje Espacial',
    description: 'Asociarás dos conceptos (TRABAJO y VACACIONES) a dos espacios físicos (tu mano derecha e izquierda). Luego, adivinarás en cuál piensa el sujeto observando su mirada.',
    target_choice: 'La elección del sujeto (VACACIONES)',
    npc: { name: 'Sujeto de Prueba Theta 2.0' },
    script_options: [
        {
            text: 'Paso 1: "Quiero que imagines en tu mano derecha todo lo relacionado con el TRABAJO: el estrés, los plazos, la oficina". Paso 2: "Ahora, en tu mano izquierda, imagina las VACACIONES: la playa, la relajación, la libertad". Paso 3: "Elige uno de los dos conceptos. Mírame a mí y no a tus manos. ¿Ya lo tienes?".',
            technique_summary: 'Creación de Anclajes Espaciales (Correcta)',
            is_correct: true,
            feedback: '¡CORRECTO! Has establecido los anclajes. Aunque el sujeto te mire a ti, cuando le pidas que piense en su elección, sus ojos harán un movimiento casi imperceptible hacia el espacio que has anclado con ese concepto (en este caso, hacia su izquierda para "vacaciones"). Este es el paso preparatorio crucial.'
        },
        {
            text: '"Piensa en el trabajo o en las vacaciones. ¿En qué estás pensando?".',
            technique_summary: 'Sin Anclaje',
            is_correct: false,
            feedback: 'INCORRECTO. Sin anclar primero los conceptos a un espacio físico, no tienes nada que leer. Sus pensamientos no tienen una "dirección" que puedas calibrar con la mirada.'
        },
        {
            text: '"Imagina el trabajo en tu mano derecha y las vacaciones en tu mano izquierda. Ahora dime cuál has elegido".',
            technique_summary: 'Anclaje con Petición Directa',
            is_correct: false,
            feedback: 'INCORRECTO. El anclaje funciona, pero el efecto se arruina si pides la respuesta directamente. El propósito del anclaje espacial es crear una pista no verbal para que puedas "leer" la mente, no para que te den la respuesta.'
        }
    ]
},
'me-29': {
    type: 'reading',
    title: 'Ejercicio: La Decisión de Compra',
    description: 'Un cliente potencial ha visto dos productos, uno caro (Opción A) y uno barato (Opción B). Te dice su decisión, pero debes leer su verdadera convicción.',
    npc: { name: 'Cliente Potencial' },
    secret_location: 'duda', // La emoción real
    probing_questions: [
        {
            id: 'q1',
            text: 'Analizar la afirmación: "Sí, después de pensarlo, me quedaré con la Opción B, la más barata. Es la decisión más lógica".',
            reaction: 'Mientras lo dice, asiente con la cabeza, pero hay una ligera arruga en su nariz, una microexpresión de asco/disgusto. Además, su mirada se desvía brevemente hacia la Opción A (la cara).'
        }
    ],
    final_choices: {
        'convicción': {
            is_correct: false,
            feedback: 'INCORRECTO. Sus palabras decían una cosa ("decisión lógica"), pero su cuerpo contaba otra historia. La congruencia es clave.'
        },
        'duda': {
            is_correct: true,
            feedback: '¡CORRECTO! Has detectado la incongruencia. La microexpresión de disgusto revela que no está contento con la opción barata. Su mirada hacia la opción cara delata su verdadero deseo. Verbalmente ha elegido la opción B, pero emocionalmente sigue anclado en la A. Esto es una oportunidad para indagar sobre qué le frena de elegir la que realmente quiere.'
        }
    }
},
'me-30': {
    title: 'Ejercicio: El Contacto Psíquico (Ideomotor)',
    description: 'Simulas una rutina de "contacto mental". El sujeto responderá "sí" o "no" a preguntas en su mente, y tú lo detectarás por el movimiento ideomotor de su dedo.',
    target_choice: 'Detectar un "SÍ" oculto',
    npc: { name: 'Sujeto de Prueba Iota 2.0' },
    script_options: [
        {
            text: 'Pides al sujeto que apoye su dedo índice sobre tu mano. Le dices: "Voy a hacerte preguntas. Si la respuesta es SÍ, tu dedo presionará hacia abajo. Si es NO, se levantará".',
            technique_summary: 'Instrucción Consciente',
            is_correct: false,
            feedback: 'INCORRECTO. Estás pidiendo una respuesta consciente. El sujeto controlará el movimiento, y el efecto de "leer" un impulso inconsciente se pierde por completo.'
        },
        {
            text: 'Pides al sujeto que apoye su dedo índice sobre tu mano y se relaje. Le dices: "Concéntrate. No muevas el dedo conscientemente. Simplemente piensa SÍ... SÍ... SÍ... Deja que el pensamiento llene tu mente". Mientras, tú sientes una presión casi imperceptible hacia abajo.',
            technique_summary: 'Sensibilidad Ideomotora (Correcta)',
            is_correct: true,
            feedback: '¡CORRECTO! Esta es la esencia de la respuesta ideomotora. El pensamiento focalizado en una idea (SÍ) crea una microtensión muscular en la dirección asociada (hacia abajo, como un asentimiento). Al ser extremadamente sensible al tacto, puedes detectar este impulso inconsciente que el sujeto ni siquiera sabe que está produciendo.'
        },
        {
            text: 'Pides al sujeto que piense SÍ o NO, y tú intentas adivinarlo sin ningún tipo de instrucción o anclaje físico.',
            technique_summary: 'Adivinanza Pura',
            is_correct: false,
            feedback: 'INCORRECTO. Sin un canal para que la respuesta inconsciente se manifieste (como el dedo), no tienes nada que leer. El contacto físico es el puente que permite que el impulso ideomotor sea perceptible.'
        }
    ]
}
        
};
      
      const missions = {
    'm-1': {
        title: 'El Observador Silencioso',
        category: 'Lenguaje Corporal',
        difficulty: 'Fácil',
        description: 'En tu próxima conversación o reunión, tu único objetivo es no hablar. Concéntrate en observar el lenguaje corporal de los demás. ¿Quién se inclina hacia quién? ¿Quién tiene los pies apuntando a la salida? No analices, solo absorbe la información.'
    },
    'm-2': {
        title: 'El Eco Consciente',
        category: 'PNL',
        difficulty: 'Fácil',
        description: 'En una conversación casual, utiliza la técnica del parafraseo al menos una vez. Repite la idea de la otra persona con tus propias palabras para confirmar que la has entendido. Ejemplo: "Entonces, si no he entendido mal, lo que más te estresa es...". Observa su reacción.'
    },
    'm-3': {
        title: 'El Favor Anónimo',
        category: 'Ingeniería Social',
        difficulty: 'Fácil',
        description: 'Realiza un pequeño acto de reciprocidad sin esperar nada a cambio. Sujétale la puerta a alguien, cede el paso en el tráfico de forma obvia, o deja que alguien pase antes que tú en la cola del café. Observa si genera una sonrisa o un gesto de agradecimiento.'
    },
    'm-4': {
        title: 'El Ancla del Café',
        category: 'Hipnosis / PNL',
        difficulty: 'Intermedia',
        description: 'Si vas a tomar un café con alguien, cuando la conversación llegue a un punto álgido y positivo (risas, un acuerdo), coge tu taza y da un sorbo de forma deliberada. Intenta repetir esta acción en otro momento positivo. Estás creando un ancla kinestésica.'
    },
    'm-5': {
        title: 'El Sondeo de Calibración',
        category: 'Mentalismo',
        difficulty: 'Fácil',
        description: 'Hazle a un amigo o familiar dos preguntas cuya respuesta sepas que es "SÍ" y dos cuya respuesta sepas que es "NO". No te fijes en las palabras, fíjate en su cara y sus ojos. ¿Hay alguna diferencia sutil en cómo su cuerpo dice "sí" y cómo dice "no"?'
    },
    'm-6': {
        title: 'La Caza de Incongruencias',
        category: 'Lenguaje Corporal',
        difficulty: 'Intermedia',
        description: 'Hoy, tu misión es encontrar UNA incongruencia. Alguien que diga "sí" mientras niega sutilmente con la cabeza, o alguien que diga "estoy bien" con los hombros caídos y el ceño fruncido. Anótala.'
    },
    'm-7': {
        title: 'El Reencuadre de un Pensamiento',
        category: 'PNL',
        difficulty: 'Fácil',
        description: 'La próxima vez que tengas un pensamiento negativo (ej. "Qué pereza tengo que hacer esto"), detente y reencuadrálo. Cámbialo por "Voy a hacer esto para poder relajarme después" o "¿Cuál es la forma más divertida o rápida de terminar con esto?".'
    },
    'm-8': {
        title: 'El Poder del Nombre',
        category: 'Ingeniería Social',
        difficulty: 'Fácil',
        description: 'En una conversación con alguien que no conoces muy bien, utiliza su nombre una vez de forma natural. Ejemplo: "Esa es una idea muy interesante, Laura". Nota si su nivel de atención hacia ti cambia, aunque sea ligeramente.'
    },
    'm-9': {
        title: 'El Desafío del Contacto Visual',
        category: 'Lenguaje Corporal',
        difficulty: 'Fácil',
        description: 'Con la próxima persona que te atienda en una tienda o cafetería, haz un esfuerzo consciente por mantener un contacto visual amable y sonreír mientras le das las gracias. Observa si su respuesta es más cálida que la habitual.'
    },
    'm-10': {
        title: 'El Test del "Porque"',
        category: 'Ingeniería Social',
        difficulty: 'Intermedia',
        description: 'Haz una pequeña petición a alguien y añade una justificación con la palabra "porque". Ejemplo: "¿Podemos usar esta mesa? Es que tiene mejor luz para leer". Comprueba si la justificación facilita el "sí".'
    },
        'm-11': {
    title: 'El Baile del Espacio Personal',
    category: 'Lenguaje Corporal',
    difficulty: 'Fácil',
    description: 'En una conversación de pie, da un pequeño e imperceptible paso hacia atrás. Observa si la otra persona instintivamente avanza para cerrar el espacio. Esto te dará una pista sobre su nivel de comodidad y rapport contigo.'
},
'm-12': {
    title: 'La Mirada del Líder',
    category: 'Lenguaje Corporal',
    difficulty: 'Intermedia',
    description: 'En una reunión de grupo, cuando alguien termine de hablar, fíjate a quién mira primero. La persona a la que se dirige la mirada instintivamente suele ser la que se percibe como el líder o la figura de autoridad en ese momento.'
},
'm-13': {
    title: 'La Postura Expansiva',
    category: 'Lenguaje Corporal',
    difficulty: 'Fácil',
    description: 'Antes de una llamada o tarea que te genere un poco de estrés, busca un lugar privado y mantén una "postura de poder" (manos en las caderas, pecho abierto) durante 60 segundos. Nota si tu estado mental y tu confianza cambian, aunque sea ligeramente.'
},
'm-14': {
    title: 'El Reflejo Sutil',
    category: 'Lenguaje Corporal',
    difficulty: 'Intermedia',
    description: 'En una conversación tranquila, si la otra persona cruza una pierna, espera unos 5-10 segundos y cruza la tuya de forma similar. Si se toca la barbilla, espera y haz un gesto parecido. Observa si esto aumenta la fluidez y la conexión de la charla.'
},
'm-15': {
    title: 'La Brújula de los Pies',
    category: 'Lenguaje Corporal',
    difficulty: 'Fácil',
    description: 'Cuando hables con alguien en un entorno social, fíjate en la dirección de sus pies. Si sus pies te apuntan a ti, está comprometido con la conversación. Si apuntan hacia la salida o hacia otra persona, su mente ya quiere irse.'
},
'm-16': {
    title: 'Caza de Predicados (VAK)',
    category: 'PNL',
    difficulty: 'Intermedia',
    description: 'Hoy, tu misión es identificar el sistema representacional dominante de una persona. ¿Usa más palabras visuales ("veo tu punto"), auditivas ("me suena bien") o kinestésicas ("siento que es lo correcto")? Intenta responderle usando su mismo tipo de lenguaje.'
},
'm-17': {
    title: 'El Ancla Personal',
    category: 'PNL',
    difficulty: 'Fácil',
    description: 'Piensa en un momento en el que te sentiste increíblemente seguro y feliz. Mientras revives esa emoción intensamente, aprieta el pulgar y el índice de tu mano no dominante. Hazlo 2 o 3 veces hoy. Estás creando un "botón" para acceder a ese estado a voluntad.'
},
'm-18': {
    title: 'Romper un Patrón Negativo',
    category: 'PNL',
    difficulty: 'Fácil',
    description: 'La próxima vez que te sorprendas en un bucle de pensamientos negativos, interrúmpelo físicamente de forma brusca: levántate, aplaude una vez con fuerza, estírate o cambia de habitación. El objetivo es romper el "trance" negativo con una acción física.'
},
'm-19': {
    title: 'El Pre-encuadre Positivo',
    category: 'PNL',
    difficulty: 'Intermedia',
    description: 'Antes de empezar una tarea o reunión que no te apetece, dedica 30 segundos a visualizar el resultado final siendo un éxito total. Imagina la sensación de alivio y satisfacción. Pre-encuadrar tu mente para el éxito cambia tu enfoque.'
},
'm-20': {
    title: 'El "Sí" Implícito',
    category: 'PNL',
    difficulty: 'Intermedia',
    description: 'En lugar de preguntar "¿Quieres hacer X?", utiliza una pregunta que presuponga el "sí". En lugar de "¿Salimos a cenar?", prueba con "¿Prefieres comida italiana o mexicana para nuestra cena de esta noche?". Observa la reacción a esta ilusión de elección.'
},
'm-21': {
    title: 'El Efecto Benjamin Franklin',
    category: 'Ingeniería Social',
    difficulty: 'Fácil',
    description: 'Pídele a alguien un favor muy pequeño y fácil de conceder (ej. "¿me sujetas esto un segundo?", "¿me pasas la sal?"). Paradójicamente, la gente tiende a sentir más simpatía por aquellos a quienes han ayudado. Es una forma sutil de construir afinidad.'
},
'm-22': {
    title: 'Usa la Prueba Social',
    category: 'Ingeniería Social',
    difficulty: 'Fácil',
    description: 'Cuando recomiendes algo (una película, un libro, un restaurante), en lugar de decir "me gustó mucho", intenta usar la prueba social. Di algo como "Tiene unas críticas fantásticas, casi todo el mundo dice que es increíble".'
},
'm-23': {
    title: 'Validación Activa',
    category: 'Ingeniería Social',
    difficulty: 'Intermedia',
    description: 'Cuando alguien te cuente un problema, resiste el impulso de dar una solución. En su lugar, valida su emoción. Di: "Suena increíblemente frustrante" o "Entiendo perfectamente por qué te sientes así". Observa cómo esto fortalece la conexión.'
},
'm-24': {
    title: 'Elicitación por Declaración',
    category: 'Ingeniería Social',
    difficulty: 'Avanzada',
    description: 'En lugar de preguntar a alguien a qué se dedica, haz una declaración general para elicitar la información. Por ejemplo: "El mercado inmobiliario está muy complicado últimamente". Si se dedica a eso, será casi imposible que no responda con una opinión experta.'
},
'm-25': {
    title: 'La Siembra de Ideas',
    category: 'Ingeniería Social',
    difficulty: 'Avanzada',
    description: 'Si quieres que alguien piense en una idea (ej. "vacaciones"), no la menciones. En su lugar, introduce conceptos relacionados en la conversación: "Estoy agotado", "necesito desconectar", "el sol y la playa suenan bien ahora mismo". Observa si la persona saca el tema de las vacaciones por su cuenta.'
},
'm-26': {
    title: 'El Test de la Mirada',
    category: 'Mentalismo',
    difficulty: 'Fácil',
    description: 'Pide a un amigo que piense en una persona que le cae bien y luego en una que le cae mal. Mientras piensa en cada una, fíjate en sus ojos. ¿Hay alguna diferencia en la dilatación de sus pupilas o en la tensión de los músculos oculares?'
},
'm-27': {
    title: 'La Lectura del "No"',
    category: 'Mentalismo',
    difficulty: 'Intermedia',
    description: 'Pide a un amigo que responda "NO" a todas las preguntas que le hagas, incluso si la respuesta es sí. Hazle preguntas simples ("¿El cielo es azul?", "¿Te llamas [su nombre]?"). Observa si el "NO" a una verdad suena diferente o tiene un lenguaje corporal distinto (una micro-sonrisa, una duda) que el "NO" a una falsedad.'
},
'm-28': {
    title: 'El Forzaje Ambiental',
    category: 'Mentalismo',
    difficulty: 'Avanzada',
    description: 'Tu misión es hacer que alguien diga la palabra "agua". Para ello, antes de la conversación, asegúrate de que haya una botella de agua visible en la mesa. Durante la charla, bebe agua tú mismo. Luego, haz una pregunta abierta como "¿Qué te apetece tomar?". El primado visual y la acción de imitación aumentan la probabilidad.'
},
'm-29': {
    title: 'La Declaración Barnum',
    category: 'Mentalismo',
    difficulty: 'Intermedia',
    description: 'Usa una "declaración Barnum" (algo que parece específico pero es universal) con alguien. Por ejemplo: "Valoras mucho tu independencia, pero también hay una parte de ti que anhela una conexión segura y estable". Dilo con confianza y observa la reacción de validación.'
},
'm-30': {
    title: 'El Pulso de la Mente',
    category: 'Mentalismo',
    difficulty: 'Avanzada',
    description: 'Pide a un amigo que apriete su puño. Dile que vas a contar hasta tres y que en uno de los números apriete con más fuerza. Intenta sentir el cambio de presión en su muñeca o antebrazo. Es un ejercicio de sensibilidad kinestésica extrema.'
}
};
      
      
const integration_missions = {
    'im-1': {
        title: 'La Propuesta Arriesgada',
        description: 'Tu objetivo: Presentar una idea innovadora a tu jefe escéptico (Javier) y sobrevivir a las objeciones de tu colega rival (Laura). Debes usar habilidades de múltiples disciplinas para tener éxito.',
        characters: [
            { id: 'jefe', name: 'Javier', mood: 'Escéptico' },
            { id: 'rival', name: 'Laura', mood: 'Competitiva' }
        ],
        mission_state: { // Variables que cambiarán durante la misión
            rapportJefe: 50, // Nivel de Rapport con Javier (0-100)
            confianzaIdea: 20, // Nivel de Confianza de Javier en la idea (0-100)
            objecionesLaura: 0 // Contador de objeciones exitosas de Laura
        },
        phases: {
            'phase_1_inicio': {
                title: 'Fase 1: Romper el Hielo',
                goal: 'Establecer un rapport inicial con Javier antes de presentar tu idea.',
                start_node: 'p1_start',
                nodes: {
                    'p1_start': {
                        speaker: 'jefe',
                        line: 'Gracias por venir. Tienes 10 minutos. Laura también está aquí para dar una segunda opinión. ¿De qué se trata esto?',
                        options: [
                            { text: 'Ir directo al grano y presentar los datos.', skill: {module: 'Lógica', name: 'Directo al Punto'}, effects: {rapportJefe: '-10'}, target_node: 'p1_fail' },
                            { text: 'Reflejar sutilmente su postura y validar su falta de tiempo.', skill: {module: 'Lenguaje Corporal', name: 'Rapport (Espejo)'}, effects: {rapportJefe: '+15'}, target_node: 'p1_success' },
                            { text: 'Reencuadrar la reunión como una oportunidad, no una carga.', skill: {module: 'PNL', name: 'Reencuadre'}, effects: {rapportJefe: '+20'}, target_node: 'p1_success' }
                        ]
                    },
                    'p1_fail': {
                        speaker: 'jefe',
                        line: 'Vale, veo números, pero no siento la conexión. Continúa, pero rápido.',
                        is_end_phase: true,
                        next_phase: 'phase_2_presentacion'
                    },
                    'p1_success': {
                        speaker: 'jefe',
                        line: 'Aprecio que entiendas lo ocupado que estoy. Muy bien, tienes mi atención. Muéstrame lo que tienes.',
                        is_end_phase: true,
                        next_phase: 'phase_2_presentacion'
                    }
                }
            },
            'phase_2_presentacion': {
                title: 'Fase 2: La Presentación',
                goal: 'Presentar tu idea de la forma más persuasiva posible.',
                start_node: 'p2_start',
                nodes: {
                    'p2_start': {
                        speaker: 'jefe',
                        line: 'De acuerdo, ¿cuál es la idea central?',
                        options: [
                            { text: 'Explicar que otros líderes del sector ya usan este enfoque.', skill: {module: 'Ingeniería Social', name: 'Prueba Social'}, effects: {confianzaIdea: '+30'}, target_node: 'p2_laura_interviene' },
                            { text: 'Describir la idea con lenguaje vívido y enfocado en los beneficios que "sentirá".', skill: {module: 'PNL', name: 'Lenguaje Kinestésico'}, effects: {confianzaIdea: '+20', rapportJefe: '+10'}, target_node: 'p2_laura_interviene' },
                            { text: 'Detallar técnicamente por qué la idea es superior.', skill: {module: 'Lógica', name: 'Argumento Técnico'}, effects: {confianzaIdea: '+10'}, target_node: 'p2_laura_interviene' }
                        ]
                    },
                    'p2_laura_interviene': {
                        speaker: 'rival',
                        line: 'Si me permites, Javier, eso suena arriesgado. Podría desestabilizar nuestros procesos actuales y los costes iniciales parecen altos.',
                        is_end_phase: true,
                        next_phase: 'phase_3_objeciones'
                    }
                }
            },
            'phase_3_objeciones': {
                title: 'Fase 3: Manejo de Objeciones',
                goal: 'Neutralizar las objeciones de Laura sin alienar a Javier.',
                start_node: 'p3_start',
                nodes: {
                    'p3_start': {
                        speaker: 'rival',
                        line: 'Francamente, no veo cómo esto podría funcionar sin una inversión masiva de tiempo y recursos que no tenemos.',
                        options: [
                            { text: 'Atacar su argumento directamente: "Estás equivocada, los datos no dicen eso".', skill: {module: 'Confrontación', name: 'Ataque Directo'}, effects: {rapportJefe: '-20', confianzaIdea: '-10'}, target_node: 'p3_fail' },
                            { text: 'Validar y reencuadrar: "Laura tiene un punto excelente sobre la importancia de los recursos. Y es precisamente por eso que este sistema, una vez implementado, nos ahorrará cientos de horas al mes".', skill: {module: 'PNL', name: 'Validar y Reencuadrar'}, effects: {confianzaIdea: '+20'}, target_node: 'p3_success' },
                            { text: 'Usar una metáfora: "Es como plantar un árbol. Requiere un esfuerzo inicial, pero luego nos dará frutos durante años".', skill: {module: 'Hipnosis', name: 'Metáfora'}, effects: {rapportJefe: '+10', confianzaIdea: '+15'}, target_node: 'p3_success' }
                        ]
                    },
                    'p3_fail': {
                        speaker: 'jefe',
                        line: 'No me gusta este ambiente de confrontación. Lo siento, pero no estoy convencido. Necesito más tiempo para pensar. Gracias por tu tiempo.',
                        is_end_mission: true, // Final de la misión
                        feedback: 'MISIÓN FALLIDA: La confrontación directa creó un conflicto que hizo que tu jefe se cerrara. Aunque tu idea fuera buena, la gestión de la dinámica social fue deficiente.'
                    },
                    'p3_success': {
                        speaker: 'jefe',
                        line: 'Hmm, esa es una buena forma de verlo. Has pensado en las objeciones. Me gusta tu enfoque. De acuerdo, vamos a programar una reunión de seguimiento para ver un plan piloto.',
                        is_end_mission: true, // Final de la misión
                        feedback: '¡MISIÓN CUMPLIDA! Navegaste la situación con maestría. Construiste rapport, presentaste tu idea persuasivamente y manejaste las objeciones de forma elegante, validando a tu rival en lugar de atacarla. ¡Un verdadero estratega!'
                    }
                }
            }
        }
    },
  'im-2': {
    title: 'La Negociación del Contrato',
    description: 'Estás a punto de cerrar un contrato importante, pero el cliente (Sr. Méndez) tiene dudas de último minuto sobre el precio y los plazos. Debes salvar el acuerdo.',
    characters: [ { id: 'cliente', name: 'Sr. Méndez', mood: 'Dudoso' } ],
    mission_state: { rapport: 40, confianza: 30, estres: 60 },
    phases: {
        'phase_1_inicio': {
            title: 'Fase 1: Manejar la Duda Inicial',
            goal: 'Reducir el estrés del cliente y aumentar el rapport antes de abordar el problema.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'cliente',
                    line: 'He estado revisando la propuesta de nuevo y... sinceramente, el precio es más alto de lo que esperaba y los plazos son muy ajustados. No estoy seguro de que podamos seguir adelante así.',
                    options: [
                        { text: 'Justificar el precio inmediatamente con lógica.', skill: {module: 'Lógica', name: 'Defensa Racional'}, effects: {estres: '+10'}, target_node: 'p1_fail' },
                        { text: 'Validar su preocupación: "Entiendo perfectamente su duda, es una inversión importante y es normal querer estar 100% seguro".', skill: {module: 'PNL', name: 'Validación'}, effects: {rapport: '+20', estres: '-20'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { speaker: 'cliente', line: 'Sí, entiendo la lógica, pero sigo sintiendo que es demasiado arriesgado. La sensación no es la correcta.', is_end_phase: true, next_phase: 'phase_2_solucion' },
                'p1_success': { speaker: 'cliente', line: 'Exacto. Gracias por entenderlo. Entonces, ¿qué podemos hacer al respecto?', is_end_phase: true, next_phase: 'phase_2_solucion' }
            }
        },
        'phase_2_solucion': {
            title: 'Fase 2: Presentar la Solución',
            goal: 'Encontrar un punto medio que aumente la confianza del cliente en el acuerdo.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'cliente',
                    line: 'Necesito una solución que me dé más seguridad.',
                    options: [
                        { text: 'Ofrecer un descuento directo, devaluando tu oferta.', skill: {module: 'Concesión', name: 'Ceder'}, effects: {confianza: '+10', rapport: '-5'}, target_node: 'p2_final' },
                        { text: 'Reencuadrar el precio como una inversión en tranquilidad y ofrecer un pequeño extra (reciprocidad).', skill: {module: 'Ingeniería Social', name: 'Reencuadre y Reciprocidad'}, effects: {confianza: '+30', rapport: '+10'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'cliente',
                    line: 'De acuerdo, creo que podemos trabajar con eso. Ha sido una conversación productiva.',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { rapport: 50, confianza: 50 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Has salvado el acuerdo. Manejaste la emoción antes que la lógica, construiste confianza y encontraste una solución de valor. ¡Excelente!',
                        failure_feedback: 'MISIÓN FALLIDA: Aunque cerraste el trato, el rapport quedó dañado o la confianza es baja. La relación con el cliente podría ser frágil en el futuro.'
                    }
                }
            }
        }
    }
},
'im-3': {
    title: 'El Feedback Difícil',
    description: 'Tienes que darle feedback a un miembro de tu equipo (Marcos) que es muy talentoso pero tiene una actitud defensiva.',
    characters: [ { id: 'empleado', name: 'Marcos', mood: 'A la defensiva' } ],
    mission_state: { rapport: 30, defensividad: 70 },
    phases: {
        'phase_1_inicio': {
            title: 'Fase 1: El Acercamiento',
            goal: 'Crear un ambiente seguro para reducir la defensividad de Marcos.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'empleado',
                    line: 'Me dijiste que querías verme. ¿Pasa algo malo?',
                    options: [
                        { text: 'Ir directo al problema: "Sí, tenemos que hablar de tu actitud...".', skill: {module: 'Confrontación', name: 'Directo'}, effects: {defensividad: '+20'}, target_node: 'p1_fail' },
                        { text: 'Empezar con un elogio sincero: "Marcos, antes que nada, quiero decirte que el trabajo que hiciste en el proyecto X fue excepcional".', skill: {module: 'Ingeniería Social', name: 'Elogio'}, effects: {rapport: '+20', defensividad: '-20'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { speaker: 'empleado', line: 'Sabía que era por eso. Siempre hay algún problema. Pues dime.', is_end_phase: true, next_phase: 'phase_2_feedback' },
                'p1_success': { speaker: 'empleado', line: 'Ah, gracias. Aprecio que lo reconozcas. Entonces, ¿de qué querías hablar?', is_end_phase: true, next_phase: 'phase_2_feedback' }
            }
        },
        'phase_2_feedback': {
            title: 'Fase 2: Entregar el Mensaje',
            goal: 'Comunicar el feedback de forma clara pero sin activar de nuevo la defensividad.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'empleado',
                    line: 'Te escucho.',
                    options: [
                        { text: 'Enfocarse en el comportamiento, no en la persona: "Noté que durante la reunión, cuando se presentó la idea X, tu reacción pareció un poco brusca. ¿Qué ocurrió?".', skill: {module: 'PNL', name: 'Separar Identidad de Comportamiento'}, effects: {defensividad: '-30'}, target_node: 'p2_final' },
                        { text: 'Generalizar: "A veces puedes ser un poco negativo y eso afecta al equipo".', skill: {module: 'Crítica', name: 'Generalización'}, effects: {defensividad: '+30', rapport: '-10'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'empleado',
                    line: 'Ya veo... supongo que no me di cuenta. Gracias por decírmelo de esta manera.',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { defensividad: 40 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Has dado un feedback difícil de forma magistral. Al reducir la defensividad y enfocarte en el comportamiento, te aseguraste de que el mensaje fuera recibido.',
                        failure_feedback: 'MISIÓN FALLIDA: El mensaje se entregó, pero la defensividad de Marcos siguió siendo alta. Es posible que no haya interiorizado el feedback y que la relación laboral se haya resentido.'
                    }
                }
            }
        }
    }
},
'im-4': {
    title: 'La Venta Consultiva',
    description: 'Un cliente potencial (Ana) sabe que tiene un problema, pero no está seguro de cuál es la mejor solución. Tu objetivo no es "vender", sino "asesorar".',
    characters: [ { id: 'cliente', name: 'Ana', mood: 'Confundida' } ],
    mission_state: {
        rapportAna: 50,
        confianzaSolucion: 10
    },
    phases: {
        'phase_1_diagnostico': {
            title: 'Fase 1: Diagnóstico',
            goal: 'Entender el verdadero problema de Ana usando preguntas efectivas.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'cliente',
                    line: 'Sé que necesitamos mejorar nuestra eficiencia, pero hay tantas opciones que no sé por dónde empezar. Estoy un poco abrumada.',
                    options: [
                        { text: 'Presentar tu producto inmediatamente como la solución a todo.', skill: {module: 'Venta', name: 'Cierre Prematuro'}, effects: {rapportAna: '-20'}, target_node: 'p1_fail' },
                        { text: 'Usar el Meta-Modelo para clarificar: "Entiendo. ¿Qué significa ‘eficiencia’ exactamente para tu equipo? ¿En qué área específica sienten más el problema?".', skill: {module: 'PNL', name: 'Meta-Modelo'}, effects: {rapportAna: '+20'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': {
                    speaker: 'cliente',
                    line: 'Sí, tu producto parece bueno, pero no estoy segura de que ataque nuestro problema de raíz. Necesito pensarlo.',
                    is_end_mission: true,
                    feedback: 'MISIÓN FALLIDA: Intentaste vender antes de diagnosticar. El cliente no se sintió comprendido y, por lo tanto, no confió en tu solución.'
                },
                'p1_success': {
                    speaker: 'cliente',
                    line: 'Buena pregunta. Creo que el mayor problema es el tiempo que perdemos en los informes manuales cada viernes.',
                    is_end_phase: true,
                    next_phase: 'phase_2_propuesta'
                }
            }
        },
        'phase_2_propuesta': {
            title: 'Fase 2: Propuesta de Valor',
            goal: 'Conectar tu solución directamente con el problema específico que has descubierto.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'cliente',
                    line: 'Sí, los informes son nuestra pesadilla.',
                    options: [
                        { text: 'Conectar y liderar: "Perfecto. Imagina por un momento cómo sería llegar el viernes y que esos informes ya estuvieran hechos, dándote toda la tarde para planificar la siguiente semana. Nuestro módulo de automatización está diseñado precisamente para eso".', skill: {module: 'Hipnosis', name: 'Puente al Futuro'}, effects: {confianzaSolucion: '+50'}, target_node: 'p2_final' },
                        { text: 'Listar características: "Nuestro software tiene exportación a PDF, 20 plantillas diferentes y se integra con tres plataformas".', skill: {module: 'Lógica', name: 'Características'}, effects: {confianzaSolucion: '+10'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'cliente',
                    line: 'Eso... eso suena exactamente como lo que necesito. De acuerdo, hablemos de los siguientes pasos.',
                    is_end_mission: true,
                    feedback: '¡MISIÓN CUMPLIDA! No vendiste un producto, vendiste un resultado. Al diagnosticar primero y luego pintar una imagen vívida de la solución a su problema específico, generaste una confianza inquebrantable.'
                }
            }
        }
    }
},
'im-5': {
    title: 'Calmar al Amigo Ansioso',
    description: 'Tu amigo (Carlos) está muy ansioso por una entrevista de trabajo que tiene mañana. Tu objetivo es ayudarlo a cambiar su estado emocional a uno de más calma y confianza.',
    characters: [ { id: 'amigo', name: 'Carlos', mood: 'Ansioso' } ],
    mission_state: {
        rapportCarlos: 60,
        ansiedad: 80
    },
    phases: {
        'phase_1_anclaje': {
            title: 'Fase 1: Cambiar el Estado',
            goal: 'Romper su bucle de pensamientos negativos y anclar un estado de recursos.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'amigo',
                    line: 'No voy a poder hacerlo. Hay demasiada gente mejor que yo. Seguro que me quedo en blanco.',
                    options: [
                        { text: 'Decirle que no se preocupe, que todo saldrá bien.', skill: {module: 'Consuelo', name: 'Minimizar'}, effects: {ansiedad: '-5'}, target_node: 'p1_fail' },
                        { text: 'Cambiar su enfoque y anclar: "Un momento. Olvida eso. Cuéntame de nuevo aquella vez que diste esa presentación increíble en la universidad. ¿Cómo te sentiste justo después? Conecta con esa sensación".', skill: {module: 'PNL', name: 'Anclaje de Recursos'}, effects: {ansiedad: '-30'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': {
                    speaker: 'amigo',
                    line: 'Es fácil para ti decirlo, pero no ayuda. Sigo sintiéndome igual.',
                    is_end_mission: true,
                    feedback: 'MISIÓN FALLIDA: Intentar calmar a alguien con lógica rara vez funciona. Invalidaste su sentimiento en lugar de ayudarlo a cambiarlo desde dentro.'
                },
                'p1_success': {
                    speaker: 'amigo',
                    line: 'Pues... me sentí genial, la verdad. Con mucha confianza. Hacía tiempo que no pensaba en eso.',
                    is_end_phase: true,
                    next_phase: 'phase_2_proyeccion'
                }
            }
        },
        'phase_2_proyeccion': {
            title: 'Fase 2: Proyección al Futuro',
            goal: 'Ayudarle a llevar ese estado de confianza a la entrevista de mañana.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'amigo',
                    line: 'Me siento un poco mejor recordando eso.',
                    options: [
                        { text: 'Proyectar el estado: "Perfecto. Ahora, quiero que lleves esa misma sensación de confianza contigo a la entrevista de mañana. Imagina entrar en esa sala sintiéndote exactamente así".', skill: {module: 'Hipnosis', name: 'Puente al Futuro'}, effects: {ansiedad: '-40'}, target_node: 'p2_final' },
                        { text: 'Darle consejos lógicos: "Bueno, ahora repasa tu currículum y duerme bien".', skill: {module: 'Lógica', name: 'Consejo Racional'}, effects: {ansiedad: '-10'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'amigo',
                    line: 'Tienes razón. Si pude hacerlo entonces, puedo hacerlo mañana. Gracias, de verdad. Me siento mucho más preparado.',
                    is_end_mission: true,
                    feedback: '¡MISIÓN CUMPLIDA! No le diste consejos, le diste un cambio de estado. Le ayudaste a acceder a sus propios recursos internos y a proyectarlos en el futuro, una de las aplicaciones más poderosas de la PNL.'
                }
            }
        }
    }
},
'im-6': {
    title: 'La Reunión de Equipo Dividido',
    description: 'Tu equipo está dividido sobre dos estrategias diferentes para un proyecto. La mitad apoya la Opción A (segura) y la otra mitad la Opción B (innovadora). Tu objetivo es unificar al equipo.',
    characters: [ { id: 'equipo', name: 'Equipo', mood: 'Dividido' } ],
    mission_state: {
        unidadEquipo: 20,
        confianzaDecision: 30
    },
    phases: {
        'phase_1_reencuadre': {
            title: 'Fase 1: Encontrar un Terreno Común',
            goal: 'Reencuadrar el problema para que dejen de verse como oponentes.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'equipo',
                    line: '(Murmullos y discusión). El bando A dice que el B es muy arriesgado. El bando B dice que el A es mediocre.',
                    options: [
                        { text: 'Pedir que voten para tomar una decisión rápida.', skill: {module: 'Gestión', name: 'Votación'}, effects: {unidadEquipo: '-20'}, target_node: 'p1_fail' },
                        { text: 'Reencuadrar el objetivo: "Un momento. ¿Estamos todos de acuerdo en que nuestro objetivo común es el éxito de este proyecto, y que ambos bandos quieren lo mejor para la empresa?".', skill: {module: 'PNL', name: 'Reencuadre de Intención'}, effects: {unidadEquipo: '+30'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': {
                    speaker: 'equipo',
                    line: 'La votación es 5 a 5. Ahora estamos igual, pero la mitad del equipo se siente ignorada y resentida. La tensión es máxima.',
                    is_end_mission: true,
                    feedback: 'MISIÓN FALLIDA: Una votación en un equipo dividido crea ganadores y perdedores, destruyendo la unidad. Tu rol era mediar, no forzar una decisión.'
                },
                'p1_success': {
                    speaker: 'equipo',
                    line: '(El equipo asiente). Sí, claro. Todos queremos que esto salga bien.',
                    is_end_phase: true,
                    next_phase: 'phase_2_sintesis'
                }
            }
        },
        'phase_2_sintesis': {
            title: 'Fase 2: Crear una Tercera Opción',
            goal: 'Guiar al equipo para que creen una solución que integre lo mejor de ambas propuestas.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'equipo',
                    line: 'Ahora que estamos de acuerdo en el objetivo, ¿cómo procedemos?',
                    options: [
                        { text: 'Proponer una síntesis: "¿Y si tomamos la seguridad de la Opción A como base, pero le integramos el elemento más innovador y de bajo riesgo de la Opción B como un proyecto piloto?".', skill: {module: 'Ingeniería Social', name: 'Creación de Consenso'}, effects: {unidadEquipo: '+40', confianzaDecision: '+50'}, target_node: 'p2_final' },
                        { text: 'Imponer tu propia decisión como líder.', skill: {module: 'Autoridad', name: 'Imposición'}, effects: {unidadEquipo: '-10'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'equipo',
                    line: 'Esa es una idea excelente. Nos permite avanzar de forma segura pero sin estancarnos. ¡Vamos a desarrollarla!',
                    is_end_mission: true,
                    feedback: '¡MISIÓN CUMPLIDA! Actuaste como un verdadero líder. No elegiste un bando, sino que elevaste la perspectiva del equipo hacia un objetivo común y les ayudaste a sintetizar una tercera opción superior. Has creado unidad y una solución robusta.'
                }
            }
        }
    }
},
'im-7': {
    title: 'La Cita de Café (Interés Oculto)',
    description: 'Estás en una cita de café. La conversación es agradable, pero no estás seguro de si hay interés real o solo cortesía. Tu objetivo es descubrir la verdadera intención.',
    characters: [ { id: 'cita', name: 'Alex', mood: 'Amable' } ],
    mission_state: {
        rapport: 60,
        interesReal: 50
    },
    phases: {
        'phase_1_calibracion': {
            title: 'Fase 1: Calibración',
            goal: 'Establecer una línea base y observar el lenguaje corporal.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'cita',
                    line: 'Sí, mi trabajo es interesante. Siempre estoy ocupado/a, pero me gusta.',
                    options: [
                        { text: 'Seguir haciendo preguntas lógicas sobre su trabajo.', skill: {module: 'Conversación', name: 'Lógica'}, effects: {}, target_node: 'p1_neutral' },
                        { text: 'Observar: notar que aunque sonríe, sus pies apuntan a la puerta y mantiene su taza como una barrera.', skill: {module: 'Lenguaje Corporal', name: 'Observación'}, effects: {}, target_node: 'p1_lectura' }
                    ]
                },
                'p1_neutral': {
                    speaker: 'cita',
                    line: 'Sí, es un puesto de gestión. Bueno, se me hace tarde...',
                    is_end_mission: true,
                    feedback: 'MISIÓN INCONCLUSA: La conversación fue cortés, pero no obtuviste ninguna información real porque te quedaste en la superficie. La cita terminó sin claridad.'
                },
                'p1_lectura': {
                    speaker: 'cita',
                    line: '(Continúa hablando amablemente, pero su lenguaje corporal no cambia).',
                    is_end_phase: true,
                    next_phase: 'phase_2_test'
                }
            }
        },
        'phase_2_test': {
            title: 'Fase 2: El Test de Interés',
            goal: 'Realizar una acción para probar si su interés es real.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'cita',
                    line: 'Así que sí, ha sido una semana de locos.',
                    options: [
                        { text: 'Hacer una declaración de interés directo: "Me gustaría volver a verte".', skill: {module: 'Comunicación', name: 'Directa'}, effects: {}, target_node: 'p2_resultado_directo' },
                        { text: 'Hacer una "proyección futura" sutil: "La próxima vez que hablemos, tienes que contarme cómo terminó ese proyecto".', skill: {module: 'Hipnosis', name: 'Proyección Futura'}, effects: {}, target_node: 'p2_resultado_sutil' }
                    ]
                },
                'p2_resultado_directo': {
                    speaker: 'cita',
                    line: 'Oh... gracias. Eres muy amable. Bueno, ya veremos, con tanto trabajo... ¡cuídate!',
                    is_end_mission: true,
                    feedback: 'RESULTADO: RECHAZO CORTÉS. Tu pregunta directa, ante su lenguaje corporal cerrado, forzó una respuesta socialmente educada pero negativa. No había suficiente rapport para ese nivel de franqueza.'
                },
                'p2_resultado_sutil': {
                    speaker: 'cita',
                    line: '¡Claro! Sí, te cuento. Oye, ha sido un placer. Hablamos pronto.',
                    is_end_mission: true,
                    feedback: '¡ÉXITO! Tu proyección futura fue el test perfecto. No la forzaste a un sí/no. Su respuesta positiva ("¡Claro! Hablamos pronto") es una señal de que está abierta a una futura interacción. Has obtenido la información que buscabas sin crear una situación incómoda.'
                }
            }
        }
    }
},
'im-8': {
    title: 'El Favor al Vecino',
    description: 'Tu vecino (Sr. García) es un poco gruñón y rara vez saluda. Quieres mejorar la relación. Una mañana, lo ves luchando por subir unas bolsas pesadas por las escaleras.',
    characters: [ { id: 'vecino', name: 'Sr. García', mood: 'Gruñón' } ],
    mission_state: {
        rapportVecino: 10
    },
    phases: {
        'phase_1_oferta': {
            title: 'Fase 1: La Oferta',
            goal: 'Ofrecer ayuda de una manera que sea aceptada.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'vecino',
                    line: '(Luchando con las bolsas, resoplando, sin mirarte).',
                    options: [
                        { text: 'Preguntar: "¿Necesita ayuda?".', skill: {module: 'Comunicación', name: 'Pregunta Directa'}, effects: {}, target_node: 'p1_fail' },
                        { text: 'Actuar y justificar: Coger una bolsa y decir "Permítame, esas bolsas pesan una tonelada. Yo le llevo esta".', skill: {module: 'Ingeniería Social', name: 'Acción y Justificación'}, effects: {rapportVecino: '+30'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': {
                    speaker: 'vecino',
                    line: '"No, no. Yo puedo solo." (Sigue luchando, ignorándote).',
                    is_end_mission: true,
                    feedback: 'MISIÓN FALLIDA: La pregunta "¿Necesita ayuda?" a menudo activa el orgullo y la respuesta automática es "no". Era una oferta fácil de rechazar.'
                },
                'p1_success': {
                    speaker: 'vecino',
                    line: '(Sorprendido). "Eh... bueno... gracias, muchacho/a. Muy amable de tu parte."',
                    is_end_phase: true,
                    next_phase: 'phase_2_cierre'
                }
            }
        },
        'phase_2_cierre': {
            title: 'Fase 2: El Cierre',
            goal: 'Dejar una impresión positiva y duradera.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'vecino',
                    line: '(Ya en su puerta). "Bueno, muchas gracias de nuevo."',
                    options: [
                        { text: '"De nada. Por cierto, necesitaré que me riegue las plantas la semana que viene".', skill: {module: 'Reciprocidad', name: 'Cobro Inmediato'}, effects: {rapportVecino: '-40'}, target_node: 'p2_final_fail' },
                        { text: '"De nada, Sr. García. ¡Que tenga un buen día!". (Y te vas sin pedir nada).', skill: {module: 'Reciprocidad', name: 'Incondicional'}, effects: {rapportVecino: '+30'}, target_node: 'p2_final_success' }
                    ]
                },
                'p2_final_fail': {
                    speaker: 'vecino',
                    line: '(Te mira con recelo). "Ah. Ya veo. Bueno, lo pensaré."',
                    is_end_mission: true,
                    feedback: 'MISIÓN FALLIDA: Destruiste todo el rapport al convertir un acto de amabilidad en una transacción. La reciprocidad funciona cuando es incondicional.'
                },
                'p2_final_success': {
                    speaker: 'vecino',
                    line: '(Asiente, gratamente sorprendido). "Igualmente."',
                    is_end_mission: true,
                    feedback: '¡MISIÓN CUMPLIDA! Has aplicado la reciprocidad de forma magistral. Al dar valor sin pedir nada a cambio, has creado una "deuda" social positiva. La próxima vez que el Sr. García te vea, te sonreirá. Has plantado la semilla de una buena relación.'
                }
            }
        }
    }
},
'im-9': {
    title: 'La Presentación al Inversor',
    description: 'Estás presentando tu proyecto a un inversor (Isabel) que es muy analítica y tiene poco tiempo. Tu objetivo es captar su interés y asegurar una segunda reunión.',
    characters: [ { id: 'inversor', name: 'Isabel', mood: 'Analítica y Apresurada' } ],
    mission_state: {
        interesInversor: 30,
        credibilidad: 40
    },
    phases: {
        'phase_1_apertura': {
            title: 'Fase 1: La Apertura (Primeros 30 segundos)',
            goal: 'Captar su atención y establecer credibilidad rápidamente.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'inversor',
                    line: 'Buenos días. Tengo 20 minutos exactos. Empiece cuando quiera.',
                    options: [
                        { text: 'Empezar con tu historia personal y tu pasión por el proyecto.', skill: {module: 'Storytelling', name: 'Historia Personal'}, effects: {interesInversor: '-10'}, target_node: 'p1_fail' },
                        { text: 'Empezar con el problema que resuelves y el tamaño del mercado: "El problema es X, que afecta a Y millones de personas y cuesta Z millones al año. Nosotros lo solucionamos".', skill: {module: 'Comunicación', name: 'Enfoque en el Problema'}, effects: {interesInversor: '+30', credibilidad: '+20'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': {
                    speaker: 'inversor',
                    line: 'Aprecio su pasión, pero necesito datos. Vayamos al grano, por favor.',
                    is_end_mission: true,
                    feedback: 'MISIÓN FALLIDA: No te adaptaste a tu audiencia. Una persona analítica y con prisa responde a datos y soluciones, no a historias personales en la apertura.'
                },
                'p1_success': {
                    speaker: 'inversor',
                    line: 'Interesante. Tiene mi atención. ¿Cuál es su solución?',
                    is_end_phase: true,
                    next_phase: 'phase_2_cierre'
                }
            }
        },
        'phase_2_cierre': {
            title: 'Fase 2: El Cierre',
            goal: 'Terminar la reunión asegurando el siguiente paso.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'inversor',
                    line: 'El tiempo se acaba. Esto parece prometedor. Envíeme la presentación.',
                    options: [
                        { text: 'Aceptar y preguntar cuándo tendrás noticias: "Perfecto, se la envío. ¿Cuándo podría esperar una respuesta?".', skill: {module: 'Seguimiento', name: 'Pasivo'}, effects: {}, target_node: 'p2_final_pasivo' },
                        { text: 'Aceptar y proponer el siguiente paso: "Se la enviaré en una hora. ¿Le parece bien si agendamos 20 minutos para el próximo martes para resolver cualquier duda específica que le surja tras leerla?".', skill: {module: 'Ingeniería Social', name: 'Cierre con Acción'}, effects: {credibilidad: '+20'}, target_node: 'p2_final_activo' }
                    ]
                },
                'p2_final_pasivo': {
                    speaker: 'inversor',
                    line: 'No estoy segura, tengo una agenda complicada. Yo le aviso.',
                    is_end_mission: true,
                    feedback: 'RESULTADO: INCIERTO. Has perdido el control de la situación. Al dejar el siguiente paso en sus manos, es muy probable que tu propuesta se enfríe.'
                },
                'p2_final_activo': {
                    speaker: 'inversor',
                    line: 'Martes a las 10. De acuerdo. Envíeme la presentación. Espero su llamada.',
                    is_end_mission: true,
                    feedback: '¡MISIÓN CUMPLIDA! Has mantenido el control del proceso. Al proponer una acción concreta y fácil de aceptar, has asegurado el siguiente punto de contacto y has demostrado ser una persona proactiva y profesional.'
                }
            }
        }
    }
},
'im-10': {
    title: 'Detectar la Verdadera Objeción',
    description: 'Estás vendiendo un servicio de alto valor. El cliente (David) parece convencido pero al final dice "Tengo que pensarlo". Tu objetivo es descubrir la verdadera objeción oculta.',
    characters: [ { id: 'cliente', name: 'David', mood: 'Evasivo' } ],
    mission_state: {
        rapport: 70,
        objecionReal: 0 // 0 = no descubierta, 1 = descubierta
    },
    phases: {
        'phase_1_investigacion': {
            title: 'Fase 1: Investigación',
            goal: 'Ir más allá de la respuesta superficial.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'cliente',
                    line: 'Todo suena muy bien, de verdad. Pero es una decisión importante, necesito pensarlo con calma.',
                    options: [
                        { text: 'Presionar para que decida ahora.', skill: {module: 'Venta', name: 'Presión'}, effects: {rapport: '-30'}, target_node: 'p1_fail' },
                        { text: 'Aceptar y validar, luego usar una pregunta de sondeo: "Por supuesto, David. Normalmente cuando alguien dice que necesita pensarlo, es porque o bien el precio no encaja, o bien no está seguro de que esto sea para él. ¿Cuál de las dos resuena más contigo?".', skill: {module: 'Mentalismo', name: 'Horquillado'}, effects: {rapport: '+10'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': {
                    speaker: 'cliente',
                    line: 'No, no, no me presiones. Si decido algo, ya te llamaré.',
                    is_end_mission: true,
                    feedback: 'MISIÓN FALLIDA: La presión rompió el rapport. El cliente se sintió acorralado y levantó un muro definitivo.'
                },
                'p1_success': {
                    speaker: 'cliente',
                    line: '(Sorprendido por tu franqueza). Bueno... siendo honesto, tengo que hablarlo con mi socio. Él es el que aprueba el presupuesto final.',
                    is_end_mission: true,
                    feedback: '¡MISIÓN CUMPLIDA! Has descubierto la objeción real. No era "pensarlo", era "necesito la aprobación de otro". La técnica del horquillado (dar dos opciones probables) le dio la seguridad para revelar la verdadera barrera. Ahora puedes trabajar en la solución real: darle las herramientas para convencer a su socio.'
                }
            }
        }
    }
},
  'im-11': {
    title: 'Pedir un Aumento',
    description: 'Has trabajado duro y tus resultados son excelentes. Es hora de pedir un aumento a tu jefa (Sara), quien es justa pero muy orientada a los datos.',
    characters: [ { id: 'jefa', name: 'Sara', mood: 'Ocupada y Analítica' } ],
    mission_state: { rapport: 40, confianza: 50, justificacion: 10 },
    phases: {
        'phase_1_apertura': {
            title: 'Fase 1: El Acercamiento',
            goal: 'Presentar el tema de forma profesional sin generar una reacción defensiva.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'jefa',
                    line: 'Hola, ¿qué tal? Tengo unos minutos. ¿En qué puedo ayudarte?',
                    options: [
                        { text: 'Ir directo al grano: "Hola Sara, creo que merezco un aumento y me gustaría discutirlo".', skill: {module: 'Comunicación', name: 'Directa'}, effects: {rapport: '-10', justificacion: '+5'}, target_node: 'p1_directo' },
                        { text: 'Enmarcar la conversación: "Gracias por tu tiempo. Me gustaría hablar sobre mi trayectoria en la empresa y mi futuro rol aquí".', skill: {module: 'PNL', name: 'Reencuadre'}, effects: {rapport: '+10'}, target_node: 'p1_enmarcado' }
                    ]
                },
                'p1_directo': { speaker: 'jefa', line: 'Un aumento. De acuerdo. ¿En qué te basas?', is_end_phase: true, next_phase: 'phase_2_argumento' },
                'p1_enmarcado': { speaker: 'jefa', line: 'Interesante. Me parece una conversación importante. Te escucho.', is_end_phase: true, next_phase: 'phase_2_argumento' }
            }
        },
        'phase_2_argumento': {
            title: 'Fase 2: La Justificación',
            goal: 'Presentar tus logros de una manera que resuene con su estilo analítico.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'jefa',
                    line: 'Entonces, ¿cuáles son tus argumentos?',
                    options: [
                        { text: 'Hablar de tu esfuerzo: "He trabajado muy duro este año y siento que he aportado mucho".', skill: {module: 'Argumento', name: 'Subjetivo'}, effects: {justificacion: '+10'}, target_node: 'p2_final' },
                        { text: 'Presentar datos concretos: "Durante los últimos 12 meses, lideré el proyecto X que resultó en un aumento del 15% en la eficiencia y generé Y en nuevos ingresos. Me gustaría que mi compensación reflejara este valor".', skill: {module: 'Ingeniería Social', name: 'Prueba y Valor'}, effects: {justificacion: '+50', confianza: '+20'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'jefa',
                    line: 'Entiendo. Gracias por presentar esto de forma tan clara. Déjame revisar los números y te daré una respuesta esta semana.',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { justificacion: 60, rapport: 40 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Has presentado un caso sólido y profesional. Al usar datos concretos y mantener un marco de valor, has maximizado tus posibilidades de éxito.',
                        failure_feedback: 'MISIÓN INCIERTA: Aunque has abierto la conversación, tu argumento se basó más en sentimientos que en datos. La falta de justificación concreta podría debilitar tu posición.'
                    }
                }
            }
        }
    }
},
  'im-12': {
    title: 'La Disculpa Necesaria',
    description: 'Cometiste un error que afectó a un cliente y tu colega (Elena) tuvo que solucionarlo. Debes disculparte y restaurar la confianza con ella.',
    characters: [ { id: 'colega', name: 'Elena', mood: 'Decepcionada' } ],
    mission_state: { rapport: 20, confianza: 10 },
    phases: {
        'phase_1_disculpa': {
            title: 'Fase 1: La Disculpa',
            goal: 'Ofrecer una disculpa genuina que sea aceptada.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'colega',
                    line: 'Ah, hola. Sí, la situación con el cliente ya está controlada. Fue una tarde complicada.',
                    options: [
                        { text: 'Justificarte: "Lo siento, pero es que estaba sobrecargado con otras tareas".', skill: {module: 'Comunicación', name: 'Justificación'}, effects: {rapport: '-10', confianza: '-10'}, target_node: 'p1_fail' },
                        { text: 'Asumir responsabilidad total: "Elena, no hay excusas. Cometí un error, te afectó a ti y lo siento de verdad. Vengo a disculparme y a asegurarme de que no vuelva a pasar".', skill: {module: 'Inteligencia Emocional', name: 'Responsabilidad'}, effects: {rapport: '+30'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { speaker: 'colega', line: 'Todos estamos sobrecargados. No se trata de eso.', is_end_phase: true, next_phase: 'phase_2_reparacion' },
                'p1_success': { speaker: 'colega', line: '... Vale. Aprecio que lo digas así. Gracias.', is_end_phase: true, next_phase: 'phase_2_reparacion' }
            }
        },
        'phase_2_reparacion': {
            title: 'Fase 2: La Reparación',
            goal: 'Tomar acciones para reconstruir la confianza.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'colega',
                    line: 'Espero que no se repita.',
                    options: [
                        { text: 'Hacer una promesa: "No volverá a pasar, te lo prometo".', skill: {module: 'Comunicación', name: 'Promesa'}, effects: {confianza: '+10'}, target_node: 'p2_final' },
                        { text: 'Proponer un plan de acción: "Para asegurarme de que no se repita, he implementado un nuevo sistema de doble chequeo para estas tareas. ¿Te parece bien si te lo muestro?".', skill: {module: 'Ingeniería Social', name: 'Acción y Compromiso'}, effects: {confianza: '+40'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'colega',
                    line: 'Un sistema de doble chequeo... De acuerdo, eso suena como un buen plan. Muéstramelo. Y gracias de nuevo por hablar conmigo.',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { rapport: 50, confianza: 40 },
                        success_feedback: '¡MISIÓN CUMPLIDA! No solo te disculpaste, sino que tomaste medidas concretas para reparar el daño y asegurar el futuro. Has convertido un error en una oportunidad para demostrar profesionalismo y fortalecer la relación.',
                        failure_feedback: 'MISIÓN A MEDIAS: Te has disculpado, lo cual es un primer paso, pero la confianza sigue frágil. Las acciones pesan más que las palabras y aún tienes trabajo por hacer para demostrar tu fiabilidad.'
                    }
                }
            }
        }
    }
},
  'im-13': {
    title: 'El Puente Creativo',
    description: 'Debes mediar en un conflicto entre la jefa de diseño (Sofía), que quiere usar materiales caros y de alta calidad, y el gerente de finanzas (Roberto), que necesita recortar el presupuesto del proyecto.',
    characters: [
        { id: 'sofia', name: 'Sofía', mood: 'Apasionada' },
        { id: 'roberto', name: 'Roberto', mood: 'Pragmático' }
    ],
    mission_state: { unidad: 30, viabilidad: 40 },
    phases: {
        'phase_1_reencuadre': {
            title: 'Fase 1: Encontrar el Objetivo Común',
            goal: 'Evitar que la discusión se centre en "visión vs. dinero" y reencuadrarla hacia un objetivo compartido.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'roberto',
                    line: 'Sofía, es simple: no hay presupuesto para esos materiales. Es inviable.',
                    options: [
                        { text: 'Apoyar a Roberto: "Sofía, Roberto tiene razón, tenemos que ser realistas".', skill: {module: 'Lógica', name: 'Tomar Partido'}, effects: {unidad: '-20'}, target_node: 'p1_fail' },
                        { text: 'Validar a ambos y buscar el meta-objetivo: "Entiendo ambos puntos. Roberto, necesitas que el proyecto sea rentable. Sofía, necesitas que el producto final sea excelente. ¿Estamos de acuerdo en que ambos queremos un producto de alta calidad que también sea un éxito comercial?".', skill: {module: 'PNL', name: 'Meta-Objetivo'}, effects: {unidad: '+30'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { speaker: 'sofia', line: '¡No se trata de ser realista, se trata de no sacrificar la calidad! No me siento apoyada.', is_end_mission: true, evaluation: { failure_feedback: 'MISIÓN FALLIDA: Al tomar partido, alienaste a una de las partes y destruiste la posibilidad de una solución creativa. El conflicto escaló.' } },
                'p1_success': { speaker: 'roberto', line: 'Bueno, sí, obviamente ese es el objetivo final de todos.', is_end_phase: true, next_phase: 'phase_2_solucion' }
            }
        },
        'phase_2_solucion': {
            title: 'Fase 2: La Propuesta Híbrida',
            goal: 'Proponer una solución que satisfaga las necesidades subyacentes de ambas partes.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'sofia',
                    line: 'Exacto. Pero, ¿cómo logramos eso con estas restricciones?',
                    options: [
                        { text: 'Proponer una solución de compromiso: "¿Qué pasaría si usamos los materiales de alta calidad solo en las partes más visibles y críticas del producto, y optimizamos los costes en los componentes internos?".', skill: {module: 'Ingeniería Social', name: 'Solución de Compromiso'}, effects: {unidad: '+20', viabilidad: '+40'}, target_node: 'p2_final' },
                        { text: 'Pedirles que lo resuelvan ellos: "Ambos tienen buenos puntos, necesitan encontrar una solución".', skill: {module: 'Gestión', name: 'Delegación Pasiva'}, effects: {unidad: '-10'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'roberto',
                    line: 'Hmm... eso podría funcionar. Necesitaría ver los números, pero es una vía que podemos explorar. De acuerdo.',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { unidad: 50, viabilidad: 70 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Actuaste como un verdadero mediador. No te enfocaste en las posiciones (materiales caros vs. presupuesto bajo), sino en los intereses (calidad vs. rentabilidad) y guiaste al equipo a una solución creativa que satisfizo a ambos.',
                        failure_feedback: 'MISIÓN A MEDIAS: La discusión se detuvo, pero no se llegó a una solución real. La tensión subyacente sigue ahí y probablemente volverá a surgir.'
                    }
                }
            }
        }
    }
},
  'im-14': {
    title: 'El Muro Adolescente',
    description: 'Tu hijo adolescente, Leo, ha estado posponiendo sus responsabilidades toda la semana. Tu objetivo es lograr que ordene su habitación sin provocar una discusión.',
    characters: [ { id: 'hijo', name: 'Leo', mood: 'Apático' } ],
    mission_state: { rapport: 40, resistencia: 60 },
    phases: {
        'phase_1_acercamiento': {
            title: 'Fase 1: El Primer Contacto',
            goal: 'Iniciar la conversación de una manera que no active su resistencia natural.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'hijo',
                    line: '(Tumbado en el sofá, mirando el móvil). Hola.',
                    options: [
                        { text: 'Empezar con una orden directa: "Leo, tu habitación es un desastre. Ve a ordenarla ahora mismo".', skill: {module: 'Autoridad', name: 'Orden Directa'}, effects: {resistencia: '+30', rapport: '-20'}, target_node: 'p1_fail' },
                        { text: 'Acompasar y entrar en su mundo primero: "Hola, campeón. ¿Qué estás viendo? ¿Algo interesante?".', skill: {module: 'PNL', name: 'Acompasamiento'}, effects: {rapport: '+20', resistencia: '-10'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { speaker: 'hijo', line: '"Ugh, ya voy..." (No se mueve y sigue mirando el móvil con más intensidad).', is_end_mission: true, evaluation: { failure_feedback: 'MISIÓN FALLIDA: El enfrentamiento directo activó su muro de resistencia. Ahora, ordenar la habitación se ha convertido en una lucha de poder.' } },
                'p1_success': { speaker: 'hijo', line: 'No mucho, solo unos vídeos. ¿Qué pasa?', is_end_phase: true, next_phase: 'phase_2_propuesta' }
            }
        },
        'phase_2_propuesta': {
            title: 'Fase 2: Presentar la Tarea',
            goal: 'Enmarcar la tarea de una forma que le dé control y un beneficio claro.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'hijo',
                    line: '¿Necesitas algo?',
                    options: [
                        { text: 'Usar una pregunta cerrada: "¿Vas a ordenar tu cuarto hoy?".', skill: {module: 'Comunicación', name: 'Pregunta Cerrada'}, effects: {resistencia: '+10'}, target_node: 'p2_fail' },
                        { text: 'Dar una elección y enmarcar el beneficio: "Oye, en un rato vamos a pedir pizza. ¿Prefieres ordenar tu cuarto ahora en 15 minutos y lo dejamos listo, o después de cenar?".', skill: {module: 'Hipnosis', name: 'Ilusión de Elección'}, effects: {resistencia: '-30'}, target_node: 'p2_success' }
                    ]
                },
                'p2_fail': { speaker: 'hijo', line: '"No sé, quizás más tarde..." (La respuesta es vaga y sin compromiso).', is_end_mission: true, evaluation: { failure_feedback: 'MISIÓN FALLIDA: Una pregunta de sí/no a un adolescente sobre una tarea casi siempre resulta en un "no" o una evasiva. No creaste ninguna motivación.' } },
                'p2_success': {
                    speaker: 'hijo',
                    line: '¿Pizza? Vale... Ummm... prefiero ahora y así ya me lo quito de encima. Pero solo 15 minutos, ¿eh?',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { rapport: 50, resistencia: 30 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Has navegado la situación con maestría. Primero creaste conexión en lugar de conflicto. Luego, en lugar de dar una orden, ofreciste una elección controlada y la asociaste con una recompensa (la pizza). Has motivado la acción sin generar una discusión.',
                        failure_feedback: 'MISIÓN A MEDIAS: Aceptó, pero su resistencia sigue alta. Lograste el objetivo a corto plazo, pero la dinámica de poder no ha mejorado.'
                    }
                }
            }
        }
    }
},
  'im-15': {
    title: 'La Oferta Sobre la Mesa',
    description: 'Has recibido una oferta para un trabajo que te encanta, pero el salario inicial es inferior a tus expectativas. Tu objetivo es negociar un aumento sin parecer desagradecido o poner en riesgo la oferta.',
    characters: [ { id: 'manager', name: 'David', mood: 'Amable y profesional' } ],
    mission_state: { rapport: 60, valorPercibido: 50, riesgoOferta: 10 },
    phases: {
        'phase_1_reaccion': {
            title: 'Fase 1: La Reacción Inicial',
            goal: 'Responder a la oferta de una manera que muestre gratitud pero abra la puerta a la negociación.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'manager',
                    line: '¡Felicidades! Después de un largo proceso, estamos encantados de ofrecerte el puesto. La oferta salarial es de 60.000€ anuales.',
                    options: [
                        { text: 'Mostrar decepción: "Ah... la verdad es que esperaba un poco más".', skill: {module: 'Comunicación', name: 'Negativa'}, effects: {rapport: '-20', riesgoOferta: '+20'}, target_node: 'p1_fail' },
                        { text: 'Agradecer y crear espacio: "¡Fantásticas noticias, David! Estoy muy emocionado por la oportunidad. Agradezco mucho la oferta. ¿Hay flexibilidad para discutir los detalles de la compensación?".', skill: {module: 'Ingeniería Social', name: 'Enmarcado Positivo'}, effects: {rapport: '+10'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { speaker: 'manager', line: 'Ya veo. Bueno, esta es la cifra que el presupuesto nos permite para este puesto.', is_end_mission: true, evaluation: { failure_feedback: 'MISIÓN FALLIDA: Tu reacción inicial sonó negativa y desagradecida, lo que puso a la otra parte a la defensiva y cerró la puerta a una negociación flexible.' } },
                'p1_success': { speaker: 'manager', line: 'Claro, siempre estamos abiertos a conversar para asegurarnos de que sea un buen acuerdo para ambos. ¿Qué tienes en mente?', is_end_phase: true, next_phase: 'phase_2_justificacion' }
            }
        },
        'phase_2_justificacion': {
            title: 'Fase 2: La Justificación de Valor',
            goal: 'Argumentar tu contraoferta basándote en tu valor y datos del mercado, no en tus necesidades personales.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'manager',
                    line: 'Te escucho.',
                    options: [
                        { text: 'Basarse en necesidades: "Es que con mi alquiler y gastos, necesito al menos 68.000€ para que me compense el cambio".', skill: {module: 'Argumento', name: 'Basado en Necesidad'}, effects: {valorPercibido: '-10'}, target_node: 'p2_final' },
                        { text: 'Basarse en valor y mercado: "He investigado el rango de mercado para este rol, que se sitúa entre 68-75k€. Considerando mi experiencia específica en [habilidad clave para ellos], creo que una cifra de 70.000€ reflejaría de forma justa el valor que puedo aportar al equipo desde el primer día".', skill: {module: 'Ingeniería Social', name: 'Justificación de Valor'}, effects: {valorPercibido: '+30', rapport: '+10'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'manager',
                    line: 'Aprecio que hayas hecho tu investigación y lo presentes de esta manera. Tu punto sobre [habilidad clave] es muy válido. Déjame hablarlo internamente y te doy una respuesta mañana.',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { valorPercibido: 70, riesgoOferta: 20 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Has manejado la negociación con una profesionalidad impecable. Al agradecer, enmarcar positivamente la conversación y justificar tu valor con datos, has aumentado enormemente tus posibilidades de recibir una contraoferta favorable.',
                        failure_feedback: 'MISIÓN INCIERTA: Aunque has abierto la negociación, tu argumento fue débil. Al centrarte en tus necesidades en lugar de en el valor que aportas, es menos probable que la empresa haga un esfuerzo por aumentar la oferta.'
                    }
                }
            }
        }
    }
},
  'im-16': {
    title: 'El Cumplido Envenenado',
    description: 'En una reunión, después de una presentación exitosa, un colega (Javier) te da un cumplido que en realidad es un ataque velado. Tu objetivo es neutralizar el ataque y mantener tu estatus frente al grupo.',
    characters: [ { id: 'rival', name: 'Javier', mood: 'Competitivo' } ],
    mission_state: { rapportGrupo: 60, estatus: 50, tension: 30 },
    phases: {
        'phase_1_reaccion': {
            title: 'Fase 1: La Reacción Inmediata',
            goal: 'Responder al ataque velado sin perder la calma ni ceder el control del marco.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'rival',
                    line: '¡Felicidades! Fue una presentación sorprendentemente buena. Mucho mejor de lo que esperaba, honestamente.',
                    options: [
                        { text: 'Ponerte a la defensiva: "¿Qué quieres decir con ‘sorprendentemente buena’?".', skill: {module: 'Comunicación', name: 'Defensiva'}, effects: {estatus: '-20', tension: '+30'}, target_node: 'p1_fail' },
                        { text: 'Aceptar el cumplido e ignorar el veneno: "Gracias, Javier. Me alegro de que te haya gustado".', skill: {module: 'Mentalismo', name: 'Ignorar y Redirigir'}, effects: {estatus: '+10', tension: '-10'}, target_node: 'p1_success' },
                        { text: 'Reencuadrar con humor y confianza: "Jaja, gracias. A mí también me sorprendo a veces. Es el problema de poner el listón tan alto".', skill: {module: 'PNL', name: 'Reencuadre con Humor'}, effects: {estatus: '+20', rapportGrupo: '+10', tension: '-10'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'rival', 
                    line: 'Tranquilo, solo era un cumplido. No te pongas tan sensible.', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: Caíste en la trampa. Al reaccionar a la parte negativa, aceptaste su marco y quedaste como una persona sensible y fácil de provocar, perdiendo estatus frente al grupo.' 
                    } 
                },
                'p1_success': { 
                    speaker: 'rival', 
                    line: '(Ligeramente descolocado, no sabe cómo continuar el ataque). Ah... bueno, sí. Buen trabajo.', 
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { estatus: 60 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Manejaste la situación con maestría. Al ignorar la provocación o reencuadrarla con humor, demostraste un control total del marco. No solo neutralizaste el ataque, sino que aumentaste tu estatus como alguien imperturbable y seguro.',
                        failure_feedback: 'MISIÓN A MEDIAS: Sobreviviste al ataque, pero no saliste fortalecido. La próxima vez, intenta una respuesta que demuestre un control del marco aún mayor.'
                    }
                }
            }
        }
    }
},
  'im-17': {
    title: 'El Silencio Incómodo',
    description: 'Estás en una primera cita y, tras una buena conversación inicial, se produce un silencio repentino. Ambos miran a los lados. Tu objetivo es romper el silencio y reavivar la conexión.',
    characters: [ { id: 'cita', name: 'Elena', mood: 'Algo nerviosa' } ],
    mission_state: { rapport: 50, tension: 50 },
    phases: {
        'phase_1_ruptura': {
            title: 'Fase 1: Romper el Hielo (de nuevo)',
            goal: 'Elegir la estrategia correcta para disipar la tensión del silencio.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'cita',
                    line: '(Ambos os quedáis en silencio por unos 10 segundos. Ella remueve su bebida, evitando el contacto visual).',
                    options: [
                        { text: 'Hacer una pregunta lógica y aburrida: "Y... ¿tienes hermanos?".', skill: {module: 'Conversación', name: 'Pregunta Genérica'}, effects: {tension: '-5', rapport: '+5'}, target_node: 'p1_neutral' },
                        { text: 'Entrar en pánico y hablar de ti: "Hablando de trabajo, el otro día en mi oficina pasó algo increíble...".', skill: {module: 'Comunicación', name: 'Monólogo'}, effects: {tension: '+10', rapport: '-10'}, target_node: 'p1_fail' },
                        { text: 'Romper el marco con humor: Sonreír y decir en voz baja, "Vale, creo que este es el silencio incómodo obligatorio de la primera cita. Ya podemos tacharlo de la lista. Ahora, cuéntame algo que te apasione de verdad".', skill: {module: 'Ingeniería Social', name: 'Control del Marco'}, effects: {tension: '-30', rapport: '+20'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'cita', 
                    line: '(Asiente educadamente mientras hablas, pero notas que ha desconectado un poco).', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: El pánico te hizo hablar solo de ti. En lugar de conectar, creaste más distancia. La clave para romper un silencio es incluir a la otra persona, no excluirla con un monólogo.' 
                    } 
                },
                 'p1_neutral': { 
                    speaker: 'cita', 
                    line: 'Sí, un hermano mayor. Y tú?', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN A MEDIAS: Has roto el silencio, pero con una pregunta genérica que no genera emoción ni conexión real. La conversación sigue en terreno superficial y la tensión podría volver.' 
                    } 
                },
                'p1_success': { 
                    speaker: 'cita', 
                    line: '(Se ríe, visiblemente aliviada y sorprendida). "¡Jaja, vale, me has pillado! Tienes razón. Pues, algo que me apasiona es..."', 
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { rapport: 70, tension: 20 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Una jugada de maestro. Al reconocer el silencio con humor (Control del Marco), eliminaste toda la tensión y demostraste una gran confianza y habilidad social. No solo salvaste la situación, sino que la usaste para crear una conexión mucho más fuerte.',
                        failure_feedback: '' // No hay fallo posible en esta ruta
                    }
                }
            }
        }
    }
},
  'im-18': {
    title: 'El Eslabón Débil',
    description: 'Estás en un proyecto grupal importante. Un miembro del equipo, Alex, no ha entregado su parte y sus excusas son constantes. Debes confrontarlo para salvar el proyecto.',
    characters: [ { id: 'colega', name: 'Alex', mood: 'Evasivo' } ],
    mission_state: { rapport: 40, tension: 50, responsabilidad: 20 },
    phases: {
        'phase_1_confrontacion': {
            title: 'Fase 1: La Conversación',
            goal: 'Abordar el problema de una manera que fomente la responsabilidad en lugar de la hostilidad.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'colega',
                    line: 'Hola. Sí, sobre mi parte... he estado súper liado con otras cosas, pero ya casi lo tengo. No te preocupes.',
                    options: [
                        { text: 'Usar un marco acusatorio: "¿Otra vez la misma excusa? Nos estás perjudicando a todos. Tienes que hacerlo ya".', skill: {module: 'Confrontación', name: 'Ataque'}, effects: {tension: '+40', rapport: '-30'}, target_node: 'p1_fail' },
                        { text: 'Usar un marco colaborativo y de equipo: "Entiendo que estés ocupado, todos lo estamos. El equipo cuenta con tu parte para poder avanzar. ¿Hay algún obstáculo con el que te podamos ayudar para tenerlo listo mañana?".', skill: {module: 'Ingeniería Social', name: 'Marco Colaborativo'}, effects: {tension: '-20', rapport: '+10', responsabilidad: '+30'}, target_node: 'p1_success' },
                        { text: 'Hacer el trabajo tú mismo para evitar el conflicto.', skill: {module: 'Comunicación', name: 'Evasión'}, effects: {tension: '-30', responsabilidad: '-20'}, target_node: 'p1_evasion' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'colega', 
                    line: '¡Vale, tranquilo! ¡No tienes que atacarme! Lo haré, pero no me hables así.', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: La confrontación directa solo generó hostilidad. Aunque quizás entregue el trabajo, la relación de equipo está dañada y has creado un ambiente de tensión.' 
                    } 
                },
                'p1_evasion': { 
                    speaker: 'colega', 
                    line: '¿De verdad? ¡Eres el mejor! ¡Te debo una!', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: Has evitado el conflicto, pero a un coste muy alto. Has resuelto el problema a corto plazo, pero has reforzado su comportamiento irresponsable y has asumido una carga que no te corresponde. El problema se repetirá.' 
                    } 
                },
                'p1_success': { 
                    speaker: 'colega', 
                    line: '(Suspira, un poco avergonzado). Tienes razón. No es justo para el equipo. El obstáculo principal soy yo procrastinando. Me comprometo a tenerlo para mañana al mediodía.', 
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { responsabilidad: 50, tension: 30 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Has manejado la situación como un verdadero líder. No atacaste a la persona, sino al problema, y lo enmarcaste dentro del contexto del equipo. Al ofrecer ayuda, le quitaste las excusas y fomentaste que asumiera su responsabilidad de forma madura.',
                        failure_feedback: '' 
                    }
                }
            }
        }
    }
},
  'im-19': {
    title: 'El Guardián',
    description: 'Necesitas urgentemente 5 minutos con un directivo importante (Sr. Valente), pero su asistente (Mónica) es conocida por ser extremadamente eficiente y protectora con el tiempo de su jefe.',
    characters: [ { id: 'asistente', name: 'Mónica', mood: 'Profesional y Firme' } ],
    mission_state: { rapport: 30, credibilidad: 40, urgenciaPercibida: 20 },
    phases: {
        'phase_1_contacto': {
            title: 'Fase 1: El Contacto Inicial',
            goal: 'Presentar tu petición de una manera que genere credibilidad y no sea fácil de descartar.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'asistente',
                    line: 'Oficina del señor Valente, habla Mónica. ¿En qué puedo ayudarle?',
                    options: [
                        { text: 'Exagerar la urgencia: "Hola Mónica, es una emergencia, necesito hablar con el Sr. Valente ahora mismo".', skill: {module: 'Comunicación', name: 'Alarma'}, effects: {credibilidad: '-20', urgenciaPercibida: '+10'}, target_node: 'p1_fail' },
                        { text: 'Validar su rol y ser específico: "Hola Mónica, sé que el tiempo del Sr. Valente es muy limitado. Mi nombre es [Tu Nombre] y necesito su opinión experta de 5 minutos sobre una anomalía en el informe del proyecto Atlas que él mismo solicitó".', skill: {module: 'Ingeniería Social', name: 'Validación y Especificidad'}, effects: {rapport: '+20', credibilidad: '+30'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'asistente', 
                    line: 'Entiendo. ¿Podría decirme la naturaleza de la "emergencia"? El Sr. Valente está en una reunión.', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: La táctica de la "emergencia" es un cliché que los asistentes experimentados detectan al instante. Ha generado desconfianza y ahora te someterá a un interrogatorio.' 
                    } 
                },
                'p1_success': { 
                    speaker: 'asistente', 
                    line: 'El proyecto Atlas... entiendo. Permítame revisar su agenda. Veo que tiene una ventana de 10 minutos en una hora.', 
                    is_end_phase: true, 
                    next_phase: 'phase_2_cierre' }
            }
        },
        'phase_2_cierre': {
            title: 'Fase 2: Asegurar el Compromiso',
            goal: 'Convertir a la asistente en tu aliada para asegurar que la reunión ocurra.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'asistente',
                    line: 'Puedo agendarlo entonces. ¿Le confirmo en una hora?',
                    options: [
                        { text: 'Aceptar de forma pasiva: "Sí, perfecto, gracias".', skill: {module: 'Comunicación', name: 'Pasiva'}, effects: {rapport: '+5'}, target_node: 'p2_final' },
                        { text: 'Aceptar y empoderarla: "Eso sería fantástico, Mónica. Me salvas la vida. Lo prepararé todo para ser ultra eficiente y respetar su tiempo y el tuyo. Gracias por tu ayuda".', skill: {module: 'PNL', name: 'Elogio y Acompasamiento'}, effects: {rapport: '+20', credibilidad: '+10'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'asistente',
                    line: 'No hay problema. Me aseguraré de que el Sr. Valente tenga el contexto antes de la llamada. Confirmado.',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { rapport: 70, credibilidad: 60 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Has ejecutado una estrategia perfecta. No trataste a la asistente como un obstáculo, sino como una profesional clave. Validaste su rol, fuiste específico, demostraste respeto por su tiempo y el de su jefe, y la convertiste en tu aliada. Has conseguido la reunión.',
                        failure_feedback: 'MISIÓN A MEDIAS: Conseguiste la reunión, pero de una forma puramente transaccional. No has construido una relación con una persona clave en la organización, perdiendo una oportunidad estratégica.'
                    }
                }
            }
        }
    }
},
  'im-20': {
    title: 'El Cliente Furioso',
    description: 'Un cliente importante (Lucía) llama, furiosa porque un envío crucial llegó tarde y defectuoso, poniendo en riesgo su propio negocio. Tu objetivo es calmarla y salvar la relación comercial.',
    characters: [ { id: 'cliente', name: 'Lucía', mood: 'Furiosa' } ],
    mission_state: { rapport: 10, estres: 90, confianza: 20 },
    phases: {
        'phase_1_deescalada': {
            title: 'Fase 1: La De-escalada',
            goal: 'Absorber el impacto inicial de su ira y hacer que se sienta escuchada.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'cliente',
                    line: '¡Estoy increíblemente decepcionada! ¡Confié en ustedes! Este error me va a costar una fortuna. ¡Es inaceptable!',
                    options: [
                        { text: 'Interrumpir para ofrecer una solución inmediata: "Entiendo, le enviaré un reemplazo ahora mismo".', skill: {module: 'Solución', name: 'Reactiva'}, effects: {estres: '-5'}, target_node: 'p1_fail' },
                        { text: 'Pedirle que se calme: "Lucía, por favor, cálmese para que podamos entender el problema".', skill: {module: 'Comunicación', name: 'Invalidación'}, effects: {estres: '+10', rapport: '-20'}, target_node: 'p1_fail' },
                        { text: 'Dejar que hable, escuchar en silencio y luego validar: "Lucía, respire y cuéntemelo todo. Quiero entender exactamente qué ha pasado y cómo le ha afectado. Tiene toda la razón en estar así".', skill: {module: 'Lenguaje Corporal', name: 'Escucha Activa'}, effects: {estres: '-30', rapport: '+20'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'cliente', 
                    line: '¡No, no entiende! ¡Y no me pida que me calme! ¡Esto es un desastre!', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: Reaccionaste antes de escuchar. Al ofrecer una solución prematura o pedirle que se calme, invalidaste su emoción. La primera regla con una persona enfadada es dejar que vacíe su ira y demostrar que la escuchas.' 
                    } 
                },
                'p1_success': { 
                    speaker: 'cliente', 
                    line: '(Respira hondo, su tono baja un poco). De acuerdo. El problema es que el componente A llegó dañado y eso detuvo toda mi línea de producción...', 
                    is_end_phase: true, 
                    next_phase: 'phase_2_solucion' }
            }
        },
        'phase_2_solucion': {
            title: 'Fase 2: La Solución y Compensación',
            goal: 'No solo arreglar el problema, sino ir un paso más allá para reconstruir la confianza.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'cliente',
                    line: 'Necesito una solución, y la necesito ya.',
                    options: [
                        { text: 'Ofrecer la solución estándar: "Le enviaremos un nuevo componente A con envío urgente. Debería llegar mañana".', skill: {module: 'Servicio', name: 'Estándar'}, effects: {confianza: '+20'}, target_node: 'p2_final' },
                        { text: 'Ofrecer una solución superior (Reciprocidad): "Esto es lo que haremos: un mensajero personal le llevará un nuevo componente A en menos de 3 horas. Además, he añadido dos componentes B sin coste alguno para compensar el tiempo de producción que ha perdido por nuestra culpa".', skill: {module: 'Ingeniería Social', name: 'Reciprocidad'}, effects: {confianza: '+40', rapport: '+30'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'cliente',
                    line: '(Hace una pausa, sorprendida). ¿Un mensajero personal... y componentes extra? ... Vaya. De acuerdo. Eso... eso ayuda. Mucho. Gracias.',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { rapport: 60, confianza: 50 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Actuación impecable. Primero, absorbiste su ira con una escucha activa magistral. Luego, no solo solucionaste el problema, sino que fuiste más allá, usando la reciprocidad para compensar su pérdida. Has convertido a una cliente furiosa en una defensora leal de tu marca.',
                        failure_feedback: 'MISIÓN A MEDIAS: Solucionaste el problema, pero solo cumpliste con lo mínimo. La cliente sigue teniendo una mala experiencia y es posible que busque alternativas en el futuro. Perdiste la oportunidad de impresionarla.'
                    }
                }
            }
        }
    }
},
  'im-21': {
    title: 'La Pregunta Trampa',
    description: 'Estás en la fase final de una entrevista para un puesto importante. La entrevistadora (Elena) quiere evaluar tu autoconciencia y capacidad de crecimiento.',
    characters: [ { id: 'entrevistadora', name: 'Elena', mood: 'Analítica' } ],
    mission_state: { rapport: 60, credibilidad: 50, estatus: 50 },
    phases: {
        'phase_1_respuesta': {
            title: 'Fase 1: La Respuesta',
            goal: 'Responder a la pregunta sobre tu debilidad de una forma que aumente tu credibilidad.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'entrevistadora',
                    line: 'Tu trayectoria es muy interesante. Ahora, para conocerte un poco mejor, dime: ¿cuál dirías que es tu mayor debilidad profesional?',
                    options: [
                        { text: 'Usar el cliché: "Soy demasiado perfeccionista, a veces trabajo de más para que todo quede perfecto".', skill: {module: 'Comunicación', name: 'Cliché'}, effects: {credibilidad: '-20', estatus: '-10'}, target_node: 'p1_fail' },
                        { text: 'Ser honesto pero irrelevante: "No se me da muy bien la repostería creativa".', skill: {module: 'Comunicación', name: 'Evasión'}, effects: {rapport: '-10', credibilidad: '-10'}, target_node: 'p1_fail' },
                        { text: 'Usar el reencuadre honesto: "En el pasado, tendía a querer controlar todos los detalles de un proyecto. Me di cuenta de que esto limitaba a mi equipo, así que he trabajado activamente en aprender a delegar de forma eficaz, confiando en las fortalezas de los demás. Aún es un área en la que me mantengo consciente para seguir mejorando".', skill: {module: 'PNL', name: 'Reencuadre Honesto'}, effects: {credibilidad: '+30', estatus: '+20'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'entrevistadora', 
                    line: 'Ya veo. Entiendo. Bueno, pasemos a la siguiente pregunta...', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: Tu respuesta fue percibida como evasiva o poco original. No demostraste una autoconciencia genuina, que es el verdadero objetivo de la pregunta. Has perdido una oportunidad clave para generar credibilidad.' 
                    } 
                },
                'p1_success': { 
                    speaker: 'entrevistadora', 
                    line: 'Gracias por esa respuesta tan honesta y estructurada. Demuestra un alto nivel de autoconciencia y un enfoque proactivo hacia el crecimiento. Muy bien.', 
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { credibilidad: 70, estatus: 60 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Has convertido una pregunta trampa en tu mayor fortaleza. Al admitir una debilidad real, demostrar que has tomado acciones para mejorarla y enmarcarla como un proceso de crecimiento, has proyectado madurez, honestidad y una gran capacidad de desarrollo profesional.',
                        failure_feedback: '' 
                    }
                }
            }
        }
    }
},
  'im-22': {
    title: 'El Círculo Cerrado',
    description: 'Estás en un evento social y ves al grupo de personas con el que te interesa conectar. Están en una conversación cerrada y animada. Tu objetivo es unirte a su círculo de forma natural.',
    characters: [ { id: 'grupo', name: 'Grupo', mood: 'Animado' } ],
    mission_state: { rapport: 20, estatusSocial: 40, tension: 30 },
    phases: {
        'phase_1_acercamiento': {
            title: 'Fase 1: El Acercamiento',
            goal: 'Posicionarte físicamente y escuchar para encontrar un punto de entrada.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'grupo',
                    line: '(El grupo está riendo y debatiendo apasionadamente sobre una serie de televisión. Forman un círculo cerrado).',
                    options: [
                        { text: 'Interrumpir directamente: "Disculpen, ¿de qué serie hablan? Quiero opinar".', skill: {module: 'Comunicación', name: 'Interrupción'}, effects: {tension: '+30', rapport: '-20'}, target_node: 'p1_fail' },
                        { text: 'Acercarte al grupo, permanecer en el borde exterior y escuchar activamente con una sonrisa, esperando una pausa.', skill: {module: 'Lenguaje Corporal', name: 'Calibración y Paciencia'}, effects: {tension: '-10'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'grupo', 
                    line: '(El grupo se detiene, te miran de forma extraña y responden cortésmente pero sin invitarte a continuar. Luego retoman su conversación, cerrando el círculo de nuevo).', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: La interrupción directa es socialmente agresiva. Forzaste tu entrada en lugar de ser invitado, y el grupo instintivamente protegió su dinámica excluyéndote.' 
                    } 
                },
                'p1_success': { 
                    speaker: 'grupo', 
                    line: '(En una pausa natural, uno de los miembros nota tu presencia y te mira con curiosidad).', 
                    is_end_phase: true, 
                    next_phase: 'phase_2_entrada' 
                }
            }
        },
        'phase_2_entrada': {
            title: 'Fase 2: La Entrada',
            goal: 'Aprovechar la oportunidad para integrarte con una aportación relevante.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'grupo',
                    line: '(Uno de los miembros te da una apertura no verbal, mirándote).',
                    options: [
                        { text: 'Hacer una pregunta genérica: "¿Qué tal? Soy [Tu Nombre]".', skill: {module: 'Comunicación', name: 'Presentación Estándar'}, effects: {rapport: '+10'}, target_node: 'p2_final' },
                        { text: 'Hacer una aportación relevante y abierta: "Disculpen, no pude evitar escuchar. La opinión sobre el personaje de Víctor es muy interesante. ¿Creen que su motivación era realmente la venganza o había algo más?".', skill: {module: 'Ingeniería Social', name: 'Aportación de Valor'}, effects: {rapport: '+30', estatusSocial: '+20'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'grupo',
                    line: '¡Buena pregunta! Justo estábamos debatiendo eso. Yo creo que era por... (El grupo abre el círculo y te incluye en la conversación).',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { rapport: 50, estatusSocial: 50 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Ejecución impecable. Fuiste paciente, calibraste la situación y esperaste tu oportunidad. Tu entrada fue relevante y aportó valor a la conversación existente, lo que hizo que el grupo te aceptara de forma natural. Has sido invitado al círculo.',
                        failure_feedback: 'MISIÓN A MEDIAS: Lograste entrar, pero de una forma poco memorable. Una presentación estándar es aceptable, pero no demuestra un alto calibre social. Te arriesgas a quedar como un miembro pasivo del grupo.'
                    }
                }
            }
        }
    }
},
  'im-23': {
    title: 'El Marco del Vendedor',
    description: 'Estás en una reunión con un cliente potencial (Ricardo) que se muestra cínico y te lanza un desafío para ponerte a prueba.',
    characters: [ { id: 'cliente', name: 'Ricardo', mood: 'Desafiante' } ],
    mission_state: { rapport: 40, estatus: 40, confianza: 30 },
    phases: {
        'phase_1_ruptura_de_marco': {
            title: 'Fase 1: La Ruptura del Marco',
            goal: 'Responder al desafío inicial sin aceptar el rol de inferioridad que te asigna.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'cliente',
                    line: 'Mira, seamos directos. Ya he hablado con tres como tú esta semana. No me vendas la moto, sé que solo quieres tu comisión. Convénceme.',
                    options: [
                        { text: 'Aceptar su marco y defenderte: "No, no, mi intención es ayudarle de verdad. Nuestros productos son los mejores por...".', skill: {module: 'Comunicación', name: 'Defensiva'}, effects: {estatus: '-30', rapport: '-10'}, target_node: 'p1_fail' },
                        { text: 'Romper su marco y re-posicionarte (Power Frame): "Un momento, Ricardo. Creo que hay un malentendido. Yo no estoy aquí para ‘convencer’ a nadie. Mi trabajo es diagnosticar si los problemas que tienes encajan con las soluciones que ofrezco. Quizás no seamos un buen encaje el uno para el otro".', skill: {module: 'Ingeniería Social', name: 'Control del Marco'}, effects: {estatus: '+40'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'cliente', 
                    line: 'Sí, sí, eso dicen todos. Venga, al grano, ¿qué tienes?', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: Has aceptado su marco. Al ponerte a la defensiva, te has posicionado como un vendedor desesperado que necesita su aprobación. Has perdido todo el estatus y el control de la conversación.' 
                    } 
                },
                'p1_success': { 
                    speaker: 'cliente', 
                    line: '(Sorprendido por tu confianza, cambia su tono). ... Vaya. De acuerdo. Es un enfoque diferente. Muy bien, te escucho. ¿Cuáles son esos problemas que solucionas?', 
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { estatus: 70 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Ejecución magistral del Control del Marco. Rechazaste por completo su intento de ponerte en una caja inferior. Al estar dispuesto a abandonar la venta, te has posicionado como un experto de alto valor que elige a sus clientes. Ahora él es quien tiene que cualificar para ti.',
                        failure_feedback: ''
                    }
                }
            }
        }
    }
},
  'im-24': {
    title: 'El Colapso en la Crisis',
    description: 'Acaba de surgir un problema crítico en un proyecto importante. Tu colega (Ana) entra en tu oficina en estado de pánico.',
    characters: [ { id: 'colega', name: 'Ana', mood: 'En pánico' } ],
    mission_state: { estres: 90, confianza: 20, enfoque: 10 },
    phases: {
        'phase_1_contencion': {
            title: 'Fase 1: Contención del Pánico',
            goal: 'Reducir el nivel de estrés de Ana para que pueda pensar racionalmente.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'colega',
                    line: '¡Estamos acabados! ¡El servidor se cayó y hemos perdido toda la data del cliente! ¡Nos van a despedir!',
                    options: [
                        { text: 'Contagiarte del pánico: "¡¿Qué?! ¡No puede ser! ¡Es un desastre!".', skill: {module: 'Comunicación', name: 'Reacción Empática'}, effects: {estres: '+10'}, target_node: 'p1_fail' },
                        { text: 'Ignorar su emoción y centrarte en la lógica: "¿Estás segura? ¿Has revisado los backups?".', skill: {module: 'Lógica', name: 'Enfoque en Datos'}, effects: {estres: '-10'}, target_node: 'p1_neutral' },
                        { text: 'Tomar el control del marco y del estado: "Ana, respira. El pánico no es una estrategia. Mírame. Respira conmigo. Ahora, vamos a solucionar esto paso a paso. No estamos acabados, estamos trabajando".', skill: {module: 'Hipnosis', name: 'Liderazgo de Estado'}, effects: {estres: '-40', confianza: '+20'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'colega', 
                    line: '¡Lo sabía! ¡Te lo dije! ¿¡Qué vamos a hacer!?', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: Te dejaste arrastrar por su marco de pánico. Ahora hay dos personas asustadas en lugar de un líder buscando soluciones. El problema ha empeorado.' 
                    } 
                },
                'p1_neutral': { 
                    speaker: 'colega', 
                    line: '¡No, no he revisado nada! ¡Estoy demasiado nerviosa para pensar!', 
                    is_end_phase: true, 
                    next_phase: 'phase_2_accion' 
                },
                'p1_success': { 
                    speaker: 'colega', 
                    line: '(Respira hondo un par de veces, su lenguaje corporal cambia). Vale... vale. Tienes razón. ¿Por dónde empezamos?', 
                    is_end_phase: true, 
                    next_phase: 'phase_2_accion' 
                }
            }
        },
        'phase_2_accion': {
            title: 'Fase 2: El Plan de Acción',
            goal: 'Dirigir la energía hacia una solución constructiva.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'colega',
                    line: 'De acuerdo, ¿cuál es el primer paso?',
                    options: [
                        { text: 'Dar una orden directa: "Llama a soporte técnico inmediatamente".', skill: {module: 'Gestión', name: 'Delegación'}, effects: {enfoque: '+20'}, target_node: 'p2_final' },
                        { text: 'Crear un plan colaborativo: "Perfecto. Yo revisaré los logs del servidor para identificar la causa. Tú, por favor, redacta un borrador de email para el cliente explicando que estamos investigando una incidencia técnica, sin dar detalles alarmistas. Nos juntamos en 15 minutos".', skill: {module: 'Ingeniería Social', name: 'Plan Colaborativo'}, effects: {enfoque: '+40', confianza: '+20'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'colega',
                    line: 'Entendido. Me pongo a ello ahora mismo. Gracias.',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { estres: 40, confianza: 40, enfoque: 50 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Actuaste como un verdadero pilar en la crisis. Primero gestionaste el estado emocional de tu colega y luego canalizaste la energía hacia un plan de acción claro y colaborativo. Has transformado el caos en control.',
                        failure_feedback: 'MISIÓN A MEDIAS: Lograste que se tomaran acciones, pero no gestionaste el estado emocional de tu colega. El problema podría resolverse, pero ella sigue sintiéndose ansiosa y poco apoyada, lo que afecta la moral del equipo.'
                    }
                }
            }
        }
    }
},
  'im-25': {
    title: 'El Debate Amistoso',
    description: 'Estás en un debate amistoso con un amigo (Miguel) sobre un tema en el que tenéis opiniones opuestas (ej. si es mejor trabajar desde casa o en la oficina). Tu objetivo es persuadirlo para que considere tu punto de vista, sin que se sienta atacado.',
    characters: [ { id: 'amigo', name: 'Miguel', mood: 'Convicción' } ],
    mission_state: { rapport: 70, conviccion: 80, defensividad: 20 },
    phases: {
        'phase_1_apertura': {
            title: 'Fase 1: La Apertura',
            goal: 'Responder a su argumento inicial sin crear una confrontación directa.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'amigo',
                    line: 'No hay debate, trabajar desde la oficina es mucho mejor. La colaboración, la cultura de empresa... es simplemente superior.',
                    options: [
                        { text: 'Contradecir directamente: "Estás completamente equivocado. Trabajar desde casa es mucho más productivo".', skill: {module: 'Comunicación', name: 'Confrontación'}, effects: {defensividad: '+40', rapport: '-20'}, target_node: 'p1_fail' },
                        { text: 'Buscar un acuerdo parcial y validar: "Estoy totalmente de acuerdo en que la colaboración cara a cara tiene un valor inmenso. Es un punto muy importante".', skill: {module: 'PNL', name: 'Acuerdo Parcial'}, effects: {defensividad: '-10', rapport: '+10'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'amigo', 
                    line: '¿Equivocado? ¡Para nada! No estás viendo el panorama completo.', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: La contradicción directa convirtió un debate amistoso en una discusión. Al atacar su postura, hiciste que se aferrara a ella con más fuerza y se pusiera a la defensiva.' 
                    } 
                },
                'p1_success': { 
                    speaker: 'amigo', 
                    line: 'Exacto. Me alegro de que lo entiendas. Es crucial.', 
                    is_end_phase: true, 
                    next_phase: 'phase_2_exploracion' 
                }
            }
        },
        'phase_2_exploracion': {
            title: 'Fase 2: La Exploración Guiada',
            goal: 'Usar preguntas para guiarlo a que él mismo descubra las ventajas de tu punto de vista.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'amigo',
                    line: 'Sin esa interacción diaria, la empresa se desmorona.',
                    options: [
                        { text: 'Afirmar tu punto de vista: "Pero trabajar desde casa te da más flexibilidad y concentración".', skill: {module: 'Argumento', name: 'Afirmación'}, effects: {conviccion: '-5'}, target_node: 'p2_final' },
                        { text: 'Usar una pregunta socrática: "Y estoy de acuerdo. Dado que esa colaboración es clave, ¿qué pasaría si pudiéramos mantener esa misma calidad de colaboración, pero añadiéndole además dos horas extra de productividad al día por eliminar los desplazamientos?".', skill: {module: 'Mentalismo', name: 'Pregunta Socrática'}, effects: {conviccion: '-30', defensividad: '-10'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'amigo',
                    line: '... Bueno, si se pudiera tener ambas cosas, claro... eso sería el escenario ideal. Es un punto interesante, no lo había visto así.',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { conviccion: 50, defensividad: 10 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Estrategia perfecta. Primero validaste su punto de vista para mantener el rapport. Luego, en lugar de imponer tu argumento, usaste una pregunta guiada que le llevó a él mismo a la conclusión que tú querías. No ganaste una discusión, facilitaste un descubrimiento.',
                        failure_feedback: 'MISIÓN A MEDIAS: Lograste presentar tu punto, pero no de la forma más persuasiva. Al simplemente afirmar tu opinión, la conversación se quedó en un "tú piensas A, yo pienso B", sin que él realmente considerara cambiar de idea.'
                    }
                }
            }
        }
    }
},
  'im-26': {
    title: 'El Feedback Silencioso',
    description: 'Necesitas feedback honesto sobre una propuesta, y sabes que tu colega más brillante (Clara) tiene grandes ideas, pero es muy introvertida y rara vez habla en las reuniones. Tu objetivo es conseguir que te dé su opinión sincera.',
    characters: [ { id: 'colega', name: 'Clara', mood: 'Introvertida' } ],
    mission_state: { rapport: 50, confianza: 40, honestidad: 20 },
    phases: {
        'phase_1_crear_seguridad': {
            title: 'Fase 1: Crear un Espacio Seguro',
            goal: 'Abordar a Clara de una forma que minimice la presión social y la haga sentir cómoda.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'colega',
                    line: '(Clara está concentrada en su escritorio. Te acercas a ella). Hola.',
                    options: [
                        { text: 'Ponerla en el punto de mira: "Hola Clara, necesito tu feedback sobre esto ahora, ¿qué opinas?".', skill: {module: 'Comunicación', name: 'Presión Directa'}, effects: {confianza: '-20', rapport: '-10'}, target_node: 'p1_fail' },
                        { text: 'Minimizar la presión y dar control: "Hola Clara, sé que estás ocupada. Estoy trabajando en esta propuesta y valoro mucho tu perspectiva. ¿Te importaría si te la dejo y le echas un vistazo de 5 minutos cuando tengas un hueco? Cualquier idea, por pequeña que sea, me ayudaría un montón".', skill: {module: 'Ingeniería Social', name: 'Minimizar Presión'}, effects: {confianza: '+20', rapport: '+10'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'colega', 
                    line: 'Oh... ahora... no sé, parece que está todo bien, sí, se ve bien.', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: La presión directa hizo que se cerrara. Te dio una respuesta genérica para terminar la interacción lo antes posible. No conseguiste el feedback real.' 
                    } 
                },
                'p1_success': { 
                    speaker: 'colega', 
                    line: 'Claro, déjamela. Le echo un vistazo entre tareas.', 
                    is_end_phase: true, 
                    next_phase: 'phase_2_extraer_feedback' 
                }
            }
        },
        'phase_2_extraer_feedback': {
            title: 'Fase 2: Extraer el Feedback',
            goal: 'Usar preguntas que inviten a la crítica constructiva en lugar de a la aprobación.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'colega',
                    line: '(Más tarde, vuelves a su escritorio). Ya lo he revisado. Es un buen trabajo.',
                    options: [
                        { text: 'Preguntar por la aprobación: "¿Te ha gustado?".', skill: {module: 'Pregunta', name: 'Busca Aprobación'}, effects: {honestidad: '-10'}, target_node: 'p2_fail' },
                        { text: 'Preguntar por las debilidades (Presuposición): "Gracias. Y sé que no es perfecta. Si tuvieras que señalar cuál crees que es la parte más débil o el mayor riesgo, ¿cuál sería?".', skill: {module: 'PNL', name: 'Presuposición'}, effects: {honestidad: '+40', confianza: '+10'}, target_node: 'p2_success' }
                    ]
                },
                'p2_fail': { 
                    speaker: 'colega', 
                    line: 'Sí, sí, está muy bien. Buen trabajo.', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: Al preguntar si le gustó, la forzaste a dar una respuesta socialmente amable. No le diste permiso para criticar.' 
                    } 
                },
                'p2_success': {
                    speaker: 'colega',
                    line: '... Bueno, ya que lo preguntas... creo que la proyección de costes del tercer trimestre es un poco optimista. Quizás no estamos teniendo en cuenta el factor X...',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { confianza: 70, honestidad: 50 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Estrategia perfecta. Primero, creaste un entorno de baja presión. Luego, en lugar de pedir aprobación, diste por hecho que había fallos y pediste ayuda para encontrarlos. Esto le dio el permiso y la seguridad que necesitaba para compartir su brillante análisis.',
                        failure_feedback: ''
                    }
                }
            }
        }
    }
},
  'im-27': {
    title: 'El PIN Secreto',
    description: 'Simulas una rutina de mentalismo. Un sujeto (David) ha pensado en un PIN de 2 dígitos. Tu objetivo es "leer" sus micro-reacciones mientras nombras números en voz alta para adivinar el PIN correcto.',
    characters: [ { id: 'sujeto', name: 'David', mood: 'Concentrado' } ],
    mission_state: { credibilidad: 40, enfoque: 50 },
    secret_pin: '37', // El PIN secreto que el usuario debe adivinar
    phases: {
        'phase_1_digito1': {
            title: 'Fase 1: Descubrir el Primer Dígito',
            goal: 'Nombrar números y detectar la reacción anómala que delata al primer dígito.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'sujeto',
                    line: 'De acuerdo, ya tengo mi PIN de 2 dígitos en mente. Es imposible que lo sepas.',
                    options: [
                        { text: 'Empezar a decir números al azar: "Veo un... 5... no, un 8...".', skill: {module: 'Mentalismo', name: 'Adivinanza Pura'}, effects: {credibilidad: '-20'}, target_node: 'p1_fail' },
                        { text: 'Iniciar un sondeo sistemático: "Perfecto. No muevas ni un músculo. Voy a nombrar números. CERO... UNO... DOS... TRES... CUATRO... CINCO...".', skill: {module: 'Mentalismo', name: 'Sondeo y Calibración'}, effects: {enfoque: '+20'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'sujeto', 
                    line: 'No, ninguno de esos. No parece que estés muy conectado conmigo.', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: El mentalismo no es adivinar. Requiere un proceso. Al lanzar números al azar, perdiste toda tu credibilidad como lector de mentes.' 
                    } 
                },
                'p1_success': { 
                    speaker: 'sujeto', 
                    line: '(El sujeto permanece en silencio. Al pasar por el número TRES, notas que traga saliva de forma casi imperceptible y hay una micro-tensión en su ceja).', 
                    is_end_phase: true, 
                    next_phase: 'phase_2_digito2' 
                }
            }
        },
        'phase_2_digito2': {
            title: 'Fase 2: Descubrir el Segundo Dígito',
            goal: 'Confirmar el primer dígito y usar el mismo proceso para encontrar el segundo.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'sujeto',
                    line: '(El sujeto sigue concentrado, sin darte pistas verbales).',
                    options: [
                        { text: 'Confirmar el primer dígito y sondear el segundo: "Vale, el primer dígito es un tres. Ahora el segundo... SEIS... SIETE... OCHO...".', skill: {module: 'Lenguaje Corporal', name: 'Lectura de Micro-reacciones'}, effects: {enfoque: '+20', credibilidad: '+30'}, target_node: 'p2_revelacion' },
                        { text: 'Preguntar directamente: "¿El segundo dígito es un siete?".', skill: {module: 'Comunicación', name: 'Pregunta Directa'}, effects: {credibilidad: '-10'}, target_node: 'p2_revelacion' }
                    ]
                },
                'p2_revelacion': {
                    speaker: 'sujeto',
                    line: '(Al nombrar el número SIETE, sus pupilas se dilatan por un instante y contiene la respiración).',
                    is_end_phase: true, 
                    next_phase: 'phase_3_final'
                }
            }
        },
        'phase_3_final': {
            title: 'Fase 3: La Revelación',
            goal: 'Juntar las pistas y revelar el PIN completo de forma impactante.',
            start_node: 'p3_start',
            nodes: {
                 'p3_start': {
                    speaker: 'sujeto',
                    line: '(Te mira, esperando tu respuesta final).',
                    options: [
                        { text: 'Declarar el PIN "37".', skill: {module: 'Mentalismo', name: 'La Revelación'}, effects: {credibilidad: '+50'}, target_node: 'p3_success' },
                        { text: 'Declarar un PIN incorrecto, como "38".', skill: {module: 'Mentalismo', name: 'Error de Calibración'}, effects: {credibilidad: '-50'}, target_node: 'p3_fail_final' }
                    ]
                },
                'p3_fail_final': {
                    speaker: 'sujeto',
                    line: 'No, era el 37. ¡Casi!',
                    is_end_mission: true,
                    evaluation: {
                        failure_feedback: 'MISIÓN FALLIDA: Estabas tan cerca... Leíste correctamente el primer dígito pero te equivocaste en el segundo. La calibración requiere una atención al detalle absoluta.'
                    }
                },
                'p3_success': {
                    speaker: 'sujeto',
                    line: '...Imposible. ¿Cómo lo has hecho? Es exactamente el 37.',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { credibilidad: 90, enfoque: 70 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Una demostración impecable. Usaste un proceso sistemático, calibraste las micro-reacciones del sujeto (tensión, tragar saliva, dilatación de pupilas) y construiste la revelación final paso a paso. Has demostrado ser un agudo observador.',
                        failure_feedback: ''
                    }
                }
            }
        }
    }
},
  'im-28': {
    title: 'La Palabra de la Revista',
    description: 'Simulas un "test de libro". Tu objetivo es que el sujeto elija mentalmente una palabra CORTA y COMÚN de una página imaginaria, y que esa palabra sea LUZ.',
    characters: [ { id: 'sujeto', name: 'Sara', mood: 'Curiosa' } ],
    mission_state: { rapport: 60, credibilidad: 50, enfoque: 50 },
    phases: {
        'phase_1_forzaje': {
            title: 'Fase 1: El Forzaje Conceptual',
            goal: 'Utilizar un guion que implante la idea de la palabra "LUZ" de forma sutil.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'sujeto',
                    line: 'De acuerdo, tengo una página de una revista imaginaria en mi mente. ¿Qué hago ahora?',
                    options: [
                        { text: 'Dar instrucciones directas: "Concéntrate en la palabra LUZ. ¿La puedes ver?".', skill: {module: 'Comunicación', name: 'Orden Directa'}, effects: {credibilidad: '-30'}, target_node: 'p1_fail' },
                        { text: 'Dar una lista de opciones: "Piensa en una palabra como CASA, AMOR, VIAJE o LUZ".', skill: {module: 'Mentalismo', name: 'Elección Limitada'}, effects: {credibilidad: '-10'}, target_node: 'p1_fail' },
                        { text: 'Usar forzaje conceptual y espacial: "Perfecto. No te fijes en las palabras largas o de abajo. Enfoca tu atención en la parte superior de la página. Busca una palabra corta, simple. Una que represente la CLARIDAD, el CONOCIMIENTO, lo opuesto a la OSCURIDAD... Deja que esa palabra te llegue".', skill: {module: 'PNL', name: 'Primado Conceptual'}, effects: {credibilidad: '+30', enfoque: '+20'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'sujeto', 
                    line: 'Ah, vale. Pero así no tiene gracia, me estás diciendo qué pensar.', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: Has roto la ilusión del mentalismo. Al ser demasiado directo, el sujeto se da cuenta del método y el efecto de "leer la mente" se pierde por completo.' 
                    } 
                },
                'p1_success': { 
                    speaker: 'sujeto', 
                    line: 'De acuerdo... ya tengo una palabra en mente.', 
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { credibilidad: 70, enfoque: 60 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Has ejecutado un forzaje psicológico de libro. Dirigiste su atención a una zona (superior), definiste las características de la palabra (corta, simple) y primaste el concepto abstracto (claridad, conocimiento). Has hecho que la elección de "LUZ" sea casi inevitable, pero que se sienta como una elección personal y libre.',
                        failure_feedback: ''
                    }
                }
            }
        }
    }
},
  'im-29': {
    title: 'El Test de Asociación',
    description: 'Tu amigo (Carlos) te dice que está "un poco estresado", pero no te da detalles. Tú decides usar un test de asociación de palabras para descubrir la verdadera fuente de su estrés. Él tiene en mente la palabra "PLAZO" (deadline).',
    characters: [ { id: 'amigo', name: 'Carlos', mood: 'Estresado pero reservado' } ],
    mission_state: { rapport: 60, credibilidad: 50, enfoque: 50 },
    secret_word: 'PLAZO',
    phases: {
        'phase_1_test': {
            title: 'Fase 1: El Sondeo',
            goal: 'Nombrar una serie de palabras y calibrar la reacción de tu amigo a cada una para encontrar la que genera una respuesta de estrés.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'amigo',
                    line: 'No sé... es solo... trabajo, lo de siempre. No es nada en concreto.',
                    options: [
                        { text: 'Presionarlo para que te diga qué pasa.', skill: {module: 'Comunicación', name: 'Presión'}, effects: {rapport: '-20'}, target_node: 'p1_fail' },
                        { text: 'Iniciar el test: "Ok, hagamos un juego rápido. Voy a decir unas palabras y solo quiero que te fijes en cómo te sientes. No tienes que decir nada. La primera palabra es: VACACIONES".', skill: {module: 'Mentalismo', name: 'Sondeo y Calibración'}, effects: {rapport: '+10', enfoque: '+10'}, target_node: 'p1_continue' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'amigo', 
                    line: 'No quiero hablar de eso, de verdad. Déjalo estar.', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: La presión directa provocó que se cerrara. Una persona estresada necesita sentirse segura, no interrogada. Perdiste su confianza.' 
                    } 
                },
                'p1_continue': { 
                    speaker: 'amigo', 
                    line: '(Reacciona a tu lista de palabras. A "FAMILIA" sonríe. A "DINERO" su expresión es neutra. A "PLAZO", aprieta la mandíbula por un instante y su respiración se vuelve más superficial).', 
                    is_end_phase: true, 
                    next_phase: 'phase_2_revelacion' 
                }
            }
        },
        'phase_2_revelacion': {
            title: 'Fase 2: La Revelación Empática',
            goal: 'Usar la información que has obtenido para demostrar que lo entiendes y ofrecer ayuda.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'amigo',
                    line: 'Vale, ¿y bien? ¿Ha funcionado tu "juego"?',
                    options: [
                        { text: 'Hacer una revelación directa y fría: "Tu problema es un plazo de entrega".', skill: {module: 'Mentalismo', name: 'Revelación Directa'}, effects: {credibilidad: '+20'}, target_node: 'p2_final' },
                        { text: 'Hacer una revelación empática: "No sé los detalles, pero he notado que la palabra ‘PLAZO’ te ha generado una reacción física. Parece que hay una fecha de entrega que te está presionando mucho. Si quieres hablar de ello, aquí estoy".', skill: {module: 'Inteligencia Emocional', name: 'Lectura y Apoyo'}, effects: {credibilidad: '+30', rapport: '+30'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'amigo',
                    line: '(Sorprendido). Sí... ¿cómo lo supiste? Hay un plazo de entrega imposible la semana que viene y no sé cómo voy a llegar. Gracias por notarlo.',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { rapport: 80, credibilidad: 70 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Has demostrado una calibración y una empatía excepcionales. Calibraste la reacción fisiológica a la palabra clave y luego usaste esa información no para "adivinar", sino para mostrar comprensión y ofrecer apoyo. Has fortalecido la confianza y la amistad.',
                        failure_feedback: 'MISIÓN A MEDIAS: Acertaste, lo cual demuestra tu habilidad de observación, pero tu revelación fue fría y distante. Pareció más un truco que un acto de empatía, y no fortaleció la conexión tanto como podría haberlo hecho.'
                    }
                }
            }
        }
    }
},
  'im-30': {
    title: 'El Contacto Psíquico',
    description: 'Simulas una rutina de "contacto mental". Un sujeto (Elena) responderá "sí" o "no" a una pregunta solo en su mente. Tu objetivo es detectar la respuesta a través del contacto físico, sintiendo la respuesta ideomotora de su dedo.',
    characters: [ { id: 'sujeto', name: 'Elena', mood: 'Escéptica pero curiosa' } ],
    mission_state: { rapport: 60, credibilidad: 60, sincronizacion: 30 },
    secret_answer: 'si', // La respuesta secreta es "SÍ"
    phases: {
        'phase_1_preparacion': {
            title: 'Fase 1: La Preparación',
            goal: 'Instruir al sujeto de una manera que facilite una respuesta inconsciente y no un movimiento controlado.',
            start_node: 'p1_start',
            nodes: {
                'p1_start': {
                    speaker: 'sujeto',
                    line: 'De acuerdo. Pienso en una pregunta personal y la respuesta es "sí" o "no". Ya la tengo. ¿Ahora qué?',
                    options: [
                        { text: 'Dar instrucciones conscientes: "Perfecto. Apoya tu dedo en mi mano. Si la respuesta es SÍ, presiona hacia abajo. Si es NO, levántalo".', skill: {module: 'Comunicación', name: 'Instrucción Consciente'}, effects: {sincronizacion: '-30', credibilidad: '-20'}, target_node: 'p1_fail' },
                        { text: 'Inducir un estado inconsciente: "Excelente. Ahora, apoya tu dedo índice suavemente sobre mi mano. No intentes moverlo. Solo relájate y concéntrate. Quiero que pienses intensamente en tu respuesta... si es SÍ, piensa SÍ, SÍ, SÍ... si es NO, piensa NO, NO, NO... solo piénsalo".', skill: {module: 'Hipnosis', name: 'Respuesta Ideomotora'}, effects: {sincronizacion: '+30', rapport: '+10'}, target_node: 'p1_success' }
                    ]
                },
                'p1_fail': { 
                    speaker: 'sujeto', 
                    line: 'Vale, ya lo estoy moviendo yo. No siento nada especial.', 
                    is_end_mission: true, 
                    evaluation: { 
                        failure_feedback: 'MISIÓN FALLIDA: Has convertido el ejercicio en un acto consciente. El sujeto está moviendo el dedo voluntariamente, rompiendo toda la ilusión de una conexión mental o lectura sutil. El efecto se ha perdido.' 
                    } 
                },
                'p1_success': { 
                    speaker: 'sujeto', 
                    line: '(Cierra los ojos y se concentra. Su dedo permanece quieto, pero notas una tensión casi imperceptible).', 
                    is_end_phase: true, 
                    next_phase: 'phase_2_lectura' 
                }
            }
        },
        'phase_2_lectura': {
            title: 'Fase 2: La Lectura',
            goal: 'Interpretar correctamente el micro-movimiento inconsciente del sujeto.',
            start_node: 'p2_start',
            nodes: {
                'p2_start': {
                    speaker: 'sujeto',
                    line: '(Mientras se concentra en su respuesta "SÍ", sientes que los tendones de su dedo ejercen una presión mínima y constante hacia abajo, como si quisiera asentir pero sin moverse).',
                    options: [
                        { text: 'Declarar la respuesta basándote en la presión hacia abajo.', skill: {module: 'Lenguaje Corporal', name: 'Lectura Kinestésica'}, effects: {credibilidad: '+40'}, target_node: 'p2_final' },
                        { text: 'Dudar e interpretar la falta de movimiento grande como un "NO".', skill: {module: 'Análisis', name: 'Error de Interpretación'}, effects: {credibilidad: '-30'}, target_node: 'p2_final' }
                    ]
                },
                'p2_final': {
                    speaker: 'sujeto',
                    line: '¿Y bien? ¿Lo has sentido?',
                    is_end_mission: true,
                    evaluation: {
                        success_condition: { credibilidad: 80, sincronizacion: 60 },
                        success_feedback: '¡MISIÓN CUMPLIDA! Una demostración de una sensibilidad extraordinaria. Has preparado al sujeto correctamente para una respuesta inconsciente y has sido capaz de sentir la micro-tensión muscular asociada con el pensamiento "SÍ" (un impulso de asentimiento). Es la cima de la calibración física.',
                        failure_feedback: 'MISIÓN FALLIDA: Has sentido la ausencia de un movimiento grande y lo has malinterpretado. La respuesta ideomotora no es un movimiento obvio, sino una tensión casi imperceptible. Te ha faltado sensibilidad y confianza en tu percepción.'
                    }
                }
            }
        }
    }
}
  
};
      
      
        const microExpressionsData = [
            { emotion: 'Alegría', img: 'https://placehold.co/400x400/E2E8F0/111827?text=Alegr%C3%ADa' },
            { emotion: 'Tristeza', img: 'https://placehold.co/400x400/E2E8F0/111827?text=Tristeza' },
            { emotion: 'Ira', img: 'https://placehold.co/400x400/E2E8F0/111827?text=Ira' },
            { emotion: 'Sorpresa', img: 'https://placehold.co/400x400/E2E8F0/111827?text=Sorpresa' },
            { emotion: 'Miedo', img: 'https://placehold.co/400x400/E2E8F0/111827?text=Miedo' },
            { emotion: 'Asco', img: 'https://placehold.co/400x400/E2E8F0/111827?text=Asco' },
            { emotion: 'Desprecio', img: 'https://placehold.co/400x400/E2E8F0/111827?text=Desprecio' },
        ];
        
        // --- Lógica de la App ---
        const allViews = document.querySelectorAll('.view');
        const bottomNav = document.getElementById('bottom-nav');
        let navigationHistory = ['tabs-view'];
        let gymState = { score: 0, currentEmotion: null, round: 0, totalRounds: 10 };

        function showView(viewId) {
            allViews.forEach(view => view.classList.add('hidden'));
            document.getElementById(viewId)?.classList.remove('hidden');
            bottomNav.style.display = viewId === 'tabs-view' ? 'flex' : 'none';
            window.scrollTo(0, 0);
            lucide.createIcons();
        }

        function navigateTo(viewId) {
            navigationHistory.push(viewId);
            showView(viewId);
        }

        function navigateBack(isCompleted = false) {
            if (navigationHistory.length > 1) {
                navigationHistory.pop();
                const previousViewId = navigationHistory[navigationHistory.length - 1];
                showView(previousViewId);
            }
            if (isCompleted) console.log("Actividad completada!");
        }

      
        function showTab(tabId) {
    if (tabId === 'diario') {
        renderNotesList(); // <-- AÑADE ESTA LÍNEA
    }
    navigationHistory = ['tabs-view'];
    showView('tabs-view');
    document.querySelectorAll('.tab-content').forEach(s => s.classList.add('hidden'));
    document.getElementById(tabId)?.classList.remove('hidden');
    document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
    document.querySelector(`button[onclick="showTab('${tabId}')"]`)?.classList.add('active');
}

        function renderModules() {
            const grid = document.getElementById('modules-grid');
            if (!grid) return;
            grid.innerHTML = '';
            for (const moduleId in modules) {
                const module = modules[moduleId];
                grid.innerHTML += `<div onclick="showModule('${moduleId}')" class="bg-gray-800 p-5 rounded-xl shadow-lg border border-gray-700 cursor-pointer hover:bg-gray-700 transition-colors flex items-center"><div class="p-3 bg-${module.color}-600 rounded-lg mr-4"><i data-lucide="${module.icon}"></i></div><div><h3 class="text-xl font-bold text-${module.color}-400">${module.title}</h3><p class="text-gray-400">${module.subtitle}</p></div><i data-lucide="chevron-right" class="ml-auto text-gray-500"></i></div>`;
            }
        }

        function showModule(moduleId) {
            const module = modules[moduleId];
            if (!module || !module.levels) return alert('Este módulo aún no tiene contenido.');
            let content = `<header class="flex items-center mb-6"><button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button><h1 class="text-2xl font-bold">${module.title}</h1></header><div class="space-y-8">`;
            for (const levelTitle in module.levels) {
                content += `<div><h2 class="text-xl font-semibold text-gray-300 mb-3">${levelTitle}</h2><div class="space-y-2">`;
                module.levels[levelTitle].forEach(lessonId => {
                    const lesson = lessons[lessonId];
                    if (lesson) content += `<div onclick="showLesson('${lessonId}')" class="bg-gray-800 p-4 rounded-lg flex items-center cursor-pointer hover:bg-gray-700 transition-colors"><i data-lucide="play-circle" class="text-${module.color}-400 mr-4"></i><span class="flex-grow">${lesson.title}</span><i data-lucide="chevron-right" class="text-gray-500"></i></div>`;
                });
                content += `</div></div>`;
            }
            content += `</div>`;
            document.getElementById('module-detail-view').innerHTML = content;
            navigateTo('module-detail-view');
        }
        
        function showLesson(lessonId) {
            const lesson = lessons[lessonId];
            if (!lesson) return;
            let content = `<header class="flex items-center mb-6"><button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button><h1 class="text-2xl font-bold">${lesson.title}</h1></header><div class="prose prose-invert max-w-none text-gray-300">${lesson.content}</div><button onclick="navigateBack(true)" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-colors mt-8">Marcar como completada</button>`;
            document.getElementById('lesson-view').innerHTML = content;
            navigateTo('lesson-view');
        }

        function showChallenge(challengeId) {
            const challenge = challenges[challengeId];
            if (!challenge) return;
            
            let optionsHtml = '';
            challenge.options.forEach(opt => {
                optionsHtml += `<div onclick="toggleOption(this)" data-correct="${opt.correct}" class="challenge-option bg-gray-800 p-4 rounded-lg border-2 border-gray-700 cursor-pointer flex items-center"><i data-lucide="check-circle" class="mr-3 opacity-0"></i> ${opt.text}</div>`;
            });

            const content = `
                <header class="flex items-center mb-6"><button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button><h1 class="text-2xl font-bold">${challenge.title}</h1></header>
                <div class="space-y-6">
                    <div class="bg-gray-800 p-4 rounded-lg border border-gray-700">
                        <h2 class="text-lg font-semibold mb-2">El Escenario:</h2>
                        <p class="text-gray-300">${challenge.scenario}</p>
                        <p class="text-gray-300 mt-2">${challenge.question}</p>
                    </div>
                    <div id="challenge-options" class="space-y-3">${optionsHtml}</div>
                    <div id="feedback-area" class="hidden mt-4 p-4 bg-gray-800 rounded-lg"></div>
                    <button id="verify-button" onclick="verifyChallenge()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors mt-4">Verificar Respuestas</button>
                    <button id="next-button" onclick="navigateBack(true)" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-colors mt-4 hidden">¡Genial! Finalizar Reto</button>
                </div>`;

            document.getElementById('challenge-view').innerHTML = content;
            navigateTo('challenge-view');
        }

        function startRandomChallenge() {
            const challengeKeys = Object.keys(challenges);
            const randomKey = challengeKeys[Math.floor(Math.random() * challengeKeys.length)];
            showChallenge(randomKey);
        }
        
        function showLabTool(toolId) {
            if (toolId === 'micro-expressions-gym') {
                startMicroExpressionsGame();
            } else if (toolId === 'challenge-library') {
                showChallengeLibrary();
            }
        }
      
      
      function showSimulationLibrary() {
    const libraryView = document.getElementById('simulation-library-view');
    let content = `<header class="flex items-center mb-6"><button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button><h1 class="text-2xl font-bold">Biblioteca de Simulaciones</h1></header><div class="space-y-4">`;
    
    for (const simId in simulations) {
        const sim = simulations[simId];
        content += `
            <div onclick="startSimulation('${simId}')" class="bg-gray-800 p-4 rounded-lg flex items-center cursor-pointer hover:bg-gray-700 transition-colors">
                <i data-lucide="message-square" class="text-yellow-400 mr-4"></i>
                <div class="flex-grow">
                    <h3 class="font-bold">${sim.title}</h3>
                    <p class="text-sm text-gray-400">${sim.npc.name} (${sim.npc.mood})</p>
                </div>
                <i data-lucide="chevron-right" class="text-gray-500"></i>
            </div>
        `;
    }

    content += `</div>`;
    libraryView.innerHTML = content;
    navigateTo('simulation-library-view');
}
      

        function showChallengeLibrary() {
            const libraryView = document.getElementById('challenge-library-view');
            let content = `<header class="flex items-center mb-6"><button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button><h1 class="text-2xl font-bold">Biblioteca de Retos</h1></header><div class="space-y-4">`;
            
            for (const challengeId in challenges) {
                const challenge = challenges[challengeId];
                content += `
                    <div onclick="showChallenge('${challengeId}')" class="bg-gray-800 p-4 rounded-lg flex items-center cursor-pointer hover:bg-gray-700 transition-colors">
                        <i data-lucide="file-text" class="text-blue-400 mr-4"></i>
                        <span class="flex-grow">${challenge.title}</span>
                        <i data-lucide="chevron-right" class="text-gray-500"></i>
                    </div>
                `;
            }

            content += `</div>`;
            libraryView.innerHTML = content;
            navigateTo('challenge-library-view');
        }

        function startMicroExpressionsGame() {
            gymState = { score: 0, currentEmotion: null, round: 0, totalRounds: 10 };
            const gymView = document.getElementById('micro-expressions-gym-view');
            gymView.innerHTML = `
                <header class="flex items-center mb-4">
                    <button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button>
                    <h1 class="text-2xl font-bold">Gimnasio de Microexpresiones</h1>
                    <div class="ml-auto text-lg font-semibold bg-gray-700 px-3 py-1 rounded-lg">Score: <span id="gym-score">0</span></div>
                </header>
                <div class="flex-grow flex flex-col items-center justify-center">
                    <div id="gym-image-container" class="w-64 h-64 bg-gray-700 rounded-lg flex items-center justify-center mb-6">
                        <p id="gym-message" class="text-xl">¡Prepárate!</p>
                    </div>
                    <div id="gym-options-container" class="w-full max-w-md grid grid-cols-2 gap-3"></div>
                    <div id="gym-feedback" class="mt-4 h-10 text-lg font-bold"></div>
                </div>
            `;
            navigateTo('micro-expressions-gym-view');
            setTimeout(nextMicroExpressionRound, 2000);
        }

        function nextMicroExpressionRound() {
            gymState.round++;
            if (gymState.round > gymState.totalRounds) {
                endMicroExpressionsGame();
                return;
            }
            const imageContainer = document.getElementById('gym-image-container');
            const optionsContainer = document.getElementById('gym-options-container');
            const feedback = document.getElementById('gym-feedback');
            
            feedback.innerHTML = '';
            optionsContainer.innerHTML = '';
            imageContainer.innerHTML = '';

            const randomIndex = Math.floor(Math.random() * microExpressionsData.length);
            gymState.currentEmotion = microExpressionsData[randomIndex];
            
            imageContainer.innerHTML = `<img src="${gymState.currentEmotion.img}" class="w-full h-full object-cover rounded-lg">`;
            
            setTimeout(() => {
                imageContainer.innerHTML = `<p class="text-2xl font-bold">¿Qué emoción era?</p>`;
                
                const emotions = microExpressionsData.map(e => e.emotion);
                emotions.sort(() => Math.random() - 0.5);
                const choices = [gymState.currentEmotion.emotion];
                while(choices.length < 4) {
                    const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
                    if (!choices.includes(randomEmotion)) {
                        choices.push(randomEmotion);
                    }
                }
                choices.sort(() => Math.random() - 0.5);

                choices.forEach(choice => {
                    optionsContainer.innerHTML += `<button onclick="checkMicroExpressionAnswer('${choice}')" class="p-4 bg-gray-800 rounded-lg text-lg hover:bg-blue-700 transition-colors">${choice}</button>`;
                });
                lucide.createIcons();

            }, 700);
        }

        function checkMicroExpressionAnswer(selectedEmotion) {
            const feedback = document.getElementById('gym-feedback');
            const optionsContainer = document.getElementById('gym-options-container');
            optionsContainer.innerHTML = '';

            if (selectedEmotion === gymState.currentEmotion.emotion) {
                gymState.score += 10;
                feedback.innerHTML = `<p class="feedback-correct">¡Correcto! +10 Puntos</p>`;
            } else {
                feedback.innerHTML = `<p class="feedback-incorrect">Incorrecto. La emoción era ${gymState.currentEmotion.emotion}.</p>`;
            }
            document.getElementById('gym-score').innerText = gymState.score;
            setTimeout(nextMicroExpressionRound, 2000);
        }

        function endMicroExpressionsGame() {
            const gymView = document.getElementById('micro-expressions-gym-view');
            gymView.innerHTML = `
                 <header class="flex items-center mb-4">
                    <button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button>
                    <h1 class="text-2xl font-bold">Juego Terminado</h1>
                </header>
                <div class="flex-grow flex flex-col items-center justify-center text-center">
                    <i data-lucide="award" class="w-24 h-24 text-yellow-400 mb-4"></i>
                    <h2 class="text-3xl font-bold">¡Buen trabajo!</h2>
                    <p class="text-xl text-gray-300 mt-2">Tu puntuación final es:</p>
                    <p class="text-6xl font-bold my-4 text-green-400">${gymState.score}</p>
                    <button onclick="startMicroExpressionsGame()" class="w-full max-w-xs bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors mt-6">Jugar de Nuevo</button>
                    <button onclick="navigateBack()" class="w-full max-w-xs bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-colors mt-2">Volver al Laboratorio</button>
                </div>
            `;
            lucide.createIcons();
        }

        function toggleOption(element) {
            element.classList.toggle('selected');
            const icon = element.querySelector('svg.lucide-check-circle');
            if (icon) icon.style.opacity = element.classList.contains('selected') ? '1' : '0';
        }

        function verifyChallenge() {
            const options = document.querySelectorAll('#challenge-view .challenge-option');
            let userCorrectSelections = 0;
            let userIncorrectSelections = 0;
            let totalCorrectOptions = 0;

            options.forEach(option => {
                const isCorrect = option.getAttribute('data-correct') === 'true';
                if (isCorrect) totalCorrectOptions++;
                if (option.classList.contains('selected')) {
                    if (isCorrect) userCorrectSelections++;
                    else userIncorrectSelections++;
                }
            });

            options.forEach(option => {
                const isCorrect = option.getAttribute('data-correct') === 'true';
                const isSelected = option.classList.contains('selected');
                
                option.classList.remove('selected', 'border-blue-500'); // Limpiar estilos
                
                if (isSelected && isCorrect) {
                    option.classList.add('border-green-500');
                } else if (isSelected && !isCorrect) {
                    option.classList.add('border-red-500');
                } else if (!isSelected && isCorrect) {
                    option.classList.add('border-yellow-500');
                }
                option.onclick = null;
            });

            const feedbackArea = document.getElementById('feedback-area');
            let feedbackText = `<h3 class="font-bold text-lg mb-2">Resultados:</h3>`;

            if (userIncorrectSelections > 0) {
                feedbackText += `<p class="feedback-incorrect">Has seleccionado una o más opciones incorrectas (en rojo). La precisión es clave.</p>`;
            } else if (userCorrectSelections === totalCorrectOptions) {
                feedbackText += `<p class="feedback-correct">¡Perfecto! Has identificado todas las señales correctas sin errores. ¡Excelente calibración!</p>`;
            } else if (userCorrectSelections > 0 && userCorrectSelections < totalCorrectOptions) {
                feedbackText += `<p class="text-yellow-400">¡Buen intento! Identificaste algunas señales correctas (en verde), pero te faltaron otras (en amarillo).</p>`;
            } else {
                feedbackText += `<p class="feedback-incorrect">Parece que no has identificado las señales correctas. Revisa las opciones marcadas en amarillo.</p>`;
            }

            feedbackArea.innerHTML = feedbackText;
            feedbackArea.classList.remove('hidden');
            document.getElementById('verify-button').classList.add('hidden');
            document.getElementById('next-button').classList.remove('hidden');
        }

        // --- Lógica del Sistema de Notas (Diario) ---

function getNotes() {
    // Obtiene las notas de localStorage y las convierte de texto a un objeto.
    // Si no hay notas, devuelve un array vacío.
    const notesJSON = localStorage.getItem('journalNotes');
    try {
        return notesJSON ? JSON.parse(notesJSON) : [];
    } catch (e) {
        return [];
    }
}

function saveNotesToStorage(notes) {
    // Guarda el array de notas en localStorage como texto.
    localStorage.setItem('journalNotes', JSON.stringify(notes));
}

function renderNotesList() {
    const notes = getNotes();
    const container = document.getElementById('notes-list-container');

    if (notes.length === 0) {
        container.innerHTML = '<p class="text-gray-400">No tienes notas guardadas todavía.</p>';
        return;
    }

    container.innerHTML = ''; // Limpiar el contenedor
    notes.forEach(note => {
        const noteElement = document.createElement('div');
        noteElement.className = 'bg-gray-800 p-4 rounded-lg';
        noteElement.innerHTML = `
            <h3 class="font-bold text-lg truncate">${note.title || 'Nota sin título'}</h3>
            <p class="text-sm text-gray-400 mt-1 h-6 overflow-hidden">${note.content || 'Sin contenido...'}</p>
            <div class="flex justify-end space-x-2 mt-3">
                <button onclick="editNote('${note.id}')" class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded text-sm">Editar</button>
                <button onclick="deleteNote('${note.id}')" class="bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded text-sm">Eliminar</button>
            </div>
        `;
        container.appendChild(noteElement);
    });
}

function showNoteEditor(noteId = null) {
    const notes = getNotes();
    const editorTitle = document.getElementById('note-editor-title');
    const idInput = document.getElementById('note-id-input');
    const titleInput = document.getElementById('note-title-input');
    const contentInput = document.getElementById('note-content-input');

    if (noteId) {
        // Estamos editando una nota existente
        const noteToEdit = notes.find(note => note.id === noteId);
        if (noteToEdit) {
            editorTitle.innerText = 'Editar Nota';
            idInput.value = noteToEdit.id;
            titleInput.value = noteToEdit.title;
            contentInput.value = noteToEdit.content;
        }
    } else {
        // Estamos creando una nota nueva
        editorTitle.innerText = 'Crear Nota';
        idInput.value = '';
        titleInput.value = '';
        contentInput.value = '';
    }
    navigateTo('note-editor-view');
}

function saveNote() {
    const id = document.getElementById('note-id-input').value;
    const title = document.getElementById('note-title-input').value;
    const content = document.getElementById('note-content-input').value;
    let notes = getNotes();

    if (id) {
        // Actualizar nota existente
        const noteIndex = notes.findIndex(note => note.id === id);
        if (noteIndex > -1) {
            notes[noteIndex].title = title;
            notes[noteIndex].content = content;
        }
    } else {
        // Crear nota nueva
        const newNote = {
            id: new Date().getTime().toString(), // ID único basado en la fecha
            title: title,
            content: content
        };
        notes.push(newNote);
    }

    saveNotesToStorage(notes);
    renderNotesList(); // Actualizar la lista en la vista del diario
    navigateBack(); // Volver a la vista del diario
}

function editNote(noteId) {
    showNoteEditor(noteId);
}

function deleteNote(noteId) {
    const confirmation = confirm('¿Estás seguro de que quieres eliminar esta nota? Esta acción no se puede deshacer.');
    if (confirmation) {
        let notes = getNotes();
        notes = notes.filter(note => note.id !== noteId);
        saveNotesToStorage(notes);
        renderNotesList(); // Volver a renderizar la lista actualizada
    }
}
      
        
        function confirmResetProgress() {
            const confirmation = confirm("¿Estás seguro de que quieres reiniciar tu progreso? Esta acción no se puede deshacer.");
            if (confirmation) {
                localStorage.clear();
                alert("Tu progreso ha sido reiniciado.");
                location.reload();
            }
        }
      
      let currentSim = null;
      let currentMission = null;

function showDailyMission() {
    const missionCard = document.getElementById('mission-content');
    if (!missionCard) return;

    const today = new Date().toISOString().slice(0, 10);
    const lastMissionDate = localStorage.getItem('lastMissionDate');
    let missionId = localStorage.getItem('dailyMissionId');

    // Si es un nuevo día o no hay ninguna misión, elige una nueva.
    if (lastMissionDate !== today || !missionId) {
        missionId = pickNewDailyMission();
    }

    currentMission = missions[missionId];
    const isCompleted = localStorage.getItem('missionCompleted') === 'true';

    // Esta parte es la misma que antes, solo que ahora la usaremos menos.
    if (isCompleted) {
        missionCard.innerHTML = `
            <h3 class="text-xl font-bold mb-2 text-purple-400">${currentMission.title}</h3>
            <p class="text-gray-300 mb-4">${currentMission.description}</p>
            <button onclick="generateNewMission()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">¡Dame otra misión!</button>
        `;
    } else {
        missionCard.innerHTML = `
            <h3 class="text-xl font-bold mb-2 text-purple-400">${currentMission.title}</h3>
            <p class="text-gray-300 mb-4">${currentMission.description}</p>
            <button onclick="completeMission('${missionId}')" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Marcar como Completada</button>
        `;
    }
}
      
      function pickNewDailyMission() {
    const today = new Date().toISOString().slice(0, 10);
    const missionKeys = Object.keys(missions);
    const missionId = missionKeys[Math.floor(Math.random() * missionKeys.length)];

    localStorage.setItem('dailyMissionId', missionId);
    localStorage.setItem('lastMissionDate', today);
    localStorage.setItem('missionCompleted', 'false'); // Siempre la reseteamos al elegir una nueva.

    return missionId;
}

function generateNewMission() {
    pickNewDailyMission();
    showDailyMission();
}
      

function completeMission(missionId) {
    // La parte de crear la nota de reflexión sigue siendo la misma y es genial.
    const mission = missions[missionId];
    let notes = getNotes();
    const newReflectionNote = {
        id: new Date().getTime().toString(),
        title: `Reflexión: ${mission.title}`,
        content: `Misión de Campo Completada.\n\n- ¿Qué hice exactamente?\n\n- ¿Qué observé en mí y en los demás?\n\n- ¿Qué aprendí o qué podría hacer diferente la próxima vez?\n`
    };
    notes.push(newReflectionNote);
    saveNotesToStorage(notes);

    // ¡Aquí está la magia! Inmediatamente después de guardar la nota,
    // elegimos la siguiente misión.
    pickNewDailyMission();

    // Actualizamos la tarjeta de misión en la pantalla de inicio (aunque no la veamos).
    showDailyMission(); 

    // Llevamos al usuario a editar la nota de reflexión que acabamos de crear.
    editNote(newReflectionNote.id); 
}
      
      
      function createSnippetFromHtml(html, length = 100) {
    // Esta pequeña función ayuda a crear una descripción corta a partir del contenido de la lección
    const text = html.replace(/<[^>]*>?/gm, ' '); // Elimina todas las etiquetas HTML
    return text.substring(0, length).trim() + '...';
}

function showDailyLesson() {
    const lessonContainer = document.getElementById('daily-lesson-container');
    if (!lessonContainer) return;

    const today = new Date().toISOString().slice(0, 10);
    const lastLessonDate = localStorage.getItem('lastLessonDate');
    let lessonId = localStorage.getItem('dailyLessonId');

    if (lastLessonDate !== today || !lessonId) {
        // Es un nuevo día o no hay lección guardada, elegimos una nueva.
        const lessonKeys = Object.keys(lessons);
        lessonId = lessonKeys[Math.floor(Math.random() * lessonKeys.length)];
        localStorage.setItem('dailyLessonId', lessonId);
        localStorage.setItem('lastLessonDate', today);
    }

    const lesson = lessons[lessonId];
    const snippet = createSnippetFromHtml(lesson.content);

    lessonContainer.innerHTML = `
        <h3 class="text-xl font-bold mb-2 text-blue-400">${lesson.title}</h3>
        <p class="text-gray-300 mb-4">${snippet}</p>
        <button onclick="showLesson('${lessonId}')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Empezar Lección</button>
    `;
}
      

function startSimulation(simId) {
    currentSim = simulations[simId];
    if (!currentSim) return;

    const simView = document.getElementById('simulation-view');
    simView.innerHTML = `
        <header class="flex items-center mb-4">
            <button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button>
            <h1 class="text-2xl font-bold">${currentSim.title}</h1>
        </header>
        <div id="conversation-container" class="flex-grow flex flex-col justify-end space-y-4">
            </div>
    `;
    navigateTo('simulation-view');
    renderConversationNode('start');
}

function renderConversationNode(nodeId) {
    const node = currentSim.conversation[nodeId];
    if (!node) return;

    const conversationContainer = document.getElementById('conversation-container');
    
    // Limpia las opciones anteriores
    const oldOptions = conversationContainer.querySelector('#user-options');
    if(oldOptions) oldOptions.remove();

    // Añade la línea del NPC
    const npcBubble = document.createElement('div');
    npcBubble.className = 'p-4 bg-gray-700 rounded-lg max-w-lg self-start animate-fade-in';
    npcBubble.innerHTML = `<p class="font-bold text-blue-400 mb-1">${currentSim.npc.name} (${currentSim.npc.mood})</p><p class="text-gray-200">${node.npc_line}</p>`;
    conversationContainer.appendChild(npcBubble);
    
    // Si es un nodo final, muestra el feedback
    if (node.is_end) {
        const feedbackBubble = document.createElement('div');
        const feedbackColor = node.feedback.startsWith('¡ÉXITO!') ? 'border-green-500 bg-green-900_bg-opacity-25' : 'border-red-500 bg-red-900_bg-opacity-25';
        feedbackBubble.className = `p-4 rounded-lg mt-4 border-2 ${feedbackColor} animate-fade-in`;
        feedbackBubble.innerHTML = `<h3 class="font-bold text-lg mb-2">Resultado de la Simulación:</h3><p>${node.feedback}</p>`;
        
        const restartButton = document.createElement('button');
        restartButton.className = 'w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors mt-4';
        restartButton.innerText = 'Volver a Intentar';
        restartButton.onclick = () => startSimulation(Object.keys(simulations).find(key => simulations[key] === currentSim));
        
        conversationContainer.appendChild(feedbackBubble);
        conversationContainer.appendChild(restartButton);

    } else { // Si no es un nodo final, muestra las opciones del usuario
        const optionsContainer = document.createElement('div');
        optionsContainer.id = 'user-options';
        optionsContainer.className = 'w-full pt-4 space-y-3 animate-fade-in';
        node.options.forEach(opt => {
            const optionButton = document.createElement('button');
            optionButton.className = 'w-full text-left p-4 bg-blue-800 hover:bg-blue-700 rounded-lg transition-colors';
            optionButton.innerHTML = `<p class="font-semibold">${opt.text}</p><p class="text-xs text-blue-300">Técnica: ${opt.technique}</p>`;
            optionButton.onclick = () => selectSimOption(opt.target_node);
            optionsContainer.appendChild(optionButton);
        });
        conversationContainer.appendChild(optionsContainer);
    }
    
    // Scroll hasta el final
    conversationContainer.scrollTop = conversationContainer.scrollHeight;
    lucide.createIcons(); // Para el icono de la flecha
}

function selectSimOption(targetNodeId) {
    renderConversationNode(targetNodeId);
}
      function showMentalismLab() {
    const labView = document.getElementById('mentalism-lab-view');
    let content = `<header class="flex items-center mb-6"><button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button><h1 class="text-2xl font-bold">Ejercicios de Mentalismo</h1></header><div class="space-y-4">`;
    
    for (const exerciseId in mentalism_exercises) {
        const exercise = mentalism_exercises[exerciseId];
        content += `
            <div onclick="startMentalismExercise('${exerciseId}')" class="bg-gray-800 p-4 rounded-lg flex items-center cursor-pointer hover:bg-gray-700 transition-colors">
                <i data-lucide="brain-circuit" class="text-purple-400 mr-4"></i>
                <div class="flex-grow">
                    <h3 class="font-bold">${exercise.title}</h3>
                </div>
                <i data-lucide="chevron-right" class="text-gray-500"></i>
            </div>
        `;
    }

    content += `</div>`;
    labView.innerHTML = content;
    navigateTo('mentalism-lab-view');
}

function startMentalismExercise(exerciseId) {
    const exercise = mentalism_exercises[exerciseId];
    if (!exercise) return;

    // Decidimos qué tipo de ejercicio renderizar
    // Si la propiedad 'type' es 'reading', llama a la función de lectura.
    if (exercise.type === 'reading') {
        renderReadingExercise(exerciseId);
    } else {
        // De lo contrario, asume que es un ejercicio de 'forzaje' y llama a esa función.
        renderForcingExercise(exerciseId);
    }
}
      
      function showMissionLibrary() {
    const libraryView = document.getElementById('mission-library-view');
    let content = `<header class="flex items-center mb-6"><button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button><h1 class="text-2xl font-bold">Biblioteca de Misiones de Campo</h1></header><div class="space-y-4">`;

    // Un objeto para agrupar las misiones por categoría
    const missionsByCategory = {};

    for (const missionId in missions) {
        const mission = missions[missionId];
        if (!missionsByCategory[mission.category]) {
            missionsByCategory[mission.category] = [];
        }
        missionsByCategory[mission.category].push(mission);
    }

    // Ahora iteramos sobre las categorías para mostrar títulos
    for (const category in missionsByCategory) {
        content += `<h2 class="text-xl font-semibold text-gray-300 pt-4">${category}</h2>`;
        missionsByCategory[category].forEach(mission => {
            content += `
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h3 class="font-bold text-purple-400">${mission.title} <span class="text-xs font-light text-gray-400">(${mission.difficulty})</span></h3>
                    <p class="text-sm text-gray-300 mt-1">${mission.description}</p>
                </div>
            `;
        });
    }

    content += `</div>`;
    libraryView.innerHTML = content;
    navigateTo('mission-library-view');
}
      
      
      function renderForcingExercise(exerciseId) {
    const exercise = mentalism_exercises[exerciseId];
    const exerciseView = document.getElementById('mentalism-exercise-view');
    let optionsHtml = '';
    exercise.script_options.forEach((opt, index) => {
        optionsHtml += `<button id="me-opt-${index}" onclick="checkMentalismAnswer('${exerciseId}', ${index})" class="w-full text-left p-4 bg-gray-900 hover:bg-gray-700 rounded-lg transition-colors border-2 border-gray-700">
            <p class="text-gray-300">"${opt.text}"</p>
            <p class="text-xs text-purple-300 mt-2">Enfoque: ${opt.technique_summary}</p>
        </button>`;
    });

    exerciseView.innerHTML = `
        <header class="flex items-center mb-4">
            <button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button>
            <h1 class="text-2xl font-bold">${exercise.title}</h1>
        </header>
        <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 mb-6">
            <h2 class="text-lg font-semibold mb-2">Tu Objetivo:</h2>
            <p class="text-gray-300">${exercise.description}</p>
            <p class="text-center font-bold text-2xl text-yellow-400 my-3">HAZ QUE ELIJAN: ${exercise.target_choice}</p>
        </div>
        <div id="mentalism-options-container" class="space-y-3">${optionsHtml}</div>
        <div id="mentalism-feedback-area" class="mt-6"></div>
    `;
    navigateTo('mentalism-exercise-view');
}


// 3. FUNCIÓN DE APOYO PARA EJERCICIOS DE LECTURA (me-3)
// Esta es la función que creamos en el paso anterior. Muestra los ejercicios de
// "analizar pistas no verbales".

function renderReadingExercise(exerciseId) {
    const exercise = mentalism_exercises[exerciseId];
    const exerciseView = document.getElementById('mentalism-exercise-view');

    let questionsHtml = '';
    exercise.probing_questions.forEach(q => {
        questionsHtml += `<button id="me-q-${q.id}" onclick="showReadingReaction('${exerciseId}', '${q.id}')" class="w-full text-left p-4 bg-gray-900 hover:bg-gray-700 rounded-lg transition-colors border-2 border-gray-700">${q.text}</button>`;
    });

    exerciseView.innerHTML = `
        <header class="flex items-center mb-4">
            <button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button>
            <h1 class="text-2xl font-bold">${exercise.title}</h1>
        </header>
        <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 mb-6">
            <h2 class="text-lg font-semibold mb-2">Tu Objetivo:</h2>
            <p class="text-gray-300">${exercise.description}</p>
        </div>
        <h3 class="text-md font-semibold mb-3 text-yellow-400">1. Haz tus preguntas de prueba:</h3>
        <div class="space-y-3 mb-6">${questionsHtml}</div>
        
        <h3 class="text-md font-semibold mb-3 text-yellow-400">2. Analiza las reacciones y decide:</h3>
        <div id="mentalism-reaction-area" class="space-y-2 mb-6"></div>
        <div id="mentalism-final-choice-area" class="hidden grid grid-cols-2 gap-3">
             <button onclick="makeFinalGuess('${exerciseId}', 'izquierda')" class="p-4 bg-blue-800 hover:bg-blue-700 rounded-lg">Mano Izquierda</button>
             <button onclick="makeFinalGuess('${exerciseId}', 'derecha')" class="p-4 bg-blue-800 hover:bg-blue-700 rounded-lg">Mano Derecha</button>
        </div>
        <div id="mentalism-feedback-area" class="mt-6"></div>
    `;
    navigateTo('mentalism-exercise-view');
}
      

function checkMentalismAnswer(exerciseId, chosenOptionIndex) {
    const exercise = mentalism_exercises[exerciseId];
    const chosenOption = exercise.script_options[chosenOptionIndex];

    exercise.script_options.forEach((opt, index) => {
        const button = document.getElementById(`me-opt-${index}`);
        button.disabled = true;
        button.classList.remove('hover:bg-gray-700');
        if(index === chosenOptionIndex) {
            button.classList.add(chosenOption.is_correct ? 'border-green-500' : 'border-red-500');
        }
    });

    const feedbackArea = document.getElementById('mentalism-feedback-area');
    const feedbackColor = chosenOption.is_correct ? 'border-green-500 bg-green-900_bg-opacity-25' : 'border-red-500 bg-red-900_bg-opacity-25';
    feedbackArea.innerHTML = `
        <div class="p-4 rounded-lg border-2 ${feedbackColor} animate-fade-in">
            <h3 class="font-bold text-lg mb-2">${chosenOption.is_correct ? '¡TÉCNICA CORRECTA!' : 'TÉCNICA INCORRECTA'}</h3>
            <p>${chosenOption.feedback}</p>
        </div>
        <button onclick="startMentalismExercise('${exerciseId}')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors mt-4">Volver a Intentar</button>
    `;
}
      function showReadingReaction(exerciseId, questionId) {
    const exercise = mentalism_exercises[exerciseId];
    const question = exercise.probing_questions.find(q => q.id === questionId);

    const reactionArea = document.getElementById('mentalism-reaction-area');
    const reactionDiv = document.createElement('div');
    reactionDiv.className = 'p-3 bg-gray-800 rounded-lg animate-fade-in';
    reactionDiv.innerHTML = `<p><strong class="text-purple-300">Al preguntar por "${question.text}":</strong> ${question.reaction}</p>`;
    reactionArea.appendChild(reactionDiv);

    document.getElementById(`me-q-${questionId}`).disabled = true;
    document.getElementById('mentalism-final-choice-area').classList.remove('hidden');
}
      
      function makeFinalGuess(exerciseId, chosenHand) {
    const exercise = mentalism_exercises[exerciseId];
    const result = exercise.final_choices[chosenHand];

    const feedbackArea = document.getElementById('mentalism-feedback-area');
    const feedbackColor = result.is_correct ? 'border-green-500' : 'border-red-500';
    feedbackArea.innerHTML = `
        <div class="p-4 rounded-lg border-2 ${feedbackColor} animate-fade-in">
            <h3 class="font-bold text-lg mb-2">${result.is_correct ? `¡CORRECTO! LA MONEDA ESTABA EN LA MANO ${chosenHand.toUpperCase()}` : 'INCORRECTO'}</h3>
            <p>${result.feedback}</p>
        </div>
        <button onclick="startMentalismExercise('${exerciseId}')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors mt-4">Volver a Intentar</button>
    `;

    document.getElementById('mentalism-final-choice-area').innerHTML = `<p class="text-center text-gray-400">Decisión final: Mano ${chosenHand}.</p>`;
}
      
      
   // --- INICIO DEL CÓDIGO DEL SANTUARIO DE RELAJACIÓN ---

// Variables para controlar el estado de la sesión
let sessionTimerInterval = null;
let breathingCycleInterval = null;
let sessionAudio = null;
let stopwatchInterval = null;
let recoveryCountdown = null;

// Objeto con las pistas de audio (usa enlaces a sonidos gratuitos)
const soundscapes = {
    rain: 'rain.mp3',
    waves: 'waves.mp3',
    bowls: 'bowls.mp3', 
    fire: 'fire.mp3', 
    nature: 'nature.mp3'
};

// Objeto con los patrones de respiración en milisegundos
const breathingPatterns = {
    'box': [
        { instruction: 'Inhala...', duration: 4000, scale: 1.4, color: 'bg-green-500' },
        { instruction: 'Sostén...', duration: 4000, scale: 1.4, color: 'bg-yellow-500' },
        { instruction: 'Exhala...', duration: 4000, scale: 1, color: 'bg-blue-500' },
        { instruction: 'Sostén...', duration: 4000, scale: 1, color: 'bg-yellow-500' }
    ],
    '478': [
        { instruction: 'Inhala...', duration: 4000, scale: 1.4, color: 'bg-green-500' },
        { instruction: 'Sostén...', duration: 7000, scale: 1.4, color: 'bg-yellow-500' },
        { instruction: 'Exhala...', duration: 8000, scale: 1, color: 'bg-blue-500' }
    ],
    'wimhof': [ // <-- NUEVA TÉCNICA
        { instruction: 'Inhala Fuerte', duration: 1200, scale: 1.4, color: 'bg-orange-500' },
        { instruction: 'Exhala Suave', duration: 800, scale: 1, color: 'bg-yellow-700' }
        // Nota: La retención larga se maneja fuera del ciclo visual principal.
    ],
    'energy': [ // <-- NUEVA TÉCNICA
        { instruction: 'Inhala Rápido', duration: 500, scale: 1.2, color: 'bg-orange-600' },
        { instruction: 'Exhala Fuerte', duration: 500, scale: 1, color: 'bg-yellow-500' }
    ]
};

// Array de sugestiones de PNL para el final
const pnlSuggestions = [
    // --- Éxito en los Negocios ---
    "Veo oportunidades de crecimiento y éxito donde otros ven obstáculos.",
    "Mi comunicación es persuasiva, clara y carismática, conectando fácilmente con clientes y socios.",
    "Atraigo a los clientes y colaboradores ideales que están alineados con mi visión.",
    "Cada día, mi mente está más enfocada y tomo decisiones estratégicas con confianza y claridad.",
    "El valor que ofrezco a través de mi trabajo regresa a mí multiplicado.",
    "Confío plenamente en mi intuición para guiar mis proyectos hacia la prosperidad.",
    "Cada desafío en mi negocio es una lección que me hace más fuerte, sabio y efectivo.",
    "Mi energía y pasión por mis proyectos son contagiosas y motivan a quienes me rodean.",
    "Soy un imán para las ideas innovadoras y los recursos necesarios para materializarlas.",
    "Disfruto del proceso de construir mi éxito, celebrando cada paso del camino.",
    "Mi red profesional se expande constantemente con personas valiosas y exitosas.",

    // --- Salud Física ---
    "Cada célula de mi cuerpo vibra con energía, vitalidad y salud perfecta.",
    "Mi cuerpo sabe exactamente cómo sanarse, regenerarse y mantenerse en perfecto equilibrio.",
    "Disfruto eligiendo alimentos que nutren, energizan y fortalecen mi cuerpo.",
    "Mi sueño es profundo y reparador, despertando cada mañana sintiéndome renovado y lleno de vida.",
    "Siento una creciente energía y motivación para mover mi cuerpo y celebrar su fuerza.",
    "Escucho con sabiduría las señales de mi cuerpo y le doy exactamente lo que necesita para prosperar.",
    "Con cada respiración profunda, libero tensión y lleno cada parte de mi ser con bienestar.",
    "Mi sistema inmunológico es fuerte, inteligente y me protege eficazmente.",
    "Estoy agradecido por mi cuerpo fuerte y saludable, y lo cuido con amor y respeto.",
    "El agua que bebo purifica y revitaliza cada célula de mi cuerpo.",

    // --- Abundancia Económica ---
    "Soy un imán para el dinero, y la prosperidad fluye hacia mí desde fuentes esperadas e inesperadas.",
    "Merezco y acepto con alegría toda la abundancia económica que el universo tiene para ofrecerme.",
    "Mi relación con el dinero es sana, positiva y se vuelve más fuerte cada día.",
    "El dinero que gasto sabiamente para mejorar mi vida y la de otros, regresa a mí multiplicado.",
    "Mi capacidad para generar ingresos aumenta constantemente a través de mi talento, mi pasión y mi trabajo.",
    "Veo y actúo sobre las oportunidades financieras que me rodean en todo momento.",
    "Administro mi dinero con sabiduría, y este crece y se multiplica.",
    "Siento gratitud por la abundancia que ya tengo, y esta gratitud atrae aún más prosperidad.",
    "Pagar mis cuentas con alegría es una afirmación de mi confianza en el flujo constante de abundancia.",
    "Mis pensamientos sobre la riqueza son creativos, positivos y se materializan con facilidad."
];

function startBreathingSession() {
    const technique = document.querySelector('input[name="technique"]:checked').value;

    if (technique === 'wimhof') {
        // Si es Wim Hof, llama a su motor específico y complejo.
        startWimHofSession();
    } else {
        // Para todas las demás, llama al motor de respiración estándar.
        startStandardBreathingSession(technique);
    }
}
      
function startStandardBreathingSession(technique) {
    const durationMinutes = document.getElementById('duration-slider').value;
    const sound = document.querySelector('input[name="sound"]:checked').value;
    let totalSeconds = durationMinutes * 60;
    const pattern = breathingPatterns[technique];
    
    navigateTo('breathing-session-view');
    
    if (sound !== 'none' && soundscapes[sound]) {
        sessionAudio = new Audio(soundscapes[sound]);
        sessionAudio.loop = true;
        sessionAudio.play();
    }
    
    // --- LÓGICA SIMPLIFICADA ---
    const timerDisplay = document.getElementById('unified-timer-display');
    document.getElementById('cycle-display').textContent = 'Sesión de Relajación';
    document.querySelector('#detailed-instructions p').textContent = '';
    document.getElementById('retention-btn').classList.add('hidden');
    
    sessionTimerInterval = setInterval(() => {
        totalSeconds--;
        const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
        const seconds = String(totalSeconds % 60).padStart(2, '0');
        timerDisplay.textContent = `${minutes}:${seconds}`;
        
        if (totalSeconds < 0) { // Usamos < 0 para que se muestre el 00:00
            endBreathingSession(true);
        }
    }, 1000);
    
    // El ciclo de respiración visual (runCycle) no cambia y funciona perfecto.
    const visualizer = document.getElementById('breathing-visualizer');
    const instructionDisplay = document.getElementById('breathing-instruction');
    let currentStep = 0;
    
    const runCycle = () => {
        const step = pattern[currentStep];
        instructionDisplay.textContent = step.instruction;
        visualizer.className = 'w-48 h-48 rounded-full flex items-center justify-center';
        if (step.color) {
            visualizer.classList.add(step.color);
        }
        visualizer.style.transform = `scale(${step.scale})`;
        currentStep = (currentStep + 1) % pattern.length;
        breathingCycleInterval = setTimeout(runCycle, step.duration);
    };
    runCycle();
}
      
function startWimHofSession() {
    const breathsPerCycle = parseInt(document.getElementById('wh-breaths-slider').value);
    const totalCycles = parseInt(document.getElementById('wh-cycles-slider').value);
    const sound = document.querySelector('input[name="sound"]:checked').value;
    
    let currentCycle = 1;
    let breathCount = 1;
    let lastRetentionTime = '0:00';

    // Elementos de la interfaz
    const timerDisplay = document.getElementById('unified-timer-display');
    const visualizer = document.getElementById('breathing-visualizer');
    const instruction = document.getElementById('breathing-instruction');
    const detailedInstructions = document.querySelector('#detailed-instructions p');
    const cycleDisplay = document.getElementById('cycle-display');
    const retentionBtn = document.getElementById('retention-btn');
    
    navigateTo('breathing-session-view');
    
    if (sound !== 'none' && soundscapes[sound]) {
        sessionAudio = new Audio(soundscapes[sound]);
        sessionAudio.loop = true;
        sessionAudio.play();
    }
    
    const runPhase = (phase) => {
        switch(phase) {
            case 'BREATHING':
                cycleDisplay.textContent = `Ciclo ${currentCycle} de ${totalCycles}`;
                retentionBtn.classList.add('hidden');
                
                const breathCycle = () => {
                    if (breathCount > breathsPerCycle) {
                        clearInterval(breathingCycleInterval);
                        runPhase('RETENTION');
                        return;
                    }
                    // El temporizador ahora es el contador de respiraciones
                    timerDisplay.textContent = breathCount;
                    instruction.textContent = 'Inhala';
                    visualizer.style.transform = 'scale(1.4)';
                    visualizer.className = 'w-48 h-48 rounded-full flex items-center justify-center bg-orange-500';
                    detailedInstructions.textContent = "Inhala profundamente, llenando abdomen y pecho.";

                    setTimeout(() => {
                        instruction.textContent = 'Exhala';
                        visualizer.style.transform = 'scale(1)';
                        visualizer.className = 'w-48 h-48 rounded-full flex items-center justify-center bg-yellow-500';
                        detailedInstructions.textContent = "Suelta el aire por la boca sin forzar.";
                        breathCount++;
                    }, 1200);
                };
                breathingCycleInterval = setInterval(breathCycle, 2000);
                break;
                
            case 'RETENTION':
                // El temporizador ahora es el cronómetro
                instruction.textContent = 'Sostén';
                visualizer.className = 'w-48 h-48 rounded-full flex items-center justify-center bg-yellow-500';
                detailedInstructions.textContent = "Exhala completamente y retén. Presiona el botón cuando necesites inhalar.";
                retentionBtn.textContent = 'INHALAR (Recuperación)';
                retentionBtn.classList.remove('hidden');
                retentionBtn.onclick = () => runPhase('RECOVERY');

                let seconds = 0;
                timerDisplay.textContent = '0:00';
                stopwatchInterval = setInterval(() => {
                    seconds++;
                    const mins = String(Math.floor(seconds / 60));
                    const secs = String(seconds % 60).padStart(2, '0');
                    lastRetentionTime = `${mins}:${secs}`; // Guardamos el tiempo
                    timerDisplay.textContent = lastRetentionTime;
                }, 1000);
                break;
                
            case 'RECOVERY':
                clearInterval(stopwatchInterval);
                retentionBtn.classList.add('hidden');
                instruction.textContent = 'Sostén';
                visualizer.className = 'w-48 h-48 rounded-full flex items-center justify-center bg-green-500';
                visualizer.style.transform = 'scale(1.4)';
                detailedInstructions.textContent = "Inhala profundamente y retén durante 15 segundos.";
                
                let recoverySeconds = 15;
                timerDisplay.textContent = recoverySeconds;
                recoveryCountdown = setInterval(() => {
                    recoverySeconds--;
                    timerDisplay.textContent = recoverySeconds;
                    if (recoverySeconds < 0) {
                        clearInterval(recoveryCountdown);
                        if (currentCycle < totalCycles) {
                            runPhase('PAUSE_BETWEEN_CYCLES');
                        } else {
                            endBreathingSession(true);
                        }
                    }
                }, 1000);
                break;

            case 'PAUSE_BETWEEN_CYCLES':
                instruction.textContent = 'Pausa';
                visualizer.className = 'w-48 h-48 rounded-full flex items-center justify-center bg-gray-500';
                visualizer.style.transform = 'scale(1)';
                detailedInstructions.textContent = `Ciclo ${currentCycle} completado. Prepárate para el siguiente.`;
                timerDisplay.textContent = lastRetentionTime; // Muestra el último tiempo de retención
                cycleDisplay.textContent = `Última Retención`;
                
                retentionBtn.textContent = `COMENZAR CICLO ${currentCycle + 1}`;
                retentionBtn.classList.remove('hidden');
                retentionBtn.onclick = () => {
                    currentCycle++;
                    breathCount = 1;
                    runPhase('BREATHING');
                };
                break;
        }
    };
    runPhase('BREATHING');
}
      

function endBreathingSession(withSuggestion = false) {
    // Detenemos todos los posibles temporizadores e intervalos de forma segura
    if (sessionTimerInterval) clearInterval(sessionTimerInterval);
    if (breathingCycleInterval) clearTimeout(breathingCycleInterval);
    if (stopwatchInterval) clearInterval(stopwatchInterval);
    if (recoveryCountdown) clearInterval(recoveryCountdown);

    // Reseteamos todas las variables a null
    sessionTimerInterval = null;
    breathingCycleInterval = null;
    stopwatchInterval = null;
    recoveryCountdown = null;
    
    // Detenemos y limpiamos el audio
    if (sessionAudio) {
        sessionAudio.pause();
        sessionAudio = null;
    }
    
    // Volvemos a la vista anterior
    navigateBack();
    
    // Mostramos la sugestión de PNL si corresponde
    if (withSuggestion) {
        const randomSuggestion = pnlSuggestions[Math.floor(Math.random() * pnlSuggestions.length)];
        setTimeout(() => {
            alert(`Sesión completada.\n\nSugestión del día:\n"${randomSuggestion}"`);
        }, 200);
    }
}
      
      function showBreathingGuide() {
    const modal = document.getElementById('breathing-guide-modal');
    if (modal) {
        modal.classList.remove('hidden');
        lucide.createIcons(); // Para renderizar los iconos dentro del modal
    }
}

function hideBreathingGuide() {
    const modal = document.getElementById('breathing-guide-modal');
    if (modal) {
        modal.classList.add('hidden');
    }
}
      
      
// --- INICIO DEL MOTOR DE MISIONES DE INTEGRACIÓN ---

let currentIntegrationMission = null;
let missionState = {};

function showIntegrationMissionLibrary() {
    const libraryView = document.getElementById('integration-mission-library-view');
    let content = `<header class="flex items-center mb-6"><button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button><h1 class="text-2xl font-bold">Misiones de Integración</h1></header><div class="space-y-4">`;
    
    for (const missionId in integration_missions) {
        const mission = integration_missions[missionId];
        content += `<div onclick="startIntegrationMission('${missionId}')" class="bg-gray-800 p-4 rounded-lg flex items-center cursor-pointer hover:bg-gray-700 transition-colors"><i data-lucide="swords" class="text-red-400 mr-4"></i><div class="flex-grow"><h3 class="font-bold">${mission.title}</h3></div><i data-lucide="chevron-right" class="text-gray-500"></i></div>`;
    }
    content += `</div>`;
    libraryView.innerHTML = content;
    navigateTo('integration-mission-library-view');
}

function startIntegrationMission(missionId) {
    currentIntegrationMission = integration_missions[missionId];
    if (!currentIntegrationMission) return;
    
    // Clonamos el estado inicial para esta partida
    missionState = JSON.parse(JSON.stringify(currentIntegrationMission.mission_state));
    
    const firstPhaseId = Object.keys(currentIntegrationMission.phases)[0];
    renderIntegrationPhase(firstPhaseId);
}

function renderIntegrationPhase(phaseId) {
    const phase = currentIntegrationMission.phases[phaseId];
    if (!phase) return;

    const missionView = document.getElementById('integration-mission-view');
    missionView.innerHTML = `
        <header class="flex items-center mb-4">
            <button onclick="navigateBack()" class="p-2 rounded-full hover:bg-gray-700 mr-4"><i data-lucide="arrow-left"></i></button>
            <h1 class="text-2xl font-bold">${currentIntegrationMission.title}</h1>
        </header>
        <div class="bg-gray-800 p-3 rounded-lg mb-4 border border-gray-700">
            <h2 class="text-lg font-bold text-yellow-400">${phase.title}</h2>
            <p class="text-sm text-gray-300">${phase.goal}</p>
        </div>
        <div id="im-status-bar" class="flex justify-around bg-gray-900 p-2 rounded-lg mb-4 text-center text-xs"></div>
        <div id="im-conversation-container" class="flex-grow flex flex-col justify-end space-y-4"></div>
    `;
    
    navigateTo('integration-mission-view');
    renderIntegrationNode(phaseId, phase.start_node);
}

function renderIntegrationNode(phaseId, nodeId) {
    const phase = currentIntegrationMission.phases[phaseId];
    const node = phase.nodes[nodeId];
    if (!node) return;

    // --- INICIO DE CÓDIGO MEJORADO ---
    // 1. Renderizado dinámico de la barra de estado
    const statusBar = document.getElementById('im-status-bar');
    let statusHtml = '';
    for (const key in missionState) {
        const label = key.charAt(0).toUpperCase() + key.slice(1); // Pone la primera letra en mayúscula
        const value = missionState[key];
        const color = value >= 50 ? 'text-green-400' : 'text-red-400';
        statusHtml += `<div><span class="text-gray-400">${label}:</span> <span class="font-bold ${color}">${value}</span></div>`;
    }
    statusBar.innerHTML = statusHtml;

    const conversationContainer = document.getElementById('im-conversation-container');
    const oldOptions = conversationContainer.querySelector('#im-user-options');
    if(oldOptions) oldOptions.remove();

    // 2. Lógica de evaluación para el final de la misión
    if (node.is_end_mission) {
        let success = true;
        if (node.evaluation && node.evaluation.success_condition) {
            for (const key in node.evaluation.success_condition) {
                const conditionValue = node.evaluation.success_condition[key];
                if (missionState[key] < conditionValue) { // Asumimos condición de "mayor o igual que"
                    success = false;
                    break;
                }
            }
        }
        
        const feedback = success ? node.evaluation.success_feedback : node.evaluation.failure_feedback;
        const feedbackColor = success ? 'border-green-500' : 'border-red-500';
        
        const feedbackBubble = document.createElement('div');
        feedbackBubble.className = `p-4 rounded-lg mt-4 border-2 ${feedbackColor}`;
        feedbackBubble.innerHTML = `<h3 class="font-bold text-lg mb-2">Resultado de la Misión:</h3><p>${feedback}</p>`;
        conversationContainer.appendChild(feedbackBubble);
        return;
    }
    // --- FIN DE CÓDIGO MEJORADO ---

    const speaker = currentIntegrationMission.characters.find(c => c.id === node.speaker);
    const npcBubble = document.createElement('div');
    npcBubble.className = 'p-4 bg-gray-700 rounded-lg max-w-lg self-start';
    npcBubble.innerHTML = `<p class="font-bold text-blue-400 mb-1">${speaker.name} (${speaker.mood})</p><p class="text-gray-200">${node.line}</p>`;
    conversationContainer.appendChild(npcBubble);

    const optionsContainer = document.createElement('div');
    optionsContainer.id = 'im-user-options';
    optionsContainer.className = 'w-full pt-4 space-y-3';
    
    node.options.forEach(opt => {
        const optionButton = document.createElement('button');
        optionButton.className = 'w-full text-left p-4 bg-blue-800 hover:bg-blue-700 rounded-lg transition-colors';
        optionButton.innerHTML = `
            <p class="font-semibold">${opt.text}</p>
            <p class="text-xs text-blue-300 mt-1">Módulo: ${opt.skill.module} | Habilidad: ${opt.skill.name}</p>
        `;
        optionButton.onclick = () => selectIntegrationOption(phaseId, nodeId, opt);
        optionsContainer.appendChild(optionButton);
    });
    conversationContainer.appendChild(optionsContainer);
    lucide.createIcons();
}

function selectIntegrationOption(phaseId, nodeId, selectedOption) {
    // Aplicar efectos al estado de la misión
    for (const effect in selectedOption.effects) {
        const value = parseInt(selectedOption.effects[effect]);
        if (missionState.hasOwnProperty(effect)) {
            missionState[effect] += value;
        }
    }

    const currentNode = currentIntegrationMission.phases[phaseId].nodes[nodeId];
    const nextNode = currentIntegrationMission.phases[phaseId].nodes[selectedOption.target_node];

    if (nextNode.is_end_phase) {
        renderIntegrationPhase(nextNode.next_phase);
    } else {
        renderIntegrationNode(phaseId, selectedOption.target_node);
    }
}
      

// Pequeño estilo para la animación de fade-in
const styleSheet = document.createElement("style");
styleSheet.innerText = `
    @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
`;
document.head.appendChild(styleSheet);
      
      
       // EventListeners
        document.addEventListener('DOMContentLoaded', () => {
          renderModules();
          showTab('inicio');
          renderNotesList();
          showDailyMission();
          showDailyLesson();
          
          // --- Lógica para mostrar/ocultar controles específicos ---
document.querySelectorAll('input[name="technique"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
        const whControls = document.getElementById('wimhof-controls');
        const durationControls = document.getElementById('duration-controls');
        if (e.target.value === 'wimhof') {
            whControls.classList.remove('hidden');
            durationControls.classList.add('hidden');
        } else {
            whControls.classList.add('hidden');
            durationControls.classList.remove('hidden');
        }
    });
});

// --- Lógica para los sliders de Wim Hof ---
const whBreathsSlider = document.getElementById('wh-breaths-slider');
const whBreathsDisplay = document.getElementById('wh-breaths-display');
if(whBreathsSlider) {
    whBreathsSlider.addEventListener('input', (e) => whBreathsDisplay.textContent = e.target.value);
}
const whCyclesSlider = document.getElementById('wh-cycles-slider');
const whCyclesDisplay = document.getElementById('wh-cycles-display');
if(whCyclesSlider) {
    whCyclesSlider.addEventListener('input', (e) => whCyclesDisplay.textContent = e.target.value);
}
          
          // --- Activadores para el Santuario de Relajación ---
const startBtn = document.getElementById('start-session-btn');
if (startBtn) {
    startBtn.addEventListener('click', startBreathingSession);
}

const endBtn = document.getElementById('end-session-btn');
if (endBtn) {
    endBtn.addEventListener('click', () => endBreathingSession(false)); // Finaliza sin sugestión
}

const durationSlider = document.getElementById('duration-slider');
const durationDisplay = document.getElementById('duration-display');
if (durationSlider) {
    durationSlider.addEventListener('input', (e) => {
        durationDisplay.textContent = `${e.target.value} min`;
    });
}

// Lógica para el feedback visual de los botones de radio
document.querySelectorAll('#breathing-technique-selector label, #soundscape-selector label').forEach(label => {
    label.addEventListener('click', () => {
        // Primero, quita el borde azul de todos los botones del mismo grupo
        const groupName = label.querySelector('input').name;
        document.querySelectorAll(`input[name="${groupName}"]`).forEach(radio => {
            radio.parentElement.classList.remove('border-blue-600');
            radio.parentElement.classList.add('border-gray-700');
        });
        // Luego, añade el borde azul solo al que se ha hecho clic
        label.classList.remove('border-gray-700');
        label.classList.add('border-blue-600');
    });
});
          
        });
      
    </script>
  
  <div id="breathing-guide-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4">
    <div class="bg-gray-800 rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6 border border-gray-700 relative">
        <button onclick="hideBreathingGuide()" class="absolute top-4 right-4 p-2 rounded-full hover:bg-gray-700">
            <i data-lucide="x"></i>
        </button>

        <h2 class="text-2xl font-bold mb-6 text-center">Guía de Técnicas de Respiración</h2>

        <div class="space-y-8">
            <div>
                <h3 class="text-xl font-semibold text-cyan-400 mb-2">Respiración Wim Hof</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-bold mb-1">Beneficios Principales:</h4>
                        <ul class="list-disc list-inside text-sm text-gray-300 space-y-1">
                            <li>Aumento notable de energía y vitalidad.</li>
                            <li>Fortalecimiento del sistema inmunológico.</li>
                            <li>Reducción del estrés y la inflamación.</li>
                            <li>Aumento de la concentración y la fuerza de voluntad.</li>
                            <li>Mejora de la tolerancia al frío y la recuperación física.</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold mb-1">Cuándo Usarla:</h4>
                        <ul class="list-disc list-inside text-sm text-gray-300 space-y-1">
                            <li>Por la mañana para un impulso de energía potente.</li>
                            <li>Antes de un desafío mental o físico (ej. deporte).</li>
                            <li>Para combatir la fatiga o la sensación de letargo.</li>
                            <li>Antes de una exposición al frío (ducha fría).</li>
                            <li>Cuando buscas aumentar tu resiliencia y fortaleza mental.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-semibold text-blue-400 mb-2">Respiración Cuadrada (4-4-4-4)</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-bold mb-1">Beneficios Principales:</h4>
                        <ul class="list-disc list-inside text-sm text-gray-300 space-y-1">
                            <li>Calma el sistema nervioso de forma inmediata.</li>
                            <li>Reduce los síntomas físicos del estrés.</li>
                            <li>Aumenta el enfoque y la concentración mental.</li>
                            <li>Fácil de realizar en cualquier lugar y situación.</li>
                            <li>Ayuda a controlar respuestas de pánico.</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold mb-1">Cuándo Usarla:</h4>
                        <ul class="list-disc list-inside text-sm text-gray-300 space-y-1">
                            <li>Durante una situación estresante en el trabajo.</li>
                            <li>Antes de un evento importante (una presentación, una conversación difícil).</li>
                            <li>Cuando te sientas abrumado o tu mente esté dispersa.</li>
                            <li>Para hacer una pausa y "resetear" tu estado mental durante el día.</li>
                            <li>Al tomar una decisión importante para aclarar la mente.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-semibold text-purple-400 mb-2">Respiración Relajante (4-7-8)</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-bold mb-1">Beneficios Principales:</h4>
                        <ul class="list-disc list-inside text-sm text-gray-300 space-y-1">
                            <li>Activa la respuesta de relajación profunda del cuerpo (sistema parasimpático).</li>
                            <li>Muy efectiva para combatir el insomnio y conciliar el sueño.</li>
                            <li>Reduce la ansiedad de forma significativa.</li>
                            <li>Ayuda a gestionar antojos y respuestas emocionales intensas como la ira.</li>
                            <li>Disminuye el ritmo cardíaco y la presión arterial.</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold mb-1">Cuándo Usarla:</h4>
                        <ul class="list-disc list-inside text-sm text-gray-300 space-y-1">
                            <li>Justo antes de dormir para apagar la mente.</li>
                            <li>En medio de un pico de ansiedad o nerviosismo.</li>
                            <li>Cuando sientas que una emoción fuerte (como el enojo) te va a desbordar.</li>
                            <li>Para transicionar del estado de "trabajo" al de "descanso" al final del día.</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div>
                <h3 class="text-xl font-semibold text-orange-400 mb-2">Respiración Energizante (de Fuelle)</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-bold mb-1">Beneficios Principales:</h4>
                        <ul class="list-disc list-inside text-sm text-gray-300 space-y-1">
                            <li>Proporciona un impulso de energía casi instantáneo.</li>
                            <li>Aumenta la claridad mental y disipa la "niebla" cerebral.</li>
                            <li>Mejora la capacidad pulmonar y fortalece el sistema respiratorio.</li>
                            <li>Desintoxica el cuerpo al expulsar toxinas.</li>
                            <li>Estimula el metabolismo y la digestión.</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold mb-1">Cuándo Usarla:</h4>
                        <ul class="list-disc list-inside text-sm text-gray-300 space-y-1">
                            <li>Como alternativa a una taza de café por la tarde.</li>
                            <li>Cuando necesites un extra de concentración para una tarea.</li>
                            <li>Al sentir congestión o pesadez en el sistema respiratorio.</li>
                            <li>Antes de una sesión de meditación para activar la mente.</li>
                            <li>Al inicio del día para despertar el cuerpo y la mente.</li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
  
  <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('Service Worker registrado con éxito:', registration.scope);
                })
                .catch(error => {
                    console.log('Fallo en el registro del Service Worker:', error);
                });
        });
    }
</script>
  
</body>
</html>
